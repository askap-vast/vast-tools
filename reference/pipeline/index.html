<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Python module to interact with ASKAP VAST data."><meta name=author content="VAST Development Team"><link rel=icon href=../../img/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.1.4"><title>pipeline.py - VAST Tools</title><link rel=stylesheet href=../../assets/stylesheets/main.bde7dde4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ef6f36e2.min.css><link rel=stylesheet href=../../css/lightgallery.min.css><script src=../../js/lightgallery.min.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../theme/css/extra.css><link rel=stylesheet href=../../css/ansi-colours.css><link rel=stylesheet href=../../css/jupyter-cells.css><link rel=stylesheet href=../../css/pandas-dataframe.css><meta property=og:type content=website><meta property=og:title content="VAST Tools - pipeline.py"><meta property=og:description content="Python module to interact with ASKAP VAST data."><meta property=og:url content=None></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent=indigo> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#vasttools.pipeline class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-announce> <div class="md-announce__inner md-grid md-typeset"> <style>
      .md-announce a,
      .md-announce a:focus,
      .md-announce a:hover{color:currentColor}.md-announce
      strong{white-space:nowrap}.md-announce}
  </style> <a href=/changelog/ ><strong>New in version 2.0.0</strong>: Documentation, and much, much more ðŸ™Œ. Check the <strong>release notes!</strong></a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="VAST Tools" class="md-header__button md-logo" aria-label="VAST Tools" data-md-component=logo> <img src=../../img/vast-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VAST Tools </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> pipeline.py </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent=indigo type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent=blue type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/askap-vast/vast-tools title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> askap-vast/vast-tools </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting_started/introduction/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../components/mocs/ class=md-tabs__link> Components & Features </a> </li> <li class=md-tabs__item> <a href=../../notebook-examples/notebooks-overview/ class=md-tabs__link> Example Notebooks </a> </li> <li class=md-tabs__item> <a href=../../contributing/develop/ class=md-tabs__link> Contributing & Developing </a> </li> <li class=md-tabs__item> <a href=../../help_and_acknowledgements/ class=md-tabs__link> Help and Acknowledgements </a> </li> <li class=md-tabs__item> <a href=../../CHANGELOG/ class="md-tabs__link md-tabs__link--active"> Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="VAST Tools" class="md-nav__button md-logo" aria-label="VAST Tools" data-md-component=logo> <img src=../../img/vast-logo.png alt=logo> </a> VAST Tools </label> <div class=md-nav__source> <a href=https://github.com/askap-vast/vast-tools title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> askap-vast/vast-tools </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting_started/introduction/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../getting_started/installation/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../getting_started/configuration/ class=md-nav__link> Configuration & Data Access </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Components & Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Components & Features" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Components & Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../components/mocs/ class=md-nav__link> MOCs </a> </li> <li class=md-nav__item> <a href=../../components/pipeline/ class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../components/query/ class=md-nav__link> Query </a> </li> <li class=md-nav__item> <a href=../../components/source/ class=md-nav__link> Source </a> </li> <li class=md-nav__item> <a href=../../components/survey/ class=md-nav__link> Survey </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Scripts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Scripts data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Scripts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scripts/build_lightcurves/ class=md-nav__link> build_lightcurves </a> </li> <li class=md-nav__item> <a href=../../scripts/find_sources/ class=md-nav__link> find_sources </a> </li> <li class=md-nav__item> <a href=../../scripts/pilot_fields_info/ class=md-nav__link> pilot_fields_info </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Example Notebooks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Example Notebooks" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Example Notebooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notebook-examples/notebooks-overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/catalogue-crossmatching-example/ class=md-nav__link> Catalogue Crossmatch </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/planet-hunting-example/ class=md-nav__link> Planet Searching </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/source-search-example/ class=md-nav__link> Query Source Search </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/using-vast-mocs-example/ class=md-nav__link> Using VAST MOCs </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/vast-pipeline-example/ class=md-nav__link> VAST Pipeline Exploration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Contributing & Developing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Contributing & Developing" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Contributing & Developing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/develop/ class=md-nav__link> Developing VAST Tools </a> </li> <li class=md-nav__item> <a href=../../contributing/github/ class=md-nav__link> GitHub Platform </a> </li> <li class=md-nav__item> <a href=../../contributing/docsdev/ class=md-nav__link> Documentation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../help_and_acknowledgements/ class=md-nav__link> Help and Acknowledgements </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CHANGELOG/ class=md-nav__link> Changelog </a> </li> <li class=md-nav__item> <a href=../../CODE_OF_CONDUCT/ class=md-nav__link> Code of Conduct </a> </li> <li class=md-nav__item> <a href=../../LICENSE/ class=md-nav__link> License </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4 type=checkbox id=__nav_7_4 checked> <label class=md-nav__link for=__nav_7_4> Code Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Code Reference" data-md-level=2> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Code Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4_1 type=checkbox id=__nav_7_4_1 checked> <label class=md-nav__link for=__nav_7_4_1> vast_tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=vast_tools data-md-level=3> <label class=md-nav__title for=__nav_7_4_1> <span class="md-nav__icon md-icon"></span> vast_tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4_1_1 type=checkbox id=__nav_7_4_1_1> <label class=md-nav__link for=__nav_7_4_1_1> bin <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=bin data-md-level=4> <label class=md-nav__title for=__nav_7_4_1_1> <span class="md-nav__icon md-icon"></span> bin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../bin/build_lightcurves/ class=md-nav__link> build_lightcurves.py </a> </li> <li class=md-nav__item> <a href=../bin/find_sources/ class=md-nav__link> find_sources.py </a> </li> <li class=md-nav__item> <a href=../bin/pilot_fields_info/ class=md-nav__link> pilot_fields_info.py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../moc/ class=md-nav__link> moc.py </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> pipeline.py <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> pipeline.py </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vasttools.pipeline class=md-nav__link> vasttools.pipeline </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis class=md-nav__link> PipeAnalysis </a> <nav class=md-nav aria-label=PipeAnalysis> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.__init__ class=md-nav__link> __init__() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class=md-nav__link> eta_v_diagnostic_plot() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class=md-nav__link> plot_two_epoch_pairs() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.recalc_sources_df class=md-nav__link> recalc_sources_df() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class=md-nav__link> run_eta_v_analysis() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class=md-nav__link> run_two_epoch_analysis() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline class=md-nav__link> Pipeline </a> <nav class=md-nav aria-label=Pipeline> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.__init__ class=md-nav__link> __init__() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_images class=md-nav__link> list_images() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_piperuns class=md-nav__link> list_piperuns() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_run class=md-nav__link> load_run() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_runs class=md-nav__link> load_runs() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun class=md-nav__link> PipeRun </a> <nav class=md-nav aria-label=PipeRun> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.__init__ class=md-nav__link> __init__() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.check_for_planets class=md-nav__link> check_for_planets() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.combine_with_run class=md-nav__link> combine_with_run() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.create_moc class=md-nav__link> create_moc() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.filter_by_moc class=md-nav__link> filter_by_moc() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_source class=md-nav__link> get_source() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_sources_skycoord class=md-nav__link> get_sources_skycoord() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.load_two_epoch_metrics class=md-nav__link> load_two_epoch_metrics() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../query/ class=md-nav__link> query.py </a> </li> <li class=md-nav__item> <a href=../source/ class=md-nav__link> source.py </a> </li> <li class=md-nav__item> <a href=../survey/ class=md-nav__link> survey.py </a> </li> <li class=md-nav__item> <a href=../utils/ class=md-nav__link> utils.py </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vasttools.pipeline class=md-nav__link> vasttools.pipeline </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis class=md-nav__link> PipeAnalysis </a> <nav class=md-nav aria-label=PipeAnalysis> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.__init__ class=md-nav__link> __init__() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class=md-nav__link> eta_v_diagnostic_plot() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class=md-nav__link> plot_two_epoch_pairs() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.recalc_sources_df class=md-nav__link> recalc_sources_df() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class=md-nav__link> run_eta_v_analysis() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class=md-nav__link> run_two_epoch_analysis() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline class=md-nav__link> Pipeline </a> <nav class=md-nav aria-label=Pipeline> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.__init__ class=md-nav__link> __init__() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_images class=md-nav__link> list_images() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_piperuns class=md-nav__link> list_piperuns() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_run class=md-nav__link> load_run() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_runs class=md-nav__link> load_runs() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun class=md-nav__link> PipeRun </a> <nav class=md-nav aria-label=PipeRun> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.__init__ class=md-nav__link> __init__() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.check_for_planets class=md-nav__link> check_for_planets() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.combine_with_run class=md-nav__link> combine_with_run() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.create_moc class=md-nav__link> create_moc() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.filter_by_moc class=md-nav__link> filter_by_moc() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_source class=md-nav__link> get_source() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_sources_skycoord class=md-nav__link> get_sources_skycoord() </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.load_two_epoch_metrics class=md-nav__link> load_two_epoch_metrics() </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>pipeline.py</h1> <div class="doc doc-object doc-module"> <a id=vasttools.pipeline></a> <div class="doc doc-contents first"> <p>Class to interface with results from the VAST Pipeline.</p> <p><strong>Attributes:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>HOST_NCPU</code></td> <td><code>int</code></td> <td><p>The number of CPU found on the host using 'cpu_count()'.</p></td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.PipeAnalysis class="doc doc-heading"> <code>PipeAnalysis</code> <a href=#vasttools.pipeline.PipeAnalysis class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Class that represents an Analysis instance of a Pipeline run. Inherits from class <code>PipeRun</code>.</p> <p><strong>Attributes:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>associations</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Associations dataframe from the pipeline run loaded from 'associations.parquet'.</p></td> </tr> <tr> <td><code>images</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the images of the pipeline run.</p></td> </tr> <tr> <td><code>measurements</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the measurements of the pipeline run.</p></td> </tr> <tr> <td><code>measurement_pairs_file</code></td> <td><code>List[str]</code></td> <td><p>List containing the locations of the measurement_pairs.parquet (or .arrow) file(s).</p></td> </tr> <tr> <td><code>name</code></td> <td><code>str</code></td> <td><p>The pipeline run name.</p></td> </tr> <tr> <td><code>n_workers</code></td> <td><code>int</code></td> <td><p>Number of workers (cpus) available.</p></td> </tr> <tr> <td><code>relations</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the relations of the pipeline run.</p></td> </tr> <tr> <td><code>skyregions</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the skyregions of the pipeline run.</p></td> </tr> <tr> <td><code>sources</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the sources of the pipeline run.</p></td> </tr> <tr> <td><code>sources_skycoord</code></td> <td><code>astropy.coordinates.sky_coordinate.SkyCoord</code></td> <td><p>A SkyCoord object of the default sources attribute.</p></td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeAnalysis.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span> <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=mi>11</span><span class=p>)</span></code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a href=#vasttools.pipeline.PipeAnalysis.__init__ class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Constructor method.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>name</code></td> <td><code>str</code></td> <td><p>The name of the pipeline run.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>images</code></td> <td><code>DataFrame</code></td> <td><p>Images dataframe from the pipeline run loaded from images.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>skyregions</code></td> <td><code>DataFrame</code></td> <td><p>Sky regions dataframe from the pipeline run loaded from skyregions.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>relations</code></td> <td><code>DataFrame</code></td> <td><p>Relations dataframe from the pipeline run loaded from relations.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>sources</code></td> <td><code>DataFrame</code></td> <td><p>Sources dataframe from the pipeline run loaded from sources.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>associations</code></td> <td><code>DataFrame</code></td> <td><p>Associations dataframe from the pipeline run loaded from 'associations.parquet'. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>measurements</code></td> <td><code>Union[pandas.core.frame.DataFrame, vaex.dataframe.DataFrame]</code></td> <td><p>Measurements dataframe from the pipeline run loaded from measurements.parquet and the forced measurements parquet files. A <code>pandas.core.frame.DataFrame</code> or <code>vaex.dataframe.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>measurement_pairs_file</code></td> <td><code>str</code></td> <td><p>The location of the two epoch pairs file from the pipeline. It is a list of locations due to the fact that two pipeline runs could be combined.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>vaex_meas</code></td> <td><code>bool</code></td> <td><p>'True' if the measurements have been loaded using vaex from an arrow file. <code>False</code> means the measurements are loaded into a pandas DataFrame.</p></td> <td><code>False</code></td> </tr> <tr> <td><code>n_workers</code></td> <td><code>int</code></td> <td><p>Number of workers (cpus) available.</p></td> <td><code>11</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>None</code></td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>skyregions</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>relations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>sources</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>associations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>measurements</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
    <span class=n>measurement_pairs_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>vaex_meas</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Constructor method.</span>

<span class=sd>    Args:</span>
<span class=sd>        name: The name of the pipeline run.</span>
<span class=sd>        images: Images dataframe from the pipeline run</span>
<span class=sd>            loaded from images.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        skyregions: Sky regions dataframe from the pipeline run</span>
<span class=sd>            loaded from skyregions.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        relations: Relations dataframe from the pipeline run</span>
<span class=sd>            loaded from relations.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        sources: Sources dataframe from the pipeline run</span>
<span class=sd>            loaded from sources.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        associations: Associations dataframe from the pipeline run loaded</span>
<span class=sd>            from &#39;associations.parquet&#39;. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        measurements: Measurements dataframe from the pipeline run</span>
<span class=sd>            loaded from measurements.parquet and the forced measurements</span>
<span class=sd>            parquet files.  A `pandas.core.frame.DataFrame` or</span>
<span class=sd>            `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>        measurement_pairs_file: The location of the two epoch pairs file</span>
<span class=sd>            from the pipeline. It is a list of locations due to the fact</span>
<span class=sd>            that two pipeline runs could be combined.</span>
<span class=sd>        vaex_meas: &#39;True&#39; if the measurements have been loaded using</span>
<span class=sd>            vaex from an arrow file. `False` means the measurements are</span>
<span class=sd>            loaded into a pandas DataFrame.</span>
<span class=sd>        n_workers: Number of workers (cpus) available.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span>
        <span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span>
        <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=p>,</span> <span class=n>n_workers</span>
    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class="doc doc-heading"> <code class="highlight language-python"><span class=n>eta_v_diagnostic_plot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Adapted from code written by Antonia Rowlinson. Produces the eta, V 'diagnostic plot' (see Rowlinson et al., 2018, https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>eta_cutoff</code></td> <td><code>float</code></td> <td><p>The log10 eta_cutoff from the analysis.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>v_cutoff</code></td> <td><code>float</code></td> <td><p>The log10 v_cutoff from the analysis.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>df</code></td> <td><code>Optional[pandas.core.frame.DataFrame]</code></td> <td><p>Dataframe containing the sources from the Pipeline run. If not provided then the <code>self.sources</code> dataframe will be used. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>use_int_flux</code></td> <td><code>bool</code></td> <td><p>Use integrated fluxes for the analysis instead of peak fluxes, defaults to 'False'.</p></td> <td><code>False</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>&lt;function figure at 0x7fdf77d0c310&gt;</code></td> <td><p>matplotlib figure containing the plot.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>eta_v_diagnostic_plot</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
    <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Adapted from code written by Antonia Rowlinson.</span>
<span class=sd>    Produces the eta, V &#39;diagnostic plot&#39;</span>
<span class=sd>    (see Rowlinson et al., 2018,</span>
<span class=sd>    https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>

<span class=sd>    Args:</span>
<span class=sd>        eta_cutoff: The log10 eta_cutoff from the analysis.</span>
<span class=sd>        v_cutoff: The log10 v_cutoff from the analysis.</span>
<span class=sd>        df: Dataframe containing the sources from the Pipeline run. If</span>
<span class=sd>            not provided then the `self.sources` dataframe will be used.</span>
<span class=sd>            A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>            peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        matplotlib figure containing the plot.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>  <span class=c1># close any previous ones</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
        <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_int&#39;</span>
        <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_int&#39;</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_peak&#39;</span>
        <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_peak&#39;</span>

    <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>eta_cutoff</span><span class=p>)</span>
    <span class=n>v_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>v_cutoff</span><span class=p>)</span>

    <span class=n>nullfmt</span> <span class=o>=</span> <span class=n>NullFormatter</span><span class=p>()</span>  <span class=c1># no labels</span>

    <span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>12</span><span class=p>))</span>
    <span class=n>ax1</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>221</span><span class=p>)</span>
    <span class=n>ax2</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>222</span><span class=p>)</span>
    <span class=n>ax3</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>223</span><span class=p>)</span>
    <span class=n>ax4</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>224</span><span class=p>)</span>
    <span class=n>fontP</span> <span class=o>=</span> <span class=n>FontProperties</span><span class=p>()</span>
    <span class=n>fontP</span><span class=o>.</span><span class=n>set_size</span><span class=p>(</span><span class=s1>&#39;large&#39;</span><span class=p>)</span>
    <span class=n>fig</span><span class=o>.</span><span class=n>subplots_adjust</span><span class=p>(</span><span class=n>hspace</span><span class=o>=</span><span class=mf>.001</span><span class=p>,</span> <span class=n>wspace</span><span class=o>=</span><span class=mf>0.001</span><span class=p>)</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$\eta_\nu$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$V_\nu$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Max Flux (Jy)&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Max Flux / Median Flux&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span>

    <span class=n>xdata_ax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>xdata_ax4</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>ydata_ax1</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>]</span>
    <span class=n>ydata_ax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>]</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax3</span><span class=p>,</span> <span class=n>ydata_ax1</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>,</span> <span class=n>ydata_ax1</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax3</span><span class=p>,</span> <span class=n>ydata_ax3</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>,</span> <span class=n>ydata_ax3</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span>

    <span class=n>Xax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>Xax4</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>Yax1</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>]</span>
    <span class=n>Yax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>eta_cutoff</span> <span class=o>!=</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>v_cutoff</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>

    <span class=n>ax1</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_xscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>xmin_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Xax3</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
    <span class=n>xmax_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Xax3</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
    <span class=n>xmin_ax4</span> <span class=o>=</span> <span class=mf>0.8</span>
    <span class=n>xmax_ax4</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>)</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
    <span class=n>ymin_ax1</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Yax1</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
    <span class=n>ymax_ax1</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Yax1</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
    <span class=n>ymin_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Yax3</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
    <span class=n>ymax_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Yax3</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ymin_ax1</span><span class=p>,</span> <span class=n>ymax_ax1</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ymin_ax3</span><span class=p>,</span> <span class=n>ymax_ax3</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>xmin_ax3</span><span class=p>,</span> <span class=n>xmax_ax3</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>xmin_ax4</span><span class=p>,</span> <span class=n>xmax_ax4</span><span class=p>)</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>ax3</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ax3</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>ax4</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ax1</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>fig</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class="doc doc-heading"> <code class="highlight language-python"><span class=n>plot_two_epoch_pairs</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch_pair_id</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>vs_min</span><span class=o>=</span><span class=mf>4.3</span><span class=p>,</span> <span class=n>m_min</span><span class=o>=</span><span class=mf>0.26</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>remove_two_forced</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=o>=</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=n>plot_style</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Adapted from code written by Andrew O'Brien. Plot the results of the two epoch analysis. Currently this can only plot one epoch pair at a time.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>epoch_pair_id</code></td> <td><code>int</code></td> <td><p>The epoch pair to plot.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>query</code></td> <td><code>Optional[str]</code></td> <td><p>String query to apply to the dataframe before the analysis is run, defaults to None.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>df</code></td> <td><code>Optional[pandas.core.frame.DataFrame]</code></td> <td><p>Dataframe of sources from the pipeline run, defaults to None. If None then the sources from the PipeAnalysis object are used.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>vs_min</code></td> <td><code>float</code></td> <td><p>The minimum Vs metric value to be considered a candidate, defaults to 4.3.</p></td> <td><code>4.3</code></td> </tr> <tr> <td><code>m_min</code></td> <td><code>float</code></td> <td><p>The minimum m metric absolute value to be considered a candidate, defaults to 0.26.</p></td> <td><code>0.26</code></td> </tr> <tr> <td><code>use_int_flux</code></td> <td><code>bool</code></td> <td><p>Whether to use the integrated fluxes instead of the peak fluxes.</p></td> <td><code>False</code></td> </tr> <tr> <td><code>remove_two_forced</code></td> <td><code>bool</code></td> <td><p>Will exclude any pairs that are both forced extractions if True, defaults to False.</p></td> <td><code>False</code></td> </tr> <tr> <td><code>plot_type</code></td> <td><code>str</code></td> <td><p>Selects whether the returned plot is 'bokeh' or 'matplotlib', defaults to 'bokeh'.</p></td> <td><code>&#39;bokeh&#39;</code></td> </tr> <tr> <td><code>plot_style</code></td> <td><code>str</code></td> <td><p>Select whether to plot with style 'a' (Mooley) or 'b' (Radcliffe). Defaults to 'a'.</p></td> <td><code>&#39;a&#39;</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Union[bokeh.model.Model, figure]</code></td> <td><p>Bokeh or matplotlib figure.</p></td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Exception</code></td> <td><p>The two epoch metrics must be loaded before using this function.</p></td> </tr> <tr> <td><code>Exception</code></td> <td><p>'plot_type' is not recognised.</p></td> </tr> <tr> <td><code>Exception</code></td> <td><p><code>plot_style</code> is not recognised.</p></td> </tr> <tr> <td><code>Exception</code></td> <td><p>Pair with entered ID does not exist.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>plot_two_epoch_pairs</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>epoch_pair_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>vs_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
    <span class=n>m_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.26</span><span class=p>,</span>
    <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>remove_two_forced</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>plot_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>,</span>
    <span class=n>plot_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Model</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Adapted from code written by Andrew O&#39;Brien.</span>
<span class=sd>    Plot the results of the two epoch analysis. Currently this can only</span>
<span class=sd>    plot one epoch pair at a time.</span>

<span class=sd>    Args:</span>
<span class=sd>        epoch_pair_id: The epoch pair to plot.</span>
<span class=sd>        query: String query to apply to the dataframe before the analysis</span>
<span class=sd>            is run, defaults to None.</span>
<span class=sd>        df: Dataframe of sources from the pipeline run, defaults to None.</span>
<span class=sd>            If None then the sources from the PipeAnalysis object are used.</span>
<span class=sd>        vs_min: The minimum Vs metric value to be considered a candidate,</span>
<span class=sd>            defaults to 4.3.</span>
<span class=sd>        m_min: The minimum m metric absolute value to be considered a</span>
<span class=sd>            candidate, defaults to 0.26.</span>
<span class=sd>        use_int_flux: Whether to use the integrated fluxes instead of the</span>
<span class=sd>            peak fluxes.</span>
<span class=sd>        remove_two_forced: Will exclude any pairs that are both forced</span>
<span class=sd>            extractions if True, defaults to False.</span>
<span class=sd>        plot_type: Selects whether the returned plot is &#39;bokeh&#39; or</span>
<span class=sd>            &#39;matplotlib&#39;, defaults to &#39;bokeh&#39;.</span>
<span class=sd>        plot_style: Select whether to plot with style &#39;a&#39; (Mooley)</span>
<span class=sd>            or &#39;b&#39; (Radcliffe). Defaults to &#39;a&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Bokeh or matplotlib figure.</span>

<span class=sd>    Raises:</span>
<span class=sd>        Exception: The two epoch metrics must be loaded before using this</span>
<span class=sd>            function.</span>
<span class=sd>        Exception: &#39;plot_type&#39; is not recognised.</span>
<span class=sd>        Exception: `plot_style` is not recognised.</span>
<span class=sd>        Exception: Pair with entered ID does not exist.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;The two epoch metrics must first be loaded to use the&quot;</span>
            <span class=s2>&quot; plotting function. Please do so with the command:</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;&#39;mypiperun.load_two_epoch_metrics()&#39;</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;and try again.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=s1>&#39;matplotlib&#39;</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;&#39;plot_type&#39; value is not recognised!&quot;</span>
            <span class=s2>&quot; Must be either &#39;bokeh&#39; or &#39;matplotlib&#39;.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>plot_style</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;&#39;plot_style&#39; value is not recognised!&quot;</span>
            <span class=s2>&quot; Must be either &#39;a&#39; for Mooley or &#39;b&#39; for Radcliffe.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>epoch_pair_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Pair with ID &#39;</span><span class=si>{</span><span class=n>epoch_pair_id</span><span class=si>}</span><span class=s2>&#39; does not exist!&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

    <span class=n>pair_epoch_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>epoch_pair_id</span><span class=p>][</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>pair_epoch_key</span> <span class=o>==</span> <span class=n>pair_epoch_key</span>
        <span class=p>]</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=o>==</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>:</span>
        <span class=n>fig</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_epoch_pair_bokeh</span><span class=p>(</span>
            <span class=n>epoch_pair_id</span><span class=p>,</span>
            <span class=n>pairs_df</span><span class=p>,</span>
            <span class=n>vs_min</span><span class=p>,</span>
            <span class=n>m_min</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=p>,</span>
            <span class=n>remove_two_forced</span><span class=p>,</span>
            <span class=n>plot_style</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>fig</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_epoch_pair_matplotlib</span><span class=p>(</span>
            <span class=n>epoch_pair_id</span><span class=p>,</span>
            <span class=n>pairs_df</span><span class=p>,</span>
            <span class=n>vs_min</span><span class=p>,</span>
            <span class=n>m_min</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=p>,</span>
            <span class=n>remove_two_forced</span><span class=p>,</span>
            <span class=n>plot_style</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>fig</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeAnalysis.recalc_sources_df class="doc doc-heading"> <code class="highlight language-python"><span class=n>recalc_sources_df</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>measurements_df</span><span class=p>,</span> <span class=n>min_vs</span><span class=o>=</span><span class=mf>4.3</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.recalc_sources_df class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Regenerates a sources dataframe using a user provided measurements dataframe.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>measurements_df</code></td> <td><code>DataFrame</code></td> <td><p>Dataframe of measurements with default pipeline columns. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>min_vs</code></td> <td><code>float</code></td> <td><p>Minimum value of the Vs two epoch parameter to use when appending the two epoch metrics maximum.</p></td> <td><code>4.3</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>DataFrame</code></td> <td><p>The regenerated sources_df. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>recalc_sources_df</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>measurements_df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>min_vs</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Regenerates a sources dataframe using a user provided measurements</span>
<span class=sd>    dataframe.</span>

<span class=sd>    Args:</span>
<span class=sd>        measurements_df: Dataframe of measurements with default pipeline</span>
<span class=sd>            columns. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        min_vs: Minimum value of the Vs two epoch parameter to use</span>
<span class=sd>            when appending the two epoch metrics maximum.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The regenerated sources_df.  A `pandas.core.frame.DataFrame`</span>
<span class=sd>        instance.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>)</span>

    <span class=c1># account for RA wrapping</span>
    <span class=n>ra_wrap_mask</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>ra</span> <span class=o>&lt;=</span> <span class=mf>0.1</span>
    <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra_wrap&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
        <span class=n>ra_wrap_mask</span><span class=p>,</span> <span class=n>measurements_df</span><span class=p>[</span><span class=n>ra_wrap_mask</span><span class=p>]</span><span class=o>.</span><span class=n>ra</span> <span class=o>+</span> <span class=mf>360.</span><span class=p>,</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;interim_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
       <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra_wrap&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;interim_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
       <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>]:</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_sq&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>measurements_df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>**</span> <span class=mf>2.</span><span class=p>)</span>

    <span class=c1># most of the aggregate calculations done in vaex</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
        <span class=n>by</span><span class=o>=</span><span class=s1>&#39;source&#39;</span><span class=p>,</span>
        <span class=n>agg</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;interim_ew&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;interim_ns&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;avg_compactness&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span>
                <span class=s1>&#39;compactness&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;min_snr&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span>
                <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;max_snr&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span>
                <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;avg_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
            <span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
            <span class=s1>&#39;max_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
            <span class=s1>&#39;max_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_peak_isl_ratio&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_int_isl_ratio&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_measurements&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_selavy&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_forced&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==True&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_siblings&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=s1>&#39;has_siblings&#39;</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=c1># Drop sources which no longer have any selavy measurements</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=n>sources_df</span><span class=o>.</span><span class=n>n_selavy</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>

    <span class=c1># Calculate average position</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>])</span>
    <span class=p>)</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>])</span>
    <span class=p>)</span>

    <span class=c1># the RA wrapping is reverted at the end of the function when the</span>
    <span class=c1># df is in pandas format.</span>

    <span class=c1># TraP variability metrics, using Dask.</span>
    <span class=n>measurements_df_temp</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=p>[[</span>
        <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span>
    <span class=p>]]</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=n>col_dtype</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;eta_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;eta_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
    <span class=p>}</span>

    <span class=n>sources_df_fluxes</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements_df_temp</span><span class=p>,</span> <span class=n>HOST_NCPU</span><span class=p>)</span>
        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=n>pipeline_get_variable_metrics</span><span class=p>,</span>
            <span class=n>meta</span><span class=o>=</span><span class=n>col_dtype</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=n>num_workers</span><span class=o>=</span><span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=s1>&#39;processes&#39;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># Switch to pandas at this point to perform join</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_fluxes</span><span class=p>)</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>[[</span><span class=s1>&#39;new&#39;</span><span class=p>,</span> <span class=s1>&#39;new_high_sigma&#39;</span><span class=p>]],</span>
    <span class=p>)</span>

    <span class=c1># Two epoch metrics</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>load_two_epoch_metrics</span><span class=p>()</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=p>[</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>vs_int</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span>
                <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>vs_peak</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span>
            <span class=p>]</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>min_vs_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_or</span><span class=p>(</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>vs_int</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>vs_peak</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span><span class=p>)</span><span class=o>.</span><span class=n>values</span>
        <span class=p>)</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>min_vs_mask</span><span class=p>]</span>

    <span class=c1># make masks of dropped measurements</span>
    <span class=n>mask_a</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>meas_id_a</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
        <span class=n>measurements_df</span><span class=o>.</span><span class=n>id</span><span class=o>.</span><span class=n>values</span>
    <span class=p>)</span><span class=o>.</span><span class=n>values</span>

    <span class=n>mask_b</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>meas_id_b</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
        <span class=n>measurements_df</span><span class=o>.</span><span class=n>id</span><span class=o>.</span><span class=n>values</span>
    <span class=p>)</span><span class=o>.</span><span class=n>values</span>

    <span class=n>meas_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_and</span><span class=p>(</span><span class=n>mask_a</span><span class=p>,</span> <span class=n>mask_b</span><span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;mask_a&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>mask_a</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;mask_b&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>mask_b</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=p>[</span>
            <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>mask_a</span> <span class=o>==</span> <span class=kc>True</span>
            <span class=ow>and</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>mask_b</span> <span class=o>==</span> <span class=kc>True</span>
        <span class=p>]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>meas_mask</span><span class=p>]</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>new_measurement_pairs</span><span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_int_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>vs_int</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_peak_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>vs_peak</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_int_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>m_int</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_peak_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>m_peak</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>sources_df_two_epochs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
        <span class=s1>&#39;source_id&#39;</span><span class=p>,</span>
        <span class=n>agg</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;vs_max_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;vs_int_abs&#39;</span><span class=p>),</span>
            <span class=s1>&#39;vs_max_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;vs_peak_abs&#39;</span><span class=p>),</span>
            <span class=s1>&#39;m_abs_max_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;m_int_abs&#39;</span><span class=p>),</span>
            <span class=s1>&#39;m_abs_max_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;m_peak_abs&#39;</span><span class=p>),</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>sources_df_two_epochs</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df_two_epochs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;source_id&#39;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># keep this here for when pipeline udpated.</span>
    <span class=c1># sources_df_two_epochs = sources_df_two_epochs.fillna(value={</span>
    <span class=c1>#      &quot;vs_significant_max_peak&quot;: 0.0,</span>
    <span class=c1>#      &quot;m_abs_significant_max_peak&quot;: 0.0,</span>
    <span class=c1>#      &quot;vs_significant_max_int&quot;: 0.0,</span>
    <span class=c1>#      &quot;m_abs_significant_max_int&quot;: 0.0,</span>
    <span class=c1>#  })</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_two_epochs</span><span class=p>)</span>

    <span class=k>del</span> <span class=n>sources_df_two_epochs</span>

    <span class=c1># new relation numbers</span>
    <span class=n>relation_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_and</span><span class=p>(</span>
        <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>from_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>sources_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)),</span>
        <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>to_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>sources_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>))</span>
    <span class=p>)</span>

    <span class=n>new_relations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_mask</span><span class=p>]</span>

    <span class=n>sources_df_relations</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_relations</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;from_source_id&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;to_source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;n_relations&#39;</span><span class=p>})</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_relations</span><span class=p>)</span>

    <span class=c1># nearest neighbour</span>
    <span class=n>sources_sky_coord</span> <span class=o>=</span> <span class=n>gen_skycoord_from_df</span><span class=p>(</span>
        <span class=n>sources_df</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=s1>&#39;wavg_dec&#39;</span>
    <span class=p>)</span>

    <span class=n>idx</span><span class=p>,</span> <span class=n>d2d</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>sources_sky_coord</span><span class=o>.</span><span class=n>match_to_catalog_sky</span><span class=p>(</span>
        <span class=n>sources_sky_coord</span><span class=p>,</span> <span class=n>nthneighbor</span><span class=o>=</span><span class=mi>2</span>
    <span class=p>)</span>

    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_neighbour_dist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>d2d</span><span class=o>.</span><span class=n>degree</span>

    <span class=c1># Fill the NaN values.</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=p>{</span>
        <span class=c1># keep this here for when pipeline udpated.</span>
        <span class=c1># &quot;vs_significant_max_peak&quot;: 0.0,</span>
        <span class=c1># &quot;m_abs_significant_max_peak&quot;: 0.0,</span>
        <span class=c1># &quot;vs_significant_max_int&quot;: 0.0,</span>
        <span class=c1># &quot;m_abs_significant_max_int&quot;: 0.0,</span>
        <span class=s2>&quot;vs_max_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s2>&quot;vs_max_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s2>&quot;m_abs_max_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s2>&quot;m_abs_max_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s1>&#39;n_relations&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
        <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=mf>0.</span><span class=p>,</span>
        <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=mf>0.</span>
    <span class=p>})</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span>
        <span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>,</span> <span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>,</span> <span class=s1>&#39;weight_ns_sum&#39;</span>
    <span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=c1># correct the RA wrapping</span>
    <span class=n>ra_wrap_mask</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mf>360.</span>
    <span class=n>sources_df</span><span class=o>.</span><span class=n>at</span><span class=p>[</span>
        <span class=n>ra_wrap_mask</span><span class=p>,</span> <span class=s1>&#39;wavg_ra&#39;</span>
    <span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=n>ra_wrap_mask</span><span class=p>]</span><span class=o>.</span><span class=n>wavg_ra</span><span class=o>.</span><span class=n>values</span> <span class=o>-</span> <span class=mf>360.</span>

    <span class=c1># Switch relations column to int</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_relations&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_relations&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>sources_df</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_eta_v_analysis</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>eta_sigma</span><span class=p>,</span> <span class=n>v_sigma</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=o>=</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=n>diagnostic</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Run the eta, v analysis on the pipeline run, with optional inputs to use a query or filtered dataframe (see Rowlinson et al., 2018, https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>eta_sigma</code></td> <td><code>float</code></td> <td><p>The minimum sigma value of the eta distribution to be used as a threshold.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>v_sigma</code></td> <td><code>float</code></td> <td><p>The minimum sigma value of the v distribution to be used as a threshold.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>query</code></td> <td><code>Optional[str]</code></td> <td><p>String query to apply to the dataframe before the analysis is run, defaults to None.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>df</code></td> <td><code>Optional[pandas.core.frame.DataFrame]</code></td> <td><p>Dataframe of sources from the pipeline run, defaults to None. If None then the sources from the PipeAnalysis object are used.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>use_int_flux</code></td> <td><code>bool</code></td> <td><p>Use integrated fluxes for the analysis instead of peak fluxes, defaults to 'False'.</p></td> <td><code>False</code></td> </tr> <tr> <td><code>plot_type</code></td> <td><code>str</code></td> <td><p>Select which format the candidates plot should be returned in. Either 'bokeh' or 'matplotlib', defaults to 'bokeh'.</p></td> <td><code>&#39;bokeh&#39;</code></td> </tr> <tr> <td><code>diagnostic</code></td> <td><code>bool</code></td> <td><p>When 'True' the diagnostic plot is also returned, defaults to 'False'.</p></td> <td><code>False</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Union[Tuple[float, float, pandas.core.frame.DataFrame, figure, figure], Tuple[float, float, pandas.core.frame.DataFrame, gridplot, figure]]</code></td> <td><p>Tuple containing the eta cutoff value, the v cutoff value, dataframe of candidates, candidates plot and, if selected, the diagnostic plot.</p></td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Exception</code></td> <td><p>Entered <code>plot_type</code> is not a valid plot type.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>run_eta_v_analysis</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>eta_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>v_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
    <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>,</span>
    <span class=n>diagnostic</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span>
    <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>],</span>
    <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>gridplot</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>]</span>
<span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run the eta, v analysis on the pipeline run, with optional</span>
<span class=sd>    inputs to use a query or filtered dataframe (see Rowlinson</span>
<span class=sd>    et al., 2018,</span>
<span class=sd>    https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>

<span class=sd>    Args:</span>
<span class=sd>        eta_sigma: The minimum sigma value of the eta distribution</span>
<span class=sd>            to be used as a threshold.</span>
<span class=sd>        v_sigma: The minimum sigma value of the v distribution</span>
<span class=sd>            to be used as a threshold.</span>
<span class=sd>        query: String query to apply to the dataframe before</span>
<span class=sd>            the analysis is run, defaults to None.</span>
<span class=sd>        df: Dataframe of sources from the pipeline run, defaults</span>
<span class=sd>            to None. If None then the sources from the PipeAnalysis object</span>
<span class=sd>            are used.</span>
<span class=sd>        use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>            peak fluxes, defaults to &#39;False&#39;.</span>
<span class=sd>        plot_type: Select which format the candidates plot should be</span>
<span class=sd>            returned in. Either &#39;bokeh&#39; or &#39;matplotlib&#39;, defaults</span>
<span class=sd>            to &#39;bokeh&#39;.</span>
<span class=sd>        diagnostic: When &#39;True&#39; the diagnostic plot is also returned,</span>
<span class=sd>            defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Tuple containing the eta cutoff value, the v cutoff value,</span>
<span class=sd>        dataframe of candidates, candidates plot and, if selected, the</span>
<span class=sd>        diagnostic plot.</span>

<span class=sd>    Raise:</span>
<span class=sd>        Exception: Entered `plot_type` is not a valid plot type.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>plot_types</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=s1>&#39;matplotlib&#39;</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>plot_types</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;Not a valid plot type!&quot;</span>
            <span class=s2>&quot; Must be &#39;bokeh&#39; or &#39;matplotlib&#39;.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

    <span class=p>(</span>
        <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
        <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span>
    <span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fit_eta_v</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span><span class=p>)</span>

    <span class=n>v_cutoff</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=p>(</span><span class=n>v_fit_mean</span> <span class=o>+</span> <span class=n>v_sigma</span> <span class=o>*</span> <span class=n>v_fit_sigma</span><span class=p>)</span>
    <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=p>(</span><span class=n>eta_fit_mean</span> <span class=o>+</span> <span class=n>eta_sigma</span> <span class=o>*</span> <span class=n>eta_fit_sigma</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=o>==</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>:</span>
        <span class=n>plot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_eta_v_bokeh</span><span class=p>(</span>
            <span class=n>df</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
            <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>plot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_eta_v_matplotlib</span><span class=p>(</span>
            <span class=n>df</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
            <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
        <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;int&#39;</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;peak&#39;</span>

    <span class=n>candidates</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
        <span class=s2>&quot;v_</span><span class=si>{0}</span><span class=s2> &gt; </span><span class=si>{1}</span><span class=s2> &quot;</span>
        <span class=s2>&quot;&amp; eta_</span><span class=si>{0}</span><span class=s2> &gt; </span><span class=si>{2}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>label</span><span class=p>,</span>
            <span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>eta_cutoff</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>diagnostic</span><span class=p>:</span>
        <span class=n>diag</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>eta_v_diagnostic_plot</span><span class=p>(</span>
            <span class=n>df</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>plot</span><span class=p>,</span> <span class=n>diag</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>plot</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_two_epoch_analysis</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>m</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Run the two epoch analysis on the pipeline run, with optional inputs to use a query or filtered dataframe.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>v</code></td> <td><code>float</code></td> <td><p>The minimum Vs metric value to be considered a candidate.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>m</code></td> <td><code>float</code></td> <td><p>The minimum m metric absolute value to be considered a candidate.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>query</code></td> <td><code>Optional[str]</code></td> <td><p>String query to apply to the dataframe before the analysis is run, defaults to None.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>df</code></td> <td><code>Optional[pandas.core.frame.DataFrame]</code></td> <td><p>Dataframe of sources from the pipeline run, defaults to None. If None then the sources from the PipeAnalysis object are used.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>use_int_flux</code></td> <td><code>bool</code></td> <td><p>Use integrated fluxes for the analysis instead of peak fluxes, defaults to 'False'.</p></td> <td><code>False</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Tuple[pandas.core.frame.DataFrame, pandas.core.frame.DataFrame]</code></td> <td><p>Tuple containing two dataframes of the candidate sources and pairs.</p></td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Exception</code></td> <td><p>The two epoch metrics must be loaded before using this function.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>run_two_epoch_analysis</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>v</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>m</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run the two epoch analysis on the pipeline run, with optional</span>
<span class=sd>    inputs to use a query or filtered dataframe.</span>

<span class=sd>    Args:</span>
<span class=sd>        v: The minimum Vs metric value to be considered a candidate.</span>
<span class=sd>        m: The minimum m metric absolute value to be considered a</span>
<span class=sd>            candidate.</span>
<span class=sd>        query: String query to apply to the dataframe before the analysis</span>
<span class=sd>            is run, defaults to None.</span>
<span class=sd>        df: Dataframe of sources from the pipeline run, defaults to None.</span>
<span class=sd>            If None then the sources from the PipeAnalysis object are used.</span>
<span class=sd>        use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>            peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Tuple containing two dataframes of the candidate sources and pairs.</span>

<span class=sd>    Raises:</span>
<span class=sd>        Exception: The two epoch metrics must be loaded before using this</span>
<span class=sd>            function.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;The two epoch metrics must first be loaded to use the&quot;</span>
            <span class=s2>&quot; plotting function. Please do so with the command:</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;&#39;mypiperun.load_two_epoch_metrics()&#39;</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;and try again.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

    <span class=n>allowed_sources</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span>
                <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span>
            <span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span>
            <span class=p>]</span>

    <span class=n>vs_label</span> <span class=o>=</span> <span class=s1>&#39;vs_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;vs_peak&#39;</span>
    <span class=n>m_abs_label</span> <span class=o>=</span> <span class=s1>&#39;m_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;m_peak&#39;</span>

    <span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>

    <span class=c1># If vaex convert these to pandas</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span>
            <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>v</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>m</span><span class=p>)</span>
        <span class=p>]</span>

        <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>candidate_pairs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>v</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>m</span><span class=p>)</span>
        <span class=p>]</span>

    <span class=n>unique_sources</span> <span class=o>=</span> <span class=n>candidate_pairs</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>unique</span><span class=p>()</span>

    <span class=n>candidate_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>unique_sources</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>candidate_sources</span><span class=p>,</span> <span class=n>candidate_pairs</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.Pipeline class="doc doc-heading"> <code>Pipeline</code> <a href=#vasttools.pipeline.Pipeline class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Class to interface with VAST Pipeline results.</p> <p><strong>Attributes:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>project_dir</code></td> <td><code>str</code></td> <td><p>The pipeline project directory provided by the user on initialisation.</p></td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.Pipeline.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_dir</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a href=#vasttools.pipeline.Pipeline.__init__ class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Constructor method.</p> <p>The system variable <code>PIPELINE_WORKING_DIR</code> will be checked first with the project_dir input the fallback option.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>project_dir</code></td> <td><code>Optional[str]</code></td> <td><p>The directory of the pipeline results. Only required when the system variable is not defined, defaults to 'None'.</p></td> <td><code>None</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>None</code></td> <td><p>None</p></td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Exception</code></td> <td><p>The <code>PIPELINE_WORKING_DIR</code> could not be determined.</p></td> </tr> <tr> <td><code>Exception</code></td> <td><p>Pipeline run directory is not found.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Constructor method.</span>

<span class=sd>    The system variable `PIPELINE_WORKING_DIR` will be checked</span>
<span class=sd>    first with the project_dir input the fallback option.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_dir: The directory of the pipeline results. Only required</span>
<span class=sd>            when the system variable is not defined, defaults to &#39;None&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>

<span class=sd>    Raises:</span>
<span class=sd>        Exception: The `PIPELINE_WORKING_DIR` could not be determined.</span>
<span class=sd>        Exception: Pipeline run directory is not found.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=nb>super</span><span class=p>(</span><span class=n>Pipeline</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>project_dir</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>pipeline_run_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;PIPELINE_WORKING_DIR&#39;</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
                <span class=s2>&quot;The pipeline run directory could not be determined!&quot;</span>
                <span class=s2>&quot; Either the system environment &#39;PIPELINE_WORKING_DIR&#39;&quot;</span>
                <span class=s2>&quot; must be defined or the &#39;project_dir&#39; argument defined&quot;</span>
                <span class=s2>&quot; when initialising the pipeline class object.&quot;</span>
            <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>pipeline_run_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>project_dir</span><span class=p>))</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>pipeline_run_path</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;Pipeline run directory </span><span class=si>{}</span><span class=s2> not found!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>pipeline_run_path</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span> <span class=o>=</span> <span class=n>pipeline_run_path</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.Pipeline.list_images class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_images</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.list_images class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Lists all images processed in the pipeline directory.</p> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>List[str]</code></td> <td><p>List of images processed.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>list_images</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Lists all images processed in the pipeline directory.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List of images processed.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>img_list</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span> <span class=s2>&quot;images&quot;</span><span class=p>,</span> <span class=s2>&quot;*&quot;</span><span class=p>)</span>
    <span class=p>))</span>

    <span class=n>img_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>img_list</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>img_list</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.Pipeline.list_piperuns class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_piperuns</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.list_piperuns class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Lists the runs present in the pipeline directory.</p> <p>Note this just list the directories, i.e. it is not known whether the runs are actually processed.</p> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>List[str]</code></td> <td><p>List of pipeline run names present in directory.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>list_piperuns</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Lists the runs present in the pipeline directory.</span>

<span class=sd>    Note this just list the directories, i.e. it is not known whether the</span>
<span class=sd>    runs are actually processed.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List of pipeline run names present in directory.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>jobs</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span> <span class=s2>&quot;*&quot;</span><span class=p>)</span>
    <span class=p>))</span>

    <span class=n>jobs</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>jobs</span><span class=p>]</span>
    <span class=n>jobs</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>jobs</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.Pipeline.load_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>run_name</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=mi>11</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.load_run class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Process and load a pipeline run.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>run_name</code></td> <td><code>str</code></td> <td><p>The name of the run to load.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>n_workers</code></td> <td><code>int</code></td> <td><p>The number of workers (cpus) available.</p></td> <td><code>11</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>PipeAnalysis</code></td> <td><p>PipeAnalysis object.</p></td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ValueError</code></td> <td><p>Entered pipeline run does not exist.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>load_run</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>run_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Process and load a pipeline run.</span>

<span class=sd>    Args:</span>
<span class=sd>        run_name: The name of the run to load.</span>
<span class=sd>        n_workers: The number of workers (cpus) available.</span>

<span class=sd>    Returns:</span>
<span class=sd>        PipeAnalysis object.</span>

<span class=sd>    Raises:</span>
<span class=sd>        ValueError: Entered pipeline run does not exist.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>run_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span>
        <span class=n>run_name</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>run_dir</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;Run &#39;</span><span class=si>%s</span><span class=s2>&#39; does not exist!&quot;</span><span class=p>,</span>
            <span class=n>run_name</span>
        <span class=p>)</span>
        <span class=k>return</span>

    <span class=n>images</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;images.parquet&#39;</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>skyregions</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;skyregions.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>bands</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;bands.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>images</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>skyregions</span><span class=p>[[</span>
            <span class=s1>&#39;id&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_ra&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_dec&#39;</span><span class=p>,</span>
            <span class=s1>&#39;xtr_radius&#39;</span>
        <span class=p>]],</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>,</span>
        <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=s1>&#39;id_y&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id_x&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>}</span>
    <span class=p>)</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>  <span class=c1># second merge for band</span>
        <span class=n>bands</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;frequency&#39;</span><span class=p>,</span> <span class=s1>&#39;bandwidth&#39;</span><span class=p>]],</span>
        <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;band_id&#39;</span><span class=p>,</span>
        <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=s1>&#39;id_y&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id_x&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>}</span>
    <span class=p>)</span>

    <span class=n>relations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;relations.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>sources</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;sources.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>to_move</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>,</span> <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>,</span> <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>,</span> <span class=s1>&#39;n_sibl&#39;</span><span class=p>,</span> <span class=s1>&#39;n_rel&#39;</span><span class=p>]</span>
    <span class=n>sources_len</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>to_move</span><span class=p>:</span>
        <span class=n>col</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
        <span class=n>sources</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>sources_len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>

    <span class=n>sources</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>:</span> <span class=s1>&#39;n_forced&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_meas&#39;</span><span class=p>:</span> <span class=s1>&#39;n_measurements&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>:</span> <span class=s1>&#39;n_selavy&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_sibl&#39;</span><span class=p>:</span> <span class=s1>&#39;n_siblings&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_rel&#39;</span><span class=p>:</span> <span class=s1>&#39;n_relations&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>associations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;associations.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>vaex_meas</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>run_dir</span><span class=p>,</span>
        <span class=s1>&#39;measurements.arrow&#39;</span>
    <span class=p>)):</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>open</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>run_dir</span><span class=p>,</span> <span class=s1>&#39;measurements.arrow&#39;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>vaex_meas</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurements have been loaded with vaex.&quot;</span><span class=p>)</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>m_files</span> <span class=o>=</span> <span class=n>images</span><span class=p>[</span><span class=s1>&#39;measurements_path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
        <span class=n>m_files</span> <span class=o>+=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;forced_measurements*.parquet&quot;</span>
        <span class=p>)))</span>

        <span class=c1># use dask to open measurement parquets</span>
        <span class=c1># as they are spread over many different files</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>m_files</span><span class=p>,</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>

        <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>associations</span><span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
        <span class=p>]</span>

        <span class=n>measurements</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>associations</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>,</span> <span class=s1>&#39;source_id&#39;</span><span class=p>]]</span>
            <span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;meas_id&#39;</span><span class=p>)</span>
            <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
                <span class=n>measurements</span><span class=p>,</span>
                <span class=n>left_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
            <span class=p>)</span>
            <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;source&#39;</span><span class=p>})</span>
        <span class=p>)</span>

    <span class=n>images</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>run_dir</span><span class=p>,</span>
        <span class=s2>&quot;measurement_pairs.arrow&quot;</span>
    <span class=p>)):</span>
        <span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;measurement_pairs.arrow&quot;</span>
        <span class=p>)]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;measurement_pairs.parquet&quot;</span>
        <span class=p>)]</span>

    <span class=n>piperun</span> <span class=o>=</span> <span class=n>PipeAnalysis</span><span class=p>(</span>
        <span class=n>name</span><span class=o>=</span><span class=n>run_name</span><span class=p>,</span>
        <span class=n>images</span><span class=o>=</span><span class=n>images</span><span class=p>,</span>
        <span class=n>skyregions</span><span class=o>=</span><span class=n>skyregions</span><span class=p>,</span>
        <span class=n>relations</span><span class=o>=</span><span class=n>relations</span><span class=p>,</span>
        <span class=n>sources</span><span class=o>=</span><span class=n>sources</span><span class=p>,</span>
        <span class=n>associations</span><span class=o>=</span><span class=n>associations</span><span class=p>,</span>
        <span class=n>measurements</span><span class=o>=</span><span class=n>measurements</span><span class=p>,</span>
        <span class=n>measurement_pairs_file</span><span class=o>=</span><span class=n>measurement_pairs_file</span><span class=p>,</span>
        <span class=n>vaex_meas</span><span class=o>=</span><span class=n>vaex_meas</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>piperun</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.Pipeline.load_runs class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_runs</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>run_names</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=mi>11</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.load_runs class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Wrapper to load multiple runs in one command.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>run_names</code></td> <td><code>List[str]</code></td> <td><p>List containing the names of the runs to load.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>name</code></td> <td><code>Optional[str]</code></td> <td><p>A name for the resulting pipeline run.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>n_workers</code></td> <td><code>int</code></td> <td><p>The number of workers (cpus) available.</p></td> <td><code>11</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>PipeAnalysis</code></td> <td><p>Combined PipeAnalysis object.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>load_runs</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>run_names</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Wrapper to load multiple runs in one command.</span>

<span class=sd>    Args:</span>
<span class=sd>        run_names: List containing the names of the runs to load.</span>
<span class=sd>        name: A name for the resulting pipeline run.</span>
<span class=sd>        n_workers: The number of workers (cpus) available.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Combined PipeAnalysis object.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>piperun</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_run</span><span class=p>(</span>
        <span class=n>run_names</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
        <span class=n>n_workers</span><span class=o>=</span><span class=n>n_workers</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>run_names</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>run_names</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
            <span class=n>piperun</span> <span class=o>=</span> <span class=n>piperun</span><span class=o>.</span><span class=n>combine_with_run</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>load_run</span><span class=p>(</span>
                    <span class=n>r</span><span class=p>,</span>
                    <span class=n>n_workers</span><span class=o>=</span><span class=n>n_workers</span>
                <span class=p>)</span>
            <span class=p>)</span>
    <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>piperun</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>

    <span class=k>return</span> <span class=n>piperun</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.PipeRun class="doc doc-heading"> <code>PipeRun</code> <a href=#vasttools.pipeline.PipeRun class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Class that represents a Pipeline run.</p> <p><strong>Attributes:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>associations</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Associations dataframe from the pipeline run loaded from 'associations.parquet'.</p></td> </tr> <tr> <td><code>images</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the images of the pipeline run.</p></td> </tr> <tr> <td><code>measurements</code></td> <td><code>Union[pd.DataFrame, vaex.dataframe.DataFrame]</code></td> <td><p>Dataframe containing all the information on the measurements of the pipeline run.</p></td> </tr> <tr> <td><code>measurement_pairs_file</code></td> <td><code>List[str]</code></td> <td><p>List containing the locations of the measurement_pairs.parquet (or.arrow) file(s).</p></td> </tr> <tr> <td><code>name</code></td> <td><code>str</code></td> <td><p>The pipeline run name.</p></td> </tr> <tr> <td><code>n_workers</code></td> <td><code>int</code></td> <td><p>Number of workers (cpus) available.</p></td> </tr> <tr> <td><code>relations</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the relations of the pipeline run.</p></td> </tr> <tr> <td><code>skyregions</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the skyregions of the pipeline run.</p></td> </tr> <tr> <td><code>sources</code></td> <td><code>pandas.core.frame.DataFrame</code></td> <td><p>Dataframe containing all the information on the sources of the pipeline run.</p></td> </tr> <tr> <td><code>sources_skycoord</code></td> <td><code>astroy.coordinates.SkyCoord</code></td> <td><p>A SkyCoord object of the default sources attribute.</p></td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span> <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=mi>11</span><span class=p>)</span></code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a href=#vasttools.pipeline.PipeRun.__init__ class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Constructor method.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>name</code></td> <td><code>str</code></td> <td><p>The name of the pipeline run.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>images</code></td> <td><code>DataFrame</code></td> <td><p>Images dataframe from the pipeline run loaded from 'images.parquet'. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>skyregions</code></td> <td><code>DataFrame</code></td> <td><p>Skyregions dataframe from the pipeline run loaded from skyregions.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>relations</code></td> <td><code>DataFrame</code></td> <td><p>Relations dataframe from the pipeline run loaded from relations.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>sources</code></td> <td><code>DataFrame</code></td> <td><p>Sources dataframe from the pipeline run loaded from sources.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>associations</code></td> <td><code>DataFrame</code></td> <td><p>Associations dataframe from the pipeline run loaded from 'associations.parquet'. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>measurements</code></td> <td><code>Union[pandas.core.frame.DataFrame, vaex.dataframe.DataFrame]</code></td> <td><p>Measurements dataframe from the pipeline run loaded from measurements.parquet and the forced measurements parquet files. A <code>pandas.core.frame.DataFrame</code> or <code>vaex.dataframe.DataFrame</code> instance.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>measurement_pairs_file</code></td> <td><code>List[str]</code></td> <td><p>The location of the two epoch pairs file from the pipeline. It is a list of locations due to the fact that two pipeline runs could be combined.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>vaex_meas</code></td> <td><code>bool</code></td> <td><p>'True' if the measurements have been loaded using vaex from an arrow file. <code>False</code> means the measurements are loaded into a pandas DataFrame.</p></td> <td><code>False</code></td> </tr> <tr> <td><code>n_workers</code></td> <td><code>int</code></td> <td><p>Number of workers (cpus) available. Default is determined by running <code>cpu_count()</code>.</p></td> <td><code>11</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>None</code></td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>skyregions</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>relations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>sources</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>associations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>measurements</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
    <span class=n>measurement_pairs_file</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
    <span class=n>vaex_meas</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Constructor method.</span>

<span class=sd>    Args:</span>
<span class=sd>        name: The name of the pipeline run.</span>
<span class=sd>        images: Images dataframe from the pipeline run loaded from</span>
<span class=sd>            &#39;images.parquet&#39;. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        skyregions: Skyregions dataframe from the pipeline run loaded from</span>
<span class=sd>            skyregions.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        relations: Relations dataframe from the pipeline run loaded from</span>
<span class=sd>            relations.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        sources: Sources dataframe from the pipeline run loaded from</span>
<span class=sd>            sources.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        associations: Associations dataframe from the pipeline run loaded</span>
<span class=sd>            from &#39;associations.parquet&#39;. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        measurements: Measurements dataframe from the pipeline run</span>
<span class=sd>            loaded from measurements.parquet and the forced measurements</span>
<span class=sd>            parquet files.  A `pandas.core.frame.DataFrame` or</span>
<span class=sd>            `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>        measurement_pairs_file: The location of the two epoch pairs file</span>
<span class=sd>            from the pipeline. It is a list of locations due to the fact</span>
<span class=sd>            that two pipeline runs could be combined.</span>
<span class=sd>        vaex_meas: &#39;True&#39; if the measurements have been loaded using</span>
<span class=sd>            vaex from an arrow file. `False` means the measurements are</span>
<span class=sd>            loaded into a pandas DataFrame.</span>
<span class=sd>        n_workers: Number of workers (cpus) available. Default is</span>
<span class=sd>            determined by running `cpu_count()`.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=nb>super</span><span class=p>(</span><span class=n>PipeRun</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>images</span> <span class=o>=</span> <span class=n>images</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span> <span class=o>=</span> <span class=n>skyregions</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=n>sources</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sources_skycoord</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>associations</span> <span class=o>=</span> <span class=n>associations</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=n>measurement_pairs_file</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>relations</span> <span class=o>=</span> <span class=n>relations</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span> <span class=o>=</span> <span class=n>n_workers</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=o>=</span> <span class=n>vaex_meas</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span> <span class=o>=</span> <span class=kc>False</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.check_for_planets class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_for_planets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.check_for_planets class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Checks the pipeline run for any planets in the field.</p> <p>All planets are checked: Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto in addition to the Sun and Moon.</p> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>DataFrame</code></td> <td><p>DataFrame with list of planet positions. It will be empty if no planets are found. A <code>pandas.core.frame.DataFrame</code> instance.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>check_for_planets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Checks the pipeline run for any planets in the field.</span>

<span class=sd>    All planets are checked: Mercury, Venus, Mars, Jupiter,</span>
<span class=sd>    Saturn, Uranus, Neptune, Pluto in addition to the Sun and Moon.</span>

<span class=sd>    Returns:</span>
<span class=sd>        DataFrame with list of planet positions. It will be empty if no</span>
<span class=sd>        planets are found. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=kn>from</span> <span class=nn>vasttools.survey</span> <span class=kn>import</span> <span class=n>ALLOWED_PLANETS</span>
    <span class=n>ap</span> <span class=o>=</span> <span class=n>ALLOWED_PLANETS</span>

    <span class=n>planets_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span>
        <span class=s1>&#39;datetime&#39;</span><span class=p>,</span>
        <span class=s1>&#39;duration&#39;</span><span class=p>,</span>
        <span class=s1>&#39;centre_ra&#39;</span><span class=p>,</span>
        <span class=s1>&#39;centre_dec&#39;</span><span class=p>,</span>
    <span class=p>]]</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;datetime&#39;</span><span class=p>:</span> <span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_ra&#39;</span><span class=p>:</span> <span class=s1>&#39;centre-ra&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_dec&#39;</span><span class=p>:</span> <span class=s1>&#39;centre-dec&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=c1># Split off a sun and moon df so we can check more times</span>
    <span class=n>sun_moon_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=n>ap</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;sun&#39;</span><span class=p>)</span>
    <span class=n>ap</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;moon&#39;</span><span class=p>)</span>

    <span class=c1># check planets at start and end of observation</span>
    <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>planets_df</span><span class=p>[[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span> <span class=s1>&#39;duration&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_add_times</span><span class=p>,</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>
    <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>ap</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>planets_df</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])]</span>

    <span class=c1># check sun and moon every hour</span>
    <span class=n>sun_moon_df</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sun_moon_df</span><span class=p>[[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span> <span class=s1>&#39;duration&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_add_times</span><span class=p>,</span>
        <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>sun_moon_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
        <span class=p>[</span><span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;moon&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>sun_moon_df</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
    <span class=p>]</span>

    <span class=n>planets_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>sun_moon_df</span><span class=p>,</span> <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>del</span> <span class=n>sun_moon_df</span>

    <span class=n>planets_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;planet&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=s1>&#39;duration&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>
    <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>capitalize</span><span class=p>()</span>

    <span class=n>meta</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
        <span class=s1>&#39;DATEOBS&#39;</span><span class=p>:</span> <span class=s1>&#39;datetime64[ns]&#39;</span><span class=p>,</span>
        <span class=s1>&#39;centre-ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;centre-dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;planet&#39;</span><span class=p>:</span> <span class=s1>&#39;U&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;sep&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span>
    <span class=p>}</span>

    <span class=n>result</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>planets_df</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>)</span>
        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;planet&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=n>match_planet_to_field</span><span class=p>,</span>
            <span class=n>meta</span><span class=o>=</span><span class=n>meta</span>
        <span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>(</span>
            <span class=n>scheduler</span><span class=o>=</span><span class=s1>&#39;processes&#39;</span><span class=p>,</span>
            <span class=n>n_workers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;No planets found.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>result</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.combine_with_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>combine_with_run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=p>,</span> <span class=n>new_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.combine_with_run class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Combines the output of another PipeRun object with the PipeRun from which this method is being called from.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>It is assumed you are loading runs from the same Pipeline instance. If this is not the case then erroneous results may be returned.</p> </div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>other_PipeRun</code></td> <td><code>PipeRun</code></td> <td><p>The other pipeline run to merge.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>new_name</code></td> <td><code>Optional[str]</code></td> <td><p>If not None then the PipeRun attribute 'name' is changed to the given value.</p></td> <td><code>None</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>PipeRun</code></td> <td><p>The self object with the other pipeline run added.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>combine_with_run</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=p>,</span> <span class=n>new_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Combines the output of another PipeRun object with the PipeRun</span>
<span class=sd>    from which this method is being called from.</span>

<span class=sd>    !!!warning</span>
<span class=sd>        It is assumed you are loading runs from the same Pipeline</span>
<span class=sd>        instance. If this is not the case then erroneous results may be</span>
<span class=sd>        returned.</span>

<span class=sd>    Args:</span>
<span class=sd>        other_PipeRun (PipeRun): The other pipeline run to merge.</span>
<span class=sd>        new_name: If not None then the PipeRun attribute &#39;name&#39;</span>
<span class=sd>            is changed to the given value.</span>

<span class=sd>    Returns:</span>
<span class=sd>        PipeRun: The self object with the other pipeline run added.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>images</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
        <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>images</span><span class=p>,</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
        <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>skyregions</span><span class=p>,</span>
        <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span>
        <span class=p>)</span>

    <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=k>elif</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>)</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
            <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span><span class=p>,</span>
            <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>([</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span><span class=p>])</span>

    <span class=n>sources_to_add</span> <span class=o>=</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=o>~</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>index</span>
        <span class=p>))</span>
    <span class=p>]</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
        <span class=n>sources_to_add</span>
    <span class=p>)</span>

    <span class=c1># need to keep access to all the different pairs files</span>
    <span class=c1># for two epoch metrics.</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>

    <span class=k>del</span> <span class=n>sources_to_add</span>

    <span class=k>if</span> <span class=n>new_name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>new_name</span>

    <span class=k>return</span> <span class=bp>self</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.create_moc class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_moc</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=mi>9</span><span class=p>,</span> <span class=n>ignore_large_run_warning</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.create_moc class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Create a MOC file that represents the area covered by the pipeline run.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>This will take a very long time for large runs.</p> </div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>max_depth</code></td> <td><code>int</code></td> <td><p>Max depth parameter passed to the MOC.from_polygon_skycoord() function, defaults to 9.</p></td> <td><code>9</code></td> </tr> <tr> <td><code>ignore_large_run_warning</code></td> <td><code>bool</code></td> <td><p>Ignores the warning of creating a MOC on a large run.</p></td> <td><code>False</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>MOC</code></td> <td><p>MOC object.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>create_moc</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>max_depth</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>9</span><span class=p>,</span> <span class=n>ignore_large_run_warning</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>mocpy</span><span class=o>.</span><span class=n>MOC</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Create a MOC file that represents the area covered by</span>
<span class=sd>    the pipeline run.</span>

<span class=sd>    !!!warning</span>
<span class=sd>        This will take a very long time for large runs.</span>

<span class=sd>    Args:</span>
<span class=sd>        max_depth: Max depth parameter passed to the</span>
<span class=sd>            MOC.from_polygon_skycoord() function, defaults to 9.</span>
<span class=sd>        ignore_large_run_warning: Ignores the warning of creating a MOC on</span>
<span class=sd>            a large run.</span>

<span class=sd>    Returns:</span>
<span class=sd>        MOC object.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>images_to_use</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span>
        <span class=s1>&#39;skyreg_id&#39;</span>
    <span class=p>)[</span><span class=s1>&#39;path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>ignore_large_run_warning</span> <span class=ow>and</span> <span class=n>images_to_use</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span>
            <span class=s2>&quot;Creating a MOC for a large run will take a long time!&quot;</span>
            <span class=s2>&quot; Run again with &#39;ignore_large_run_warning=True` if you&quot;</span>
            <span class=s2>&quot; are sure you want to run this. A smaller `max_depth` is&quot;</span>
            <span class=s2>&quot; highly recommended.&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span>

    <span class=n>moc</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_moc_from_fits</span><span class=p>(</span>
        <span class=n>images_to_use</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
        <span class=n>max_depth</span><span class=o>=</span><span class=n>max_depth</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>images_to_use</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>img</span> <span class=ow>in</span> <span class=n>images_to_use</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
            <span class=n>img_moc</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_moc_from_fits</span><span class=p>(</span>
                <span class=n>img</span><span class=p>,</span>
                <span class=n>max_depth</span>
            <span class=p>)</span>
            <span class=n>moc</span> <span class=o>=</span> <span class=n>moc</span><span class=o>.</span><span class=n>union</span><span class=p>(</span><span class=n>img_moc</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>moc</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.filter_by_moc class="doc doc-heading"> <code class="highlight language-python"><span class=n>filter_by_moc</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>moc</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.filter_by_moc class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Filters the PipeRun object to only contain the sources that are located within the provided moc area.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>moc</code></td> <td><code>MOC</code></td> <td><p>MOC instance for which to filter the run by.</p></td> <td><em>required</em></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>PipeAnalysis</code></td> <td><p>new_PipeRun</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>filter_by_moc</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>moc</span><span class=p>:</span> <span class=n>mocpy</span><span class=o>.</span><span class=n>MOC</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Filters the PipeRun object to only contain the sources that are</span>
<span class=sd>    located within the provided moc area.</span>

<span class=sd>    Args:</span>
<span class=sd>        moc: MOC instance for which to filter the run by.</span>

<span class=sd>    Returns:</span>
<span class=sd>        PipeAnalysis: new_PipeRun</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>source_mask</span> <span class=o>=</span> <span class=n>moc</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span><span class=o>.</span><span class=n>dec</span><span class=p>)</span>

    <span class=n>new_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>source_mask</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=n>new_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span>
        <span class=n>new_meas</span> <span class=o>=</span> <span class=n>new_meas</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>new_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>new_images</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_meas</span><span class=o>.</span><span class=n>image_id</span><span class=o>.</span><span class=n>tolist</span><span class=p>())]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>new_skyregions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=o>.</span><span class=n>id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_images</span><span class=o>.</span><span class=n>skyreg_id</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>new_associations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>associations</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>associations</span><span class=o>.</span><span class=n>source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=p>]</span>

    <span class=n>new_relations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>from_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=p>]</span>

    <span class=n>new_PipeRun</span> <span class=o>=</span> <span class=n>PipeAnalysis</span><span class=p>(</span>
        <span class=n>name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
        <span class=n>images</span><span class=o>=</span><span class=n>new_images</span><span class=p>,</span>
        <span class=n>skyregions</span><span class=o>=</span><span class=n>new_skyregions</span><span class=p>,</span>
        <span class=n>relations</span><span class=o>=</span><span class=n>new_relations</span><span class=p>,</span>
        <span class=n>sources</span><span class=o>=</span><span class=n>new_sources</span><span class=p>,</span>
        <span class=n>associations</span><span class=o>=</span><span class=n>new_associations</span><span class=p>,</span>
        <span class=n>measurements</span><span class=o>=</span><span class=n>new_meas</span><span class=p>,</span>
        <span class=n>measurement_pairs_file</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>,</span>
        <span class=n>vaex_meas</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>new_PipeRun</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.get_source class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_source</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>id</span><span class=p>,</span> <span class=n>field</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>stokes</span><span class=o>=</span><span class=s1>&#39;I&#39;</span><span class=p>,</span> <span class=n>outdir</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>user_measurements</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>user_sources</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.get_source class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Fetches an individual source and returns a vasttools.source.Source object.</p> <p>Users do not need to change the field, stokes and outdir parameters.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>id</code></td> <td><code>int</code></td> <td><p>The id of the source to load.</p></td> <td><em>required</em></td> </tr> <tr> <td><code>field</code></td> <td><code>Optional[str]</code></td> <td><p>The field of the source being loaded, defaults to None. If None then the run name is used as the field.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>stokes</code></td> <td><code>str</code></td> <td><p>Stokes parameter of the source, defaults to 'I'.</p></td> <td><code>&#39;I&#39;</code></td> </tr> <tr> <td><code>outdir</code></td> <td><code>str</code></td> <td><p>The output directory where generated plots will be saved, defauls to '.' (the current working directory).</p></td> <td><code>&#39;.&#39;</code></td> </tr> <tr> <td><code>user_measurements</code></td> <td><code>Union[pandas.core.frame.DataFrame, vaex.dataframe.DataFrame]</code></td> <td><p>A user generated measurements dataframe to use instead of the default pipeline result. The type must match the default type of the pipeline (vaex or pandas). Defaults to None, in which case the default pipeline measurements are used.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>user_sources</code></td> <td><code>Optional[pandas.core.frame.DataFrame]</code></td> <td><p>A user generated sources dataframe to use instead of the default pipeline result. Format is always a pandas dataframe. Defaults to None, in which case the default pipeline measurements are used.</p></td> <td><code>None</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>Source</code></td> <td><p>vast tools Source object.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_source</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>field</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>stokes</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;I&#39;</span><span class=p>,</span>
    <span class=n>outdir</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>,</span>
    <span class=n>user_measurements</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span>
        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span>
    <span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>user_sources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Source</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Fetches an individual source and returns a</span>
<span class=sd>    vasttools.source.Source object.</span>

<span class=sd>    Users do not need</span>
<span class=sd>    to change the field, stokes and outdir parameters.</span>

<span class=sd>    Args:</span>
<span class=sd>        id: The id of the source to load.</span>
<span class=sd>        field: The field of the source being loaded, defaults</span>
<span class=sd>            to None. If None then the run name is used as the field.</span>
<span class=sd>        stokes: Stokes parameter of the source, defaults to &#39;I&#39;.</span>
<span class=sd>        outdir: The output directory where generated plots will</span>
<span class=sd>            be saved, defauls to &#39;.&#39; (the current working directory).</span>
<span class=sd>        user_measurements: A user generated measurements dataframe to</span>
<span class=sd>            use instead of the default pipeline result. The type must match</span>
<span class=sd>            the default type of the pipeline (vaex or pandas). Defaults to</span>
<span class=sd>            None, in which case the default pipeline measurements are used.</span>
<span class=sd>        user_sources: A user generated sources dataframe to use</span>
<span class=sd>            instead of the default pipeline result. Format is always a</span>
<span class=sd>            pandas dataframe. Defaults to None, in which case the default</span>
<span class=sd>            pipeline measurements are used.</span>

<span class=sd>    Returns:</span>
<span class=sd>        vast tools Source object.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>user_measurements</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>the_measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>the_measurements</span> <span class=o>=</span> <span class=n>user_measurements</span>

    <span class=k>if</span> <span class=n>user_sources</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=n>user_sources</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>the_measurements</span><span class=p>[</span>
            <span class=n>the_measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>id</span>
        <span class=p>]</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>the_measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>the_measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>id</span>
        <span class=p>]</span>

    <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span>
            <span class=s1>&#39;path&#39;</span><span class=p>,</span>
            <span class=s1>&#39;noise_path&#39;</span><span class=p>,</span>
            <span class=s1>&#39;measurements_path&#39;</span><span class=p>,</span>
            <span class=s1>&#39;frequency&#39;</span>
        <span class=p>]],</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id&#39;</span><span class=p>,</span>
        <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;path&#39;</span><span class=p>:</span> <span class=s1>&#39;image&#39;</span><span class=p>,</span>
            <span class=s1>&#39;noise_path&#39;</span><span class=p>:</span> <span class=s1>&#39;rms&#39;</span><span class=p>,</span>
            <span class=s1>&#39;measurements_path&#39;</span><span class=p>:</span> <span class=s1>&#39;selavy&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
          <span class=s1>&#39;time&#39;</span><span class=p>:</span> <span class=s1>&#39;dateobs&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>)</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span>
        <span class=n>by</span><span class=o>=</span><span class=s1>&#39;dateobs&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=n>s</span> <span class=o>=</span> <span class=n>the_sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span>

    <span class=n>num_measurements</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=s1>&#39;n_measurements&#39;</span><span class=p>]</span>

    <span class=n>source_coord</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>s</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>],</span>
        <span class=n>s</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>],</span>
        <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>source_name</span> <span class=o>=</span> <span class=s2>&quot;VAST </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>source_coord</span><span class=o>.</span><span class=n>to_string</span><span class=p>(</span>
            <span class=s2>&quot;hmsdms&quot;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>precision</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
            <span class=s2>&quot; &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
        <span class=p>)[:</span><span class=mi>15</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=n>source_epochs</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_measurements</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
    <span class=k>if</span> <span class=n>field</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>field</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;field&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;epoch&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>source_epochs</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;stokes&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>stokes</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;skycoord&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>source_coord</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;detection&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;forced&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>False</span>
    <span class=n>source_fields</span> <span class=o>=</span> <span class=p>[</span><span class=n>field</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_measurements</span><span class=p>)]</span>
    <span class=n>source_stokes</span> <span class=o>=</span> <span class=n>stokes</span>
    <span class=n>source_base_folder</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>source_crossmatch_radius</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>source_outdir</span> <span class=o>=</span> <span class=n>outdir</span>
    <span class=n>source_image_type</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=n>thesource</span> <span class=o>=</span> <span class=n>Source</span><span class=p>(</span>
        <span class=n>source_coord</span><span class=p>,</span>
        <span class=n>source_name</span><span class=p>,</span>
        <span class=n>source_epochs</span><span class=p>,</span>
        <span class=n>source_fields</span><span class=p>,</span>
        <span class=n>source_stokes</span><span class=p>,</span>
        <span class=kc>None</span><span class=p>,</span>
        <span class=n>source_crossmatch_radius</span><span class=p>,</span>
        <span class=n>measurements</span><span class=p>,</span>
        <span class=n>source_base_folder</span><span class=p>,</span>
        <span class=n>source_image_type</span><span class=p>,</span>
        <span class=n>islands</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
        <span class=n>outdir</span><span class=o>=</span><span class=n>source_outdir</span><span class=p>,</span>
        <span class=n>pipeline</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>thesource</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.get_sources_skycoord class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_sources_skycoord</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_sources</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>,</span> <span class=n>ra_unit</span><span class=o>=</span><span class=n>Unit</span><span class=p>(</span><span class=s2>&quot;deg&quot;</span><span class=p>),</span> <span class=n>dec_unit</span><span class=o>=</span><span class=n>Unit</span><span class=p>(</span><span class=s2>&quot;deg&quot;</span><span class=p>))</span></code> <a href=#vasttools.pipeline.PipeRun.get_sources_skycoord class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>A convenience function to generate a SkyCoord object from the sources dataframe. Also has support for custom source lists.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>user_sources</code></td> <td><code>Optional[pandas.core.frame.DataFrame]</code></td> <td><p>Provide a user generated source dataframe in place of using the default run sources dataframe.</p></td> <td><code>None</code></td> </tr> <tr> <td><code>ra_col</code></td> <td><code>str</code></td> <td><p>The column to use for the Right Ascension.</p></td> <td><code>&#39;wavg_ra&#39;</code></td> </tr> <tr> <td><code>dec_col</code></td> <td><code>str</code></td> <td><p>The column to use for the Declination.</p></td> <td><code>&#39;wavg_dec&#39;</code></td> </tr> <tr> <td><code>ra_unit</code></td> <td><code>Unit</code></td> <td><p>The unit of the RA column, defaults to degrees. Must be an astropy.unit value.</p></td> <td><code>Unit(&#34;deg&#34;)</code></td> </tr> <tr> <td><code>dec_unit</code></td> <td><code>Unit</code></td> <td><p>The unit of the Dec column, defaults to degrees. Must be an astropy.unit value.</p></td> <td><code>Unit(&#34;deg&#34;)</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>SkyCoord</code></td> <td><p>Skycoord object of the sources. A <code>astropy.coordinates.sky_coordinate.SkyCoord</code> instance.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_sources_skycoord</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>user_sources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>ra_col</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span>
    <span class=n>dec_col</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;wavg_dec&#39;</span><span class=p>,</span>
    <span class=n>ra_unit</span><span class=p>:</span> <span class=n>u</span><span class=o>.</span><span class=n>Unit</span> <span class=o>=</span> <span class=n>u</span><span class=o>.</span><span class=n>degree</span><span class=p>,</span>
    <span class=n>dec_unit</span><span class=p>:</span> <span class=n>u</span><span class=o>.</span><span class=n>Unit</span> <span class=o>=</span> <span class=n>u</span><span class=o>.</span><span class=n>degree</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>astropy</span><span class=o>.</span><span class=n>coordinates</span><span class=o>.</span><span class=n>sky_coordinate</span><span class=o>.</span><span class=n>SkyCoord</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    A convenience function to generate a SkyCoord object from the</span>
<span class=sd>    sources dataframe. Also has support for custom source lists.</span>

<span class=sd>    Args:</span>
<span class=sd>        user_sources: Provide a user generated source dataframe</span>
<span class=sd>            in place of using the default run sources dataframe.</span>
<span class=sd>        ra_col: The column to use for the Right Ascension.</span>
<span class=sd>        dec_col: The column to use for the Declination.</span>
<span class=sd>        ra_unit: The unit of the RA column, defaults to degrees.</span>
<span class=sd>            Must be an astropy.unit value.</span>
<span class=sd>        dec_unit: The unit of the Dec column, defaults to degrees.</span>
<span class=sd>            Must be an astropy.unit value.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Skycoord object of the sources. A</span>
<span class=sd>        `astropy.coordinates.sky_coordinate.SkyCoord` instance.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>user_sources</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=n>user_sources</span>

    <span class=n>sources_skycoord</span> <span class=o>=</span> <span class=n>gen_skycoord_from_df</span><span class=p>(</span>
        <span class=n>the_sources</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=n>ra_col</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=n>dec_col</span><span class=p>,</span> <span class=n>ra_unit</span><span class=o>=</span><span class=n>ra_unit</span><span class=p>,</span>
        <span class=n>dec_unit</span><span class=o>=</span><span class=n>dec_unit</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>sources_skycoord</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 id=vasttools.pipeline.PipeRun.load_two_epoch_metrics class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_two_epoch_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.load_two_epoch_metrics class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Loads the two epoch metrics dataframe, usually stored as either 'measurement_pairs.parquet' or 'measurement_pairs.arrow'.</p> <p>The two epoch metrics dataframe is stored as an attribute to the PipeRun object as self.measurement_pairs_df. An epoch 'key' is also added to the dataframe.</p> <p>Also creates a 'pairs_df' that lists all the possible epoch pairs. This is stored as the attribute self.pairs_df.</p> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>None</code></td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>load_two_epoch_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Loads the two epoch metrics dataframe, usually stored as either</span>
<span class=sd>    &#39;measurement_pairs.parquet&#39; or &#39;measurement_pairs.arrow&#39;.</span>

<span class=sd>    The two epoch metrics dataframe is stored as an attribute to the</span>
<span class=sd>    PipeRun object as self.measurement_pairs_df. An epoch &#39;key&#39; is also</span>
<span class=sd>    added to the dataframe.</span>

<span class=sd>    Also creates a &#39;pairs_df&#39; that lists all the possible epoch pairs.</span>
<span class=sd>    This is stored as the attribute self.pairs_df.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>image_ids</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
        <span class=p>{</span><span class=s1>&#39;pair&#39;</span><span class=p>:</span> <span class=n>combinations</span><span class=p>(</span><span class=n>image_ids</span><span class=p>,</span> <span class=mi>2</span><span class=p>)}</span>
    <span class=p>)</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;pair&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;image_id_a&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s1>&#39;image_id_b&#39;</span><span class=p>})</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>]],</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id_a&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>]],</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id_b&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;index&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>,</span>
            <span class=s1>&#39;name_a&#39;</span><span class=p>:</span> <span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span>
            <span class=s1>&#39;name_b&#39;</span><span class=p>:</span> <span class=s1>&#39;image_name_b&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;td&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;datetime_b&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;datetime_a&#39;</span><span class=p>]</span>

    <span class=n>pairs_df</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;datetime_a&#39;</span><span class=p>,</span> <span class=s1>&#39;datetime_b&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>pairs_df</span><span class=p>[[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_b&#39;</span><span class=p>]]</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>arrow_files</span> <span class=o>=</span> <span class=p>(</span>
            <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.arrow&quot;</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>arrow_files</span><span class=p>):</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>open_many</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=n>arrow_files</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=o>~</span><span class=n>arrow_files</span><span class=p>]:</span>
                <span class=n>temp</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                <span class=n>temp</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
                <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurement pairs have been loaded with vaex.&quot;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>
            <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;.arrow&#39;</span><span class=p>):</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>vaex</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurement pairs have been loaded with vaex.&quot;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;_&quot;</span>
            <span class=o>+</span> <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>pair_epoch_key</span><span class=p>,</span> <span class=n>agg</span><span class=o>=</span><span class=s1>&#39;count&#39;</span>
        <span class=p>)</span>

        <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>pair_counts</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=s1>&#39;total_pairs&#39;</span><span class=p>}</span>
        <span class=p>)</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=p>[[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_b&#39;</span><span class=p>]]</span>
            <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=p>[</span>
            <span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span>
        <span class=p>]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>:</span> <span class=s1>&#39;total_pairs&#39;</span><span class=p>}</span>
        <span class=p>)</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>pair_counts</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>del</span> <span class=n>pair_counts</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>subset</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;total_pairs&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;td&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 9, 2021</span> <br>Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 9, 2021</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../moc/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> moc.py </div> </div> </a> <a href=../query/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> query.py </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 - 2025 Vast Development Team, University of Sydney - all right reserved </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/askap-vast/vast-tools target=_blank rel=noopener title="vast-pipeline source on GitHub" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://vast-survey.org target=_blank rel=noopener title=vast-survey.org class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.1d3bfcf1.min.js></script> <script src=../../theme/js/extra.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
    </script> </body> </html>