<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Python module to interact with ASKAP VAST data."><meta name=author content="VAST Development Team"><link href=../moc/ rel=prev><link href=../query/ rel=next><link rel=icon href=../../img/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.30"><title>pipeline.py - VAST Tools</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../css/lightgallery.min.css><script src=../../js/lightgallery.min.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../theme/css/extra.css><link rel=stylesheet href=../../css/ansi-colours.css><link rel=stylesheet href=../../css/jupyter-cells.css><link rel=stylesheet href=../../css/pandas-dataframe.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="VAST Tools - pipeline.py"><meta property=og:description content="Python module to interact with ASKAP VAST data."><meta property=og:url content=None></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#vasttools.pipeline class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <style>
      .md-banner a,
      .md-banner a:focus,
      .md-banner a:hover{color:currentColor}.md-banner
      strong{white-space:nowrap}.md-banner}
  </style> <a href=../../changelog/ ><strong>Version 3.2.0 released!</strong> Includes minor plotting changes, various dependency upgrades and and more ðŸ™Œ Check the <strong>release notes! ðŸ‘€</strong></a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="VAST Tools" class="md-header__button md-logo" aria-label="VAST Tools" data-md-component=logo> <img src=../../img/vast-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VAST Tools </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> pipeline.py </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/askap-vast/vast-tools title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> askap-vast/vast-tools </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting_started/introduction/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../components/mocs/ class=md-tabs__link> Components & Features </a> </li> <li class=md-tabs__item> <a href=../../notebook-examples/notebooks-overview/ class=md-tabs__link> Example Notebooks </a> </li> <li class=md-tabs__item> <a href=../../contributing/develop/ class=md-tabs__link> Contributing & Developing </a> </li> <li class=md-tabs__item> <a href=../../help_and_acknowledgements/ class=md-tabs__link> Help and Acknowledgements </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../changelog/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="VAST Tools" class="md-nav__button md-logo" aria-label="VAST Tools" data-md-component=logo> <img src=../../img/vast-logo.png alt=logo> </a> VAST Tools </label> <div class=md-nav__source> <a href=https://github.com/askap-vast/vast-tools title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> askap-vast/vast-tools </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting_started/introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../getting_started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting_started/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration & Data Access </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Components & Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Components & Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../components/mocs/ class=md-nav__link> <span class=md-ellipsis> MOCs </span> </a> </li> <li class=md-nav__item> <a href=../../components/pipeline/ class=md-nav__link> <span class=md-ellipsis> Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../../components/query/ class=md-nav__link> <span class=md-ellipsis> Query </span> </a> </li> <li class=md-nav__item> <a href=../../components/source/ class=md-nav__link> <span class=md-ellipsis> Source </span> </a> </li> <li class=md-nav__item> <a href=../../components/survey/ class=md-nav__link> <span class=md-ellipsis> Survey </span> </a> </li> <li class=md-nav__item> <a href=../../components/tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class=md-ellipsis> Scripts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Scripts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scripts/build_lightcurves/ class=md-nav__link> <span class=md-ellipsis> build_lightcurves </span> </a> </li> <li class=md-nav__item> <a href=../../scripts/find_sources/ class=md-nav__link> <span class=md-ellipsis> find_sources </span> </a> </li> <li class=md-nav__item> <a href=../../scripts/pilot_fields_info/ class=md-nav__link> <span class=md-ellipsis> pilot_fields_info </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Example Notebooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Example Notebooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notebook-examples/notebooks-overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/catalogue-crossmatching-example/ class=md-nav__link> <span class=md-ellipsis> Catalogue Crossmatch </span> </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/planet-hunting-example/ class=md-nav__link> <span class=md-ellipsis> Planet Searching </span> </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/source-search-example/ class=md-nav__link> <span class=md-ellipsis> Query Source Search </span> </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/using-vast-mocs-example/ class=md-nav__link> <span class=md-ellipsis> Using VAST MOCs </span> </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/vast-pipeline-example/ class=md-nav__link> <span class=md-ellipsis> VAST Pipeline Exploration </span> </a> </li> <li class=md-nav__item> <a href=../../notebook-examples/workshop-notebook-2023/ class=md-nav__link> <span class=md-ellipsis> VAST Workshop 2023 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Contributing & Developing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Contributing & Developing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/develop/ class=md-nav__link> <span class=md-ellipsis> Developing VAST Tools </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/github/ class=md-nav__link> <span class=md-ellipsis> GitHub Platform </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/tests/ class=md-nav__link> <span class=md-ellipsis> Tests </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/docsdev/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/newepoch/ class=md-nav__link> <span class=md-ellipsis> Adding a New Epoch </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../help_and_acknowledgements/ class=md-nav__link> <span class=md-ellipsis> Help and Acknowledgements </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../../code_of_conduct/ class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../../license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4 checked> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex> <span class=md-ellipsis> Code Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=true> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Code Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4_1 checked> <label class=md-nav__link for=__nav_7_4_1 id=__nav_7_4_1_label tabindex=0> <span class=md-ellipsis> vast_tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_7_4_1> <span class="md-nav__icon md-icon"></span> vast_tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4_1_1> <label class=md-nav__link for=__nav_7_4_1_1 id=__nav_7_4_1_1_label tabindex=0> <span class=md-ellipsis> bin </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_7_4_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4_1_1> <span class="md-nav__icon md-icon"></span> bin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../bin/build_lightcurves/ class=md-nav__link> <span class=md-ellipsis> build_lightcurves.py </span> </a> </li> <li class=md-nav__item> <a href=../bin/find_sources/ class=md-nav__link> <span class=md-ellipsis> find_sources.py </span> </a> </li> <li class=md-nav__item> <a href=../bin/pilot_fields_info/ class=md-nav__link> <span class=md-ellipsis> pilot_fields_info.py </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../moc/ class=md-nav__link> <span class=md-ellipsis> moc.py </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> pipeline.py </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> pipeline.py </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vasttools.pipeline class=md-nav__link> <span class=md-ellipsis> pipeline </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.MeasPairsDoNotExistError class=md-nav__link> <span class=md-ellipsis> MeasPairsDoNotExistError </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis class=md-nav__link> <span class=md-ellipsis> PipeAnalysis </span> </a> <nav class=md-nav aria-label=PipeAnalysis> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.add_credible_levels class=md-nav__link> <span class=md-ellipsis> add_credible_levels </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class=md-nav__link> <span class=md-ellipsis> eta_v_diagnostic_plot </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class=md-nav__link> <span class=md-ellipsis> plot_two_epoch_pairs </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.recalc_measurement_pairs_df class=md-nav__link> <span class=md-ellipsis> recalc_measurement_pairs_df </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.recalc_sources_df class=md-nav__link> <span class=md-ellipsis> recalc_sources_df </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class=md-nav__link> <span class=md-ellipsis> run_eta_v_analysis </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class=md-nav__link> <span class=md-ellipsis> run_two_epoch_analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun class=md-nav__link> <span class=md-ellipsis> PipeRun </span> </a> <nav class=md-nav aria-label=PipeRun> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.check_for_planets class=md-nav__link> <span class=md-ellipsis> check_for_planets </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.combine_with_run class=md-nav__link> <span class=md-ellipsis> combine_with_run </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.create_moc class=md-nav__link> <span class=md-ellipsis> create_moc </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.filter_by_moc class=md-nav__link> <span class=md-ellipsis> filter_by_moc </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_source class=md-nav__link> <span class=md-ellipsis> get_source </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_sources_skycoord class=md-nav__link> <span class=md-ellipsis> get_sources_skycoord </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.load_two_epoch_metrics class=md-nav__link> <span class=md-ellipsis> load_two_epoch_metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline class=md-nav__link> <span class=md-ellipsis> Pipeline </span> </a> <nav class=md-nav aria-label=Pipeline> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_images class=md-nav__link> <span class=md-ellipsis> list_images </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_piperuns class=md-nav__link> <span class=md-ellipsis> list_piperuns </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_run class=md-nav__link> <span class=md-ellipsis> load_run </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_runs class=md-nav__link> <span class=md-ellipsis> load_runs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipelineDirectoryError class=md-nav__link> <span class=md-ellipsis> PipelineDirectoryError </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../query/ class=md-nav__link> <span class=md-ellipsis> query.py </span> </a> </li> <li class=md-nav__item> <a href=../source/ class=md-nav__link> <span class=md-ellipsis> source.py </span> </a> </li> <li class=md-nav__item> <a href=../survey/ class=md-nav__link> <span class=md-ellipsis> survey.py </span> </a> </li> <li class=md-nav__item> <a href=../tools/ class=md-nav__link> <span class=md-ellipsis> tools.py </span> </a> </li> <li class=md-nav__item> <a href=../utils/ class=md-nav__link> <span class=md-ellipsis> utils.py </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vasttools.pipeline class=md-nav__link> <span class=md-ellipsis> pipeline </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.MeasPairsDoNotExistError class=md-nav__link> <span class=md-ellipsis> MeasPairsDoNotExistError </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis class=md-nav__link> <span class=md-ellipsis> PipeAnalysis </span> </a> <nav class=md-nav aria-label=PipeAnalysis> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.add_credible_levels class=md-nav__link> <span class=md-ellipsis> add_credible_levels </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class=md-nav__link> <span class=md-ellipsis> eta_v_diagnostic_plot </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class=md-nav__link> <span class=md-ellipsis> plot_two_epoch_pairs </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.recalc_measurement_pairs_df class=md-nav__link> <span class=md-ellipsis> recalc_measurement_pairs_df </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.recalc_sources_df class=md-nav__link> <span class=md-ellipsis> recalc_sources_df </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class=md-nav__link> <span class=md-ellipsis> run_eta_v_analysis </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class=md-nav__link> <span class=md-ellipsis> run_two_epoch_analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun class=md-nav__link> <span class=md-ellipsis> PipeRun </span> </a> <nav class=md-nav aria-label=PipeRun> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.check_for_planets class=md-nav__link> <span class=md-ellipsis> check_for_planets </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.combine_with_run class=md-nav__link> <span class=md-ellipsis> combine_with_run </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.create_moc class=md-nav__link> <span class=md-ellipsis> create_moc </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.filter_by_moc class=md-nav__link> <span class=md-ellipsis> filter_by_moc </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_source class=md-nav__link> <span class=md-ellipsis> get_source </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.get_sources_skycoord class=md-nav__link> <span class=md-ellipsis> get_sources_skycoord </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipeRun.load_two_epoch_metrics class=md-nav__link> <span class=md-ellipsis> load_two_epoch_metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline class=md-nav__link> <span class=md-ellipsis> Pipeline </span> </a> <nav class=md-nav aria-label=Pipeline> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_images class=md-nav__link> <span class=md-ellipsis> list_images </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.list_piperuns class=md-nav__link> <span class=md-ellipsis> list_piperuns </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_run class=md-nav__link> <span class=md-ellipsis> load_run </span> </a> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.Pipeline.load_runs class=md-nav__link> <span class=md-ellipsis> load_runs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vasttools.pipeline.PipelineDirectoryError class=md-nav__link> <span class=md-ellipsis> PipelineDirectoryError </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>pipeline.py</h1> <div class="doc doc-object doc-module"> <a id=vasttools.pipeline></a> <div class="doc doc-contents first"> <p>Class to interface with results from the VAST Pipeline.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.HOST_NCPU">HOST_NCPU</span></code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>The number of CPU found on the host using 'cpu_count()'.</p> </div> </td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.MeasPairsDoNotExistError class="doc doc-heading"> <code>MeasPairsDoNotExistError</code> <a href=#vasttools.pipeline.MeasPairsDoNotExistError class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>Exception</code></p> <p>An error to indicate that the measurement pairs do not exist for a run.</p> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>MeasPairsDoNotExistError</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    An error to indicate that the measurement pairs do not exist for a run.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.PipeAnalysis class="doc doc-heading"> <code>PipeAnalysis</code> <a href=#vasttools.pipeline.PipeAnalysis class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.PipeRun" href="#vasttools.pipeline.PipeRun">PipeRun</a></code></p> <p>Class that represents an Analysis instance of a Pipeline run. Inherits from class <code>PipeRun</code>.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.associations">associations</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Associations dataframe from the pipeline run loaded from 'associations.parquet'.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.bands">bands</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>The bands dataframe from the pipeline run loaded from 'bands.parquet'.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.images">images</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the images of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.measurements">measurements</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the measurements of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.measurement_pairs_file">measurement_pairs_file</span></code></td> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td> <div class=doc-md-description> <p>List containing the locations of the measurement_pairs.parquet (or .arrow) file(s).</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.name">name</span></code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The pipeline run name.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.n_workers">n_workers</span></code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>Number of workers (cpus) available.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.relations">relations</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the relations of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.skyregions">skyregions</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the skyregions of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.sources">sources</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the sources of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeAnalysis.sources_skycoord">sources_skycoord</span></code></td> <td> <code><span title="astropy.coordinates.sky_coordinate.SkyCoord">SkyCoord</span></code> </td> <td> <div class=doc-md-description> <p>A SkyCoord object of the default sources attribute.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 833</span>
<span class=normal> 834</span>
<span class=normal> 835</span>
<span class=normal> 836</span>
<span class=normal> 837</span>
<span class=normal> 838</span>
<span class=normal> 839</span>
<span class=normal> 840</span>
<span class=normal> 841</span>
<span class=normal> 842</span>
<span class=normal> 843</span>
<span class=normal> 844</span>
<span class=normal> 845</span>
<span class=normal> 846</span>
<span class=normal> 847</span>
<span class=normal> 848</span>
<span class=normal> 849</span>
<span class=normal> 850</span>
<span class=normal> 851</span>
<span class=normal> 852</span>
<span class=normal> 853</span>
<span class=normal> 854</span>
<span class=normal> 855</span>
<span class=normal> 856</span>
<span class=normal> 857</span>
<span class=normal> 858</span>
<span class=normal> 859</span>
<span class=normal> 860</span>
<span class=normal> 861</span>
<span class=normal> 862</span>
<span class=normal> 863</span>
<span class=normal> 864</span>
<span class=normal> 865</span>
<span class=normal> 866</span>
<span class=normal> 867</span>
<span class=normal> 868</span>
<span class=normal> 869</span>
<span class=normal> 870</span>
<span class=normal> 871</span>
<span class=normal> 872</span>
<span class=normal> 873</span>
<span class=normal> 874</span>
<span class=normal> 875</span>
<span class=normal> 876</span>
<span class=normal> 877</span>
<span class=normal> 878</span>
<span class=normal> 879</span>
<span class=normal> 880</span>
<span class=normal> 881</span>
<span class=normal> 882</span>
<span class=normal> 883</span>
<span class=normal> 884</span>
<span class=normal> 885</span>
<span class=normal> 886</span>
<span class=normal> 887</span>
<span class=normal> 888</span>
<span class=normal> 889</span>
<span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span>
<span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span>
<span class=normal>1664</span>
<span class=normal>1665</span>
<span class=normal>1666</span>
<span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span>
<span class=normal>1725</span>
<span class=normal>1726</span>
<span class=normal>1727</span>
<span class=normal>1728</span>
<span class=normal>1729</span>
<span class=normal>1730</span>
<span class=normal>1731</span>
<span class=normal>1732</span>
<span class=normal>1733</span>
<span class=normal>1734</span>
<span class=normal>1735</span>
<span class=normal>1736</span>
<span class=normal>1737</span>
<span class=normal>1738</span>
<span class=normal>1739</span>
<span class=normal>1740</span>
<span class=normal>1741</span>
<span class=normal>1742</span>
<span class=normal>1743</span>
<span class=normal>1744</span>
<span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span>
<span class=normal>1778</span>
<span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span>
<span class=normal>1884</span>
<span class=normal>1885</span>
<span class=normal>1886</span>
<span class=normal>1887</span>
<span class=normal>1888</span>
<span class=normal>1889</span>
<span class=normal>1890</span>
<span class=normal>1891</span>
<span class=normal>1892</span>
<span class=normal>1893</span>
<span class=normal>1894</span>
<span class=normal>1895</span>
<span class=normal>1896</span>
<span class=normal>1897</span>
<span class=normal>1898</span>
<span class=normal>1899</span>
<span class=normal>1900</span>
<span class=normal>1901</span>
<span class=normal>1902</span>
<span class=normal>1903</span>
<span class=normal>1904</span>
<span class=normal>1905</span>
<span class=normal>1906</span>
<span class=normal>1907</span>
<span class=normal>1908</span>
<span class=normal>1909</span>
<span class=normal>1910</span>
<span class=normal>1911</span>
<span class=normal>1912</span>
<span class=normal>1913</span>
<span class=normal>1914</span>
<span class=normal>1915</span>
<span class=normal>1916</span>
<span class=normal>1917</span>
<span class=normal>1918</span>
<span class=normal>1919</span>
<span class=normal>1920</span>
<span class=normal>1921</span>
<span class=normal>1922</span>
<span class=normal>1923</span>
<span class=normal>1924</span>
<span class=normal>1925</span>
<span class=normal>1926</span>
<span class=normal>1927</span>
<span class=normal>1928</span>
<span class=normal>1929</span>
<span class=normal>1930</span>
<span class=normal>1931</span>
<span class=normal>1932</span>
<span class=normal>1933</span>
<span class=normal>1934</span>
<span class=normal>1935</span>
<span class=normal>1936</span>
<span class=normal>1937</span>
<span class=normal>1938</span>
<span class=normal>1939</span>
<span class=normal>1940</span>
<span class=normal>1941</span>
<span class=normal>1942</span>
<span class=normal>1943</span>
<span class=normal>1944</span>
<span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span>
<span class=normal>1950</span>
<span class=normal>1951</span>
<span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span>
<span class=normal>1979</span>
<span class=normal>1980</span>
<span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span>
<span class=normal>1986</span>
<span class=normal>1987</span>
<span class=normal>1988</span>
<span class=normal>1989</span>
<span class=normal>1990</span>
<span class=normal>1991</span>
<span class=normal>1992</span>
<span class=normal>1993</span>
<span class=normal>1994</span>
<span class=normal>1995</span>
<span class=normal>1996</span>
<span class=normal>1997</span>
<span class=normal>1998</span>
<span class=normal>1999</span>
<span class=normal>2000</span>
<span class=normal>2001</span>
<span class=normal>2002</span>
<span class=normal>2003</span>
<span class=normal>2004</span>
<span class=normal>2005</span>
<span class=normal>2006</span>
<span class=normal>2007</span>
<span class=normal>2008</span>
<span class=normal>2009</span>
<span class=normal>2010</span>
<span class=normal>2011</span>
<span class=normal>2012</span>
<span class=normal>2013</span>
<span class=normal>2014</span>
<span class=normal>2015</span>
<span class=normal>2016</span>
<span class=normal>2017</span>
<span class=normal>2018</span>
<span class=normal>2019</span>
<span class=normal>2020</span>
<span class=normal>2021</span>
<span class=normal>2022</span>
<span class=normal>2023</span>
<span class=normal>2024</span>
<span class=normal>2025</span>
<span class=normal>2026</span>
<span class=normal>2027</span>
<span class=normal>2028</span>
<span class=normal>2029</span>
<span class=normal>2030</span>
<span class=normal>2031</span>
<span class=normal>2032</span>
<span class=normal>2033</span>
<span class=normal>2034</span>
<span class=normal>2035</span>
<span class=normal>2036</span>
<span class=normal>2037</span>
<span class=normal>2038</span>
<span class=normal>2039</span>
<span class=normal>2040</span>
<span class=normal>2041</span>
<span class=normal>2042</span>
<span class=normal>2043</span>
<span class=normal>2044</span>
<span class=normal>2045</span>
<span class=normal>2046</span>
<span class=normal>2047</span>
<span class=normal>2048</span>
<span class=normal>2049</span>
<span class=normal>2050</span>
<span class=normal>2051</span>
<span class=normal>2052</span>
<span class=normal>2053</span>
<span class=normal>2054</span>
<span class=normal>2055</span>
<span class=normal>2056</span>
<span class=normal>2057</span>
<span class=normal>2058</span>
<span class=normal>2059</span>
<span class=normal>2060</span>
<span class=normal>2061</span>
<span class=normal>2062</span>
<span class=normal>2063</span>
<span class=normal>2064</span>
<span class=normal>2065</span>
<span class=normal>2066</span>
<span class=normal>2067</span>
<span class=normal>2068</span>
<span class=normal>2069</span>
<span class=normal>2070</span>
<span class=normal>2071</span>
<span class=normal>2072</span>
<span class=normal>2073</span>
<span class=normal>2074</span>
<span class=normal>2075</span>
<span class=normal>2076</span>
<span class=normal>2077</span>
<span class=normal>2078</span>
<span class=normal>2079</span>
<span class=normal>2080</span>
<span class=normal>2081</span>
<span class=normal>2082</span>
<span class=normal>2083</span>
<span class=normal>2084</span>
<span class=normal>2085</span>
<span class=normal>2086</span>
<span class=normal>2087</span>
<span class=normal>2088</span>
<span class=normal>2089</span>
<span class=normal>2090</span>
<span class=normal>2091</span>
<span class=normal>2092</span>
<span class=normal>2093</span>
<span class=normal>2094</span>
<span class=normal>2095</span>
<span class=normal>2096</span>
<span class=normal>2097</span>
<span class=normal>2098</span>
<span class=normal>2099</span>
<span class=normal>2100</span>
<span class=normal>2101</span>
<span class=normal>2102</span>
<span class=normal>2103</span>
<span class=normal>2104</span>
<span class=normal>2105</span>
<span class=normal>2106</span>
<span class=normal>2107</span>
<span class=normal>2108</span>
<span class=normal>2109</span>
<span class=normal>2110</span>
<span class=normal>2111</span>
<span class=normal>2112</span>
<span class=normal>2113</span>
<span class=normal>2114</span>
<span class=normal>2115</span>
<span class=normal>2116</span>
<span class=normal>2117</span>
<span class=normal>2118</span>
<span class=normal>2119</span>
<span class=normal>2120</span>
<span class=normal>2121</span>
<span class=normal>2122</span>
<span class=normal>2123</span>
<span class=normal>2124</span>
<span class=normal>2125</span>
<span class=normal>2126</span>
<span class=normal>2127</span>
<span class=normal>2128</span>
<span class=normal>2129</span>
<span class=normal>2130</span>
<span class=normal>2131</span>
<span class=normal>2132</span>
<span class=normal>2133</span>
<span class=normal>2134</span>
<span class=normal>2135</span>
<span class=normal>2136</span>
<span class=normal>2137</span>
<span class=normal>2138</span>
<span class=normal>2139</span>
<span class=normal>2140</span>
<span class=normal>2141</span>
<span class=normal>2142</span>
<span class=normal>2143</span>
<span class=normal>2144</span>
<span class=normal>2145</span>
<span class=normal>2146</span>
<span class=normal>2147</span>
<span class=normal>2148</span>
<span class=normal>2149</span>
<span class=normal>2150</span>
<span class=normal>2151</span>
<span class=normal>2152</span>
<span class=normal>2153</span>
<span class=normal>2154</span>
<span class=normal>2155</span>
<span class=normal>2156</span>
<span class=normal>2157</span>
<span class=normal>2158</span>
<span class=normal>2159</span>
<span class=normal>2160</span>
<span class=normal>2161</span>
<span class=normal>2162</span>
<span class=normal>2163</span>
<span class=normal>2164</span>
<span class=normal>2165</span>
<span class=normal>2166</span>
<span class=normal>2167</span>
<span class=normal>2168</span>
<span class=normal>2169</span>
<span class=normal>2170</span>
<span class=normal>2171</span>
<span class=normal>2172</span>
<span class=normal>2173</span>
<span class=normal>2174</span>
<span class=normal>2175</span>
<span class=normal>2176</span>
<span class=normal>2177</span>
<span class=normal>2178</span>
<span class=normal>2179</span>
<span class=normal>2180</span>
<span class=normal>2181</span>
<span class=normal>2182</span>
<span class=normal>2183</span>
<span class=normal>2184</span>
<span class=normal>2185</span>
<span class=normal>2186</span>
<span class=normal>2187</span>
<span class=normal>2188</span>
<span class=normal>2189</span>
<span class=normal>2190</span>
<span class=normal>2191</span>
<span class=normal>2192</span>
<span class=normal>2193</span>
<span class=normal>2194</span>
<span class=normal>2195</span>
<span class=normal>2196</span>
<span class=normal>2197</span>
<span class=normal>2198</span>
<span class=normal>2199</span>
<span class=normal>2200</span>
<span class=normal>2201</span>
<span class=normal>2202</span>
<span class=normal>2203</span>
<span class=normal>2204</span>
<span class=normal>2205</span>
<span class=normal>2206</span>
<span class=normal>2207</span>
<span class=normal>2208</span>
<span class=normal>2209</span>
<span class=normal>2210</span>
<span class=normal>2211</span>
<span class=normal>2212</span>
<span class=normal>2213</span>
<span class=normal>2214</span>
<span class=normal>2215</span>
<span class=normal>2216</span>
<span class=normal>2217</span>
<span class=normal>2218</span>
<span class=normal>2219</span>
<span class=normal>2220</span>
<span class=normal>2221</span>
<span class=normal>2222</span>
<span class=normal>2223</span>
<span class=normal>2224</span>
<span class=normal>2225</span>
<span class=normal>2226</span>
<span class=normal>2227</span>
<span class=normal>2228</span>
<span class=normal>2229</span>
<span class=normal>2230</span>
<span class=normal>2231</span>
<span class=normal>2232</span>
<span class=normal>2233</span>
<span class=normal>2234</span>
<span class=normal>2235</span>
<span class=normal>2236</span>
<span class=normal>2237</span>
<span class=normal>2238</span>
<span class=normal>2239</span>
<span class=normal>2240</span>
<span class=normal>2241</span>
<span class=normal>2242</span>
<span class=normal>2243</span>
<span class=normal>2244</span>
<span class=normal>2245</span>
<span class=normal>2246</span>
<span class=normal>2247</span>
<span class=normal>2248</span>
<span class=normal>2249</span>
<span class=normal>2250</span>
<span class=normal>2251</span>
<span class=normal>2252</span>
<span class=normal>2253</span>
<span class=normal>2254</span>
<span class=normal>2255</span>
<span class=normal>2256</span>
<span class=normal>2257</span>
<span class=normal>2258</span>
<span class=normal>2259</span>
<span class=normal>2260</span>
<span class=normal>2261</span>
<span class=normal>2262</span>
<span class=normal>2263</span>
<span class=normal>2264</span>
<span class=normal>2265</span>
<span class=normal>2266</span>
<span class=normal>2267</span>
<span class=normal>2268</span>
<span class=normal>2269</span>
<span class=normal>2270</span>
<span class=normal>2271</span>
<span class=normal>2272</span>
<span class=normal>2273</span>
<span class=normal>2274</span>
<span class=normal>2275</span>
<span class=normal>2276</span>
<span class=normal>2277</span>
<span class=normal>2278</span>
<span class=normal>2279</span>
<span class=normal>2280</span>
<span class=normal>2281</span>
<span class=normal>2282</span>
<span class=normal>2283</span>
<span class=normal>2284</span>
<span class=normal>2285</span>
<span class=normal>2286</span>
<span class=normal>2287</span>
<span class=normal>2288</span>
<span class=normal>2289</span>
<span class=normal>2290</span>
<span class=normal>2291</span>
<span class=normal>2292</span>
<span class=normal>2293</span>
<span class=normal>2294</span>
<span class=normal>2295</span>
<span class=normal>2296</span>
<span class=normal>2297</span>
<span class=normal>2298</span>
<span class=normal>2299</span>
<span class=normal>2300</span>
<span class=normal>2301</span>
<span class=normal>2302</span>
<span class=normal>2303</span>
<span class=normal>2304</span>
<span class=normal>2305</span>
<span class=normal>2306</span>
<span class=normal>2307</span>
<span class=normal>2308</span>
<span class=normal>2309</span>
<span class=normal>2310</span>
<span class=normal>2311</span>
<span class=normal>2312</span>
<span class=normal>2313</span>
<span class=normal>2314</span>
<span class=normal>2315</span>
<span class=normal>2316</span>
<span class=normal>2317</span>
<span class=normal>2318</span>
<span class=normal>2319</span>
<span class=normal>2320</span>
<span class=normal>2321</span>
<span class=normal>2322</span>
<span class=normal>2323</span>
<span class=normal>2324</span>
<span class=normal>2325</span>
<span class=normal>2326</span>
<span class=normal>2327</span>
<span class=normal>2328</span>
<span class=normal>2329</span>
<span class=normal>2330</span>
<span class=normal>2331</span>
<span class=normal>2332</span>
<span class=normal>2333</span>
<span class=normal>2334</span>
<span class=normal>2335</span>
<span class=normal>2336</span>
<span class=normal>2337</span>
<span class=normal>2338</span>
<span class=normal>2339</span>
<span class=normal>2340</span>
<span class=normal>2341</span>
<span class=normal>2342</span>
<span class=normal>2343</span>
<span class=normal>2344</span>
<span class=normal>2345</span>
<span class=normal>2346</span>
<span class=normal>2347</span>
<span class=normal>2348</span>
<span class=normal>2349</span>
<span class=normal>2350</span>
<span class=normal>2351</span>
<span class=normal>2352</span>
<span class=normal>2353</span>
<span class=normal>2354</span>
<span class=normal>2355</span>
<span class=normal>2356</span>
<span class=normal>2357</span>
<span class=normal>2358</span>
<span class=normal>2359</span>
<span class=normal>2360</span>
<span class=normal>2361</span>
<span class=normal>2362</span>
<span class=normal>2363</span>
<span class=normal>2364</span>
<span class=normal>2365</span>
<span class=normal>2366</span>
<span class=normal>2367</span>
<span class=normal>2368</span>
<span class=normal>2369</span>
<span class=normal>2370</span>
<span class=normal>2371</span>
<span class=normal>2372</span>
<span class=normal>2373</span>
<span class=normal>2374</span>
<span class=normal>2375</span>
<span class=normal>2376</span>
<span class=normal>2377</span>
<span class=normal>2378</span>
<span class=normal>2379</span>
<span class=normal>2380</span>
<span class=normal>2381</span>
<span class=normal>2382</span>
<span class=normal>2383</span>
<span class=normal>2384</span>
<span class=normal>2385</span>
<span class=normal>2386</span>
<span class=normal>2387</span>
<span class=normal>2388</span>
<span class=normal>2389</span>
<span class=normal>2390</span>
<span class=normal>2391</span>
<span class=normal>2392</span>
<span class=normal>2393</span>
<span class=normal>2394</span>
<span class=normal>2395</span>
<span class=normal>2396</span>
<span class=normal>2397</span>
<span class=normal>2398</span>
<span class=normal>2399</span>
<span class=normal>2400</span>
<span class=normal>2401</span>
<span class=normal>2402</span>
<span class=normal>2403</span>
<span class=normal>2404</span>
<span class=normal>2405</span>
<span class=normal>2406</span>
<span class=normal>2407</span>
<span class=normal>2408</span>
<span class=normal>2409</span>
<span class=normal>2410</span>
<span class=normal>2411</span>
<span class=normal>2412</span>
<span class=normal>2413</span>
<span class=normal>2414</span>
<span class=normal>2415</span>
<span class=normal>2416</span>
<span class=normal>2417</span>
<span class=normal>2418</span>
<span class=normal>2419</span>
<span class=normal>2420</span>
<span class=normal>2421</span>
<span class=normal>2422</span>
<span class=normal>2423</span>
<span class=normal>2424</span>
<span class=normal>2425</span>
<span class=normal>2426</span>
<span class=normal>2427</span>
<span class=normal>2428</span>
<span class=normal>2429</span>
<span class=normal>2430</span>
<span class=normal>2431</span>
<span class=normal>2432</span>
<span class=normal>2433</span>
<span class=normal>2434</span>
<span class=normal>2435</span>
<span class=normal>2436</span>
<span class=normal>2437</span>
<span class=normal>2438</span>
<span class=normal>2439</span>
<span class=normal>2440</span>
<span class=normal>2441</span>
<span class=normal>2442</span>
<span class=normal>2443</span>
<span class=normal>2444</span>
<span class=normal>2445</span>
<span class=normal>2446</span>
<span class=normal>2447</span>
<span class=normal>2448</span>
<span class=normal>2449</span>
<span class=normal>2450</span>
<span class=normal>2451</span>
<span class=normal>2452</span>
<span class=normal>2453</span>
<span class=normal>2454</span>
<span class=normal>2455</span>
<span class=normal>2456</span>
<span class=normal>2457</span>
<span class=normal>2458</span>
<span class=normal>2459</span>
<span class=normal>2460</span>
<span class=normal>2461</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>PipeAnalysis</span><span class=p>(</span><span class=n>PipeRun</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Class that represents an Analysis instance of a Pipeline run.</span>
<span class=sd>    Inherits from class `PipeRun`.</span>

<span class=sd>    Attributes:</span>
<span class=sd>        associations (pandas.core.frame.DataFrame): Associations dataframe</span>
<span class=sd>            from the pipeline run loaded from &#39;associations.parquet&#39;.</span>
<span class=sd>        bands (pandas.core.frame.DataFrame): The bands dataframe from the</span>
<span class=sd>            pipeline run loaded from &#39;bands.parquet&#39;.</span>
<span class=sd>        images (pandas.core.frame.DataFrame):</span>
<span class=sd>            Dataframe containing all the information on the images</span>
<span class=sd>            of the pipeline run.</span>
<span class=sd>        measurements (pandas.core.frame.DataFrame):</span>
<span class=sd>            Dataframe containing all the information on the measurements</span>
<span class=sd>            of the pipeline run.</span>
<span class=sd>        measurement_pairs_file (List[str]):</span>
<span class=sd>            List containing the locations of the measurement_pairs.parquet (or</span>
<span class=sd>            .arrow) file(s).</span>
<span class=sd>        name (str):</span>
<span class=sd>            The pipeline run name.</span>
<span class=sd>        n_workers (int):</span>
<span class=sd>            Number of workers (cpus) available.</span>
<span class=sd>        relations (pandas.core.frame.DataFrame):</span>
<span class=sd>            Dataframe containing all the information on the relations</span>
<span class=sd>            of the pipeline run.</span>
<span class=sd>        skyregions (pandas.core.frame.DataFrame):</span>
<span class=sd>            Dataframe containing all the information on the skyregions</span>
<span class=sd>            of the pipeline run.</span>
<span class=sd>        sources (pandas.core.frame.DataFrame):</span>
<span class=sd>            Dataframe containing all the information on the sources</span>
<span class=sd>            of the pipeline run.</span>
<span class=sd>        sources_skycoord (astropy.coordinates.sky_coordinate.SkyCoord):</span>
<span class=sd>            A SkyCoord object of the default sources attribute.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>images</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>skyregions</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>relations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>sources</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>associations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>bands</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>measurements</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
        <span class=n>measurement_pairs_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>vaex_meas</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
        <span class=n>scheduler</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;processes&#39;</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Constructor method.</span>

<span class=sd>        Args:</span>
<span class=sd>            name: The name of the pipeline run.</span>
<span class=sd>            images: Images dataframe from the pipeline run</span>
<span class=sd>                loaded from images.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            skyregions: Sky regions dataframe from the pipeline run</span>
<span class=sd>                loaded from skyregions.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            relations: Relations dataframe from the pipeline run</span>
<span class=sd>                loaded from relations.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            sources: Sources dataframe from the pipeline run</span>
<span class=sd>                loaded from sources.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            associations: Associations dataframe from the pipeline run loaded</span>
<span class=sd>                from &#39;associations.parquet&#39;. A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            bands: The bands dataframe from the pipeline run loaded from</span>
<span class=sd>                &#39;bands.parquet&#39;.</span>
<span class=sd>            measurements: Measurements dataframe from the pipeline run</span>
<span class=sd>                loaded from measurements.parquet and the forced measurements</span>
<span class=sd>                parquet files.  A `pandas.core.frame.DataFrame` or</span>
<span class=sd>                `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>            measurement_pairs_file: The location of the two epoch pairs file</span>
<span class=sd>                from the pipeline. It is a list of locations due to the fact</span>
<span class=sd>                that two pipeline runs could be combined.</span>
<span class=sd>            vaex_meas: &#39;True&#39; if the measurements have been loaded using</span>
<span class=sd>                vaex from an arrow file. `False` means the measurements are</span>
<span class=sd>                loaded into a pandas DataFrame.</span>
<span class=sd>            n_workers: Number of workers (cpus) available.</span>
<span class=sd>            scheduler: Dask scheduling option to use. Options are &quot;processes&quot;</span>
<span class=sd>                (parallel processing) or &quot;single-threaded&quot;. Defaults to</span>
<span class=sd>                &quot;single-threaded&quot;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span>
            <span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span>
            <span class=n>bands</span><span class=p>,</span> <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=p>,</span> <span class=n>n_workers</span><span class=p>,</span>
            <span class=n>scheduler</span>
        <span class=p>)</span>

    <span class=k>def</span> <span class=nf>_filter_meas_pairs_df</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>measurements_df</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        A utility method to filter the measurement pairs dataframe to remove</span>
<span class=sd>        pairs that are no longer in the measurements dataframe.</span>

<span class=sd>        Args:</span>
<span class=sd>            measurements_df: The altered measurements dataframe in the same</span>
<span class=sd>                format as the standard pipeline dataframe.</span>

<span class=sd>        Returns:</span>
<span class=sd>            The filtered measurement pairs dataframe.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>load_two_epoch_metrics</span><span class=p>()</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span>
            <span class=p>)</span>

        <span class=n>mask_a</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;meas_id_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
            <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
        <span class=p>)</span><span class=o>.</span><span class=n>values</span>

        <span class=n>mask_b</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;meas_id_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
            <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
        <span class=p>)</span><span class=o>.</span><span class=n>values</span>

        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;mask_a&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>mask_a</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;mask_b&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>mask_b</span>

        <span class=n>mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_and</span><span class=p>(</span><span class=n>mask_a</span><span class=p>,</span> <span class=n>mask_b</span><span class=p>)</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;mask&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>mask</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=p>[</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;mask&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span>
        <span class=p>]</span>

        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=p>[</span><span class=s1>&#39;mask_a&#39;</span><span class=p>,</span> <span class=s1>&#39;mask_b&#39;</span><span class=p>,</span> <span class=s1>&#39;mask&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

        <span class=k>return</span> <span class=n>new_measurement_pairs</span>

    <span class=k>def</span> <span class=nf>recalc_measurement_pairs_df</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>measurements_df</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        A method to recalculate the two epoch pair metrics based upon a</span>
<span class=sd>        provided altered measurements dataframe.</span>

<span class=sd>        Designed for use when the measurement fluxes have been changed.</span>

<span class=sd>        Args:</span>
<span class=sd>            measurements_df: The altered measurements dataframe in the same</span>
<span class=sd>                format as the standard pipeline dataframe.</span>

<span class=sd>        Returns:</span>
<span class=sd>            The recalculated measurement pairs dataframe.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>load_two_epoch_metrics</span><span class=p>()</span>

        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_filter_meas_pairs_df</span><span class=p>(</span>
            <span class=n>measurements_df</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>]]</span>
        <span class=p>)</span>

        <span class=c1># an attempt to conserve memory</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>new_measurement_pairs</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>):</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
                <span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;vs_int&#39;</span><span class=p>,</span> <span class=s1>&#39;m_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;m_int&#39;</span><span class=p>]</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
                <span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;vs_int&#39;</span><span class=p>,</span> <span class=s1>&#39;m_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;m_int&#39;</span><span class=p>],</span>
                <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
            <span class=p>)</span>

        <span class=n>flux_cols</span> <span class=o>=</span> <span class=p>[</span>
            <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span>
            <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span>
            <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span>
            <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span>
            <span class=s1>&#39;id&#39;</span>
        <span class=p>]</span>

        <span class=c1># convert a vaex measurements df to panads so an index can be set</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>):</span>
            <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=p>[</span><span class=n>flux_cols</span><span class=p>]</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>flux_cols</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=n>measurements_df</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurements_df</span>
            <span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>
            <span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>flux_cols</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=s1>&#39;id&#39;</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]:</span>
                <span class=n>pairs_i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;_</span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s1>&#39;</span>
                <span class=n>id_values</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;meas_id_</span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
                <span class=n>new_flux_values</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>id_values</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
                <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=n>pairs_i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_flux_values</span>

        <span class=k>del</span> <span class=n>measurements_df</span>

        <span class=c1># calculate 2-epoch metrics</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;vs_peak&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_vs_metric</span><span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_err_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_err_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;vs_int&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_vs_metric</span><span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_err_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_err_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;m_peak&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_m_metric</span><span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;m_int&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_m_metric</span><span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>new_measurement_pairs</span>

    <span class=k>def</span> <span class=nf>recalc_sources_df</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>measurements_df</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
        <span class=n>min_vs</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
        <span class=n>measurement_pairs_df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Regenerates a sources dataframe using a user provided measurements</span>
<span class=sd>        dataframe.</span>

<span class=sd>        Args:</span>
<span class=sd>            measurements_df: Dataframe of measurements with default pipeline</span>
<span class=sd>                columns. A `pandas.core.frame.DataFrame` or</span>
<span class=sd>                `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>            min_vs: Minimum value of the Vs two epoch parameter to use</span>
<span class=sd>                when appending the two epoch metrics maximum.</span>
<span class=sd>            measurement_pairs_df: The recalculated measurement pairs dataframe</span>
<span class=sd>                if applicable. If not provided then the process will assume</span>
<span class=sd>                the fluxes have not changed and will purely filter the</span>
<span class=sd>                measurement pairs dataframe.</span>

<span class=sd>        Returns:</span>
<span class=sd>            The regenerated sources_df.  A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>

<span class=sd>        Raises:</span>
<span class=sd>            MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>                exist for this run</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

        <span class=c1># Two epoch metrics</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>load_two_epoch_metrics</span><span class=p>()</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>)</span>

        <span class=c1># account for RA wrapping</span>
        <span class=n>ra_wrap_mask</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>ra</span> <span class=o>&lt;=</span> <span class=mf>0.1</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra_wrap&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
            <span class=n>ra_wrap_mask</span><span class=p>,</span> <span class=n>measurements_df</span><span class=p>[</span><span class=n>ra_wrap_mask</span><span class=p>]</span><span class=o>.</span><span class=n>ra</span> <span class=o>+</span> <span class=mf>360.</span><span class=p>,</span>
            <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;interim_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra_wrap&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;interim_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>]:</span>
            <span class=n>measurements_df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_sq&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>measurements_df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>**</span> <span class=mf>2.</span><span class=p>)</span>

        <span class=c1># most of the aggregate calculations done in vaex</span>
        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
            <span class=n>by</span><span class=o>=</span><span class=s1>&#39;source&#39;</span><span class=p>,</span>
            <span class=n>agg</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                    <span class=s1>&#39;interim_ew&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                    <span class=s1>&#39;interim_ns&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                    <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                    <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;avg_compactness&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span>
                    <span class=s1>&#39;compactness&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;min_snr&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span>
                    <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;max_snr&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span>
                    <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
                <span class=p>),</span>
                <span class=s1>&#39;avg_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
                <span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
                <span class=s1>&#39;max_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
                <span class=s1>&#39;max_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
                <span class=s1>&#39;min_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
                <span class=s1>&#39;min_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
                <span class=s1>&#39;min_flux_peak_isl_ratio&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>),</span>
                <span class=s1>&#39;min_flux_int_isl_ratio&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>),</span>
                <span class=s1>&#39;n_measurements&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>),</span>
                <span class=s1>&#39;n_selavy&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span><span class=p>),</span>
                <span class=s1>&#39;n_forced&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==True&#39;</span><span class=p>),</span>
                <span class=s1>&#39;n_siblings&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=s1>&#39;has_siblings&#39;</span><span class=p>)</span>
            <span class=p>}</span>
        <span class=p>)</span>

        <span class=c1># Drop sources which no longer have any selavy measurements</span>
        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=n>sources_df</span><span class=o>.</span><span class=n>n_selavy</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>

        <span class=c1># Calculate average position</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>])</span>
        <span class=p>)</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>])</span>
        <span class=p>)</span>

        <span class=c1># the RA wrapping is reverted at the end of the function when the</span>
        <span class=c1># df is in pandas format.</span>

        <span class=c1># TraP variability metrics, using Dask.</span>
        <span class=n>measurements_df_temp</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=p>[[</span>
            <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span>
        <span class=p>]]</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

        <span class=n>col_dtype</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;eta_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;eta_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=p>}</span>

        <span class=n>sources_df_fluxes</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements_df_temp</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>)</span>
            <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
            <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                <span class=n>pipeline_get_variable_metrics</span><span class=p>,</span>
                <span class=n>meta</span><span class=o>=</span><span class=n>col_dtype</span>
            <span class=p>)</span>
            <span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=n>num_workers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=c1># Switch to pandas at this point to perform join</span>
        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>

        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_fluxes</span><span class=p>)</span>

        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>[[</span><span class=s1>&#39;new&#39;</span><span class=p>,</span> <span class=s1>&#39;new_high_sigma&#39;</span><span class=p>]],</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>measurement_pairs_df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_filter_meas_pairs_df</span><span class=p>(</span>
                <span class=n>measurements_df</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>]]</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>):</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>measurement_pairs_df</span><span class=p>[</span>
                    <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span>
                    <span class=ow>or</span> <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span>
                <span class=p>]</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>min_vs_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_or</span><span class=p>(</span>
                <span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span><span class=p>)</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
                <span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span><span class=p>)</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
            <span class=p>)</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>min_vs_mask</span><span class=p>]</span>
            <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>new_measurement_pairs</span><span class=p>)</span>

        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_int_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
        <span class=p>)</span>

        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_peak_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
        <span class=p>)</span>

        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_int_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
        <span class=p>)</span>

        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_peak_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
        <span class=p>)</span>

        <span class=n>sources_df_two_epochs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
            <span class=s1>&#39;source_id&#39;</span><span class=p>,</span>
            <span class=n>agg</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;vs_significant_max_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;vs_int_abs&#39;</span><span class=p>),</span>
                <span class=s1>&#39;vs_significant_max_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;vs_peak_abs&#39;</span><span class=p>),</span>
                <span class=s1>&#39;m_abs_significant_max_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;m_int_abs&#39;</span><span class=p>),</span>
                <span class=s1>&#39;m_abs_significant_max_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;m_peak_abs&#39;</span><span class=p>),</span>
            <span class=p>}</span>
        <span class=p>)</span>

        <span class=n>sources_df_two_epochs</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>sources_df_two_epochs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;source_id&#39;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_two_epochs</span><span class=p>)</span>

        <span class=k>del</span> <span class=n>sources_df_two_epochs</span>

        <span class=c1># new relation numbers</span>
        <span class=n>relation_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_and</span><span class=p>(</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>from_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>sources_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)),</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>to_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>sources_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>))</span>
        <span class=p>)</span>

        <span class=n>new_relations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_mask</span><span class=p>]</span>

        <span class=n>sources_df_relations</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>new_relations</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;from_source_id&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
        <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;to_source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;n_relations&#39;</span><span class=p>})</span>

        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_relations</span><span class=p>)</span>
        <span class=c1># nearest neighbour</span>
        <span class=n>sources_sky_coord</span> <span class=o>=</span> <span class=n>gen_skycoord_from_df</span><span class=p>(</span>
            <span class=n>sources_df</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=s1>&#39;wavg_dec&#39;</span>
        <span class=p>)</span>

        <span class=n>idx</span><span class=p>,</span> <span class=n>d2d</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>sources_sky_coord</span><span class=o>.</span><span class=n>match_to_catalog_sky</span><span class=p>(</span>
            <span class=n>sources_sky_coord</span><span class=p>,</span> <span class=n>nthneighbor</span><span class=o>=</span><span class=mi>2</span>
        <span class=p>)</span>

        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_neighbour_dist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>d2d</span><span class=o>.</span><span class=n>degree</span>

        <span class=c1># Fill the NaN values.</span>
        <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=p>{</span>
            <span class=s2>&quot;vs_significant_max_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
            <span class=s2>&quot;m_abs_significant_max_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
            <span class=s2>&quot;vs_significant_max_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
            <span class=s2>&quot;m_abs_significant_max_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
            <span class=s1>&#39;n_relations&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
            <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=mf>0.</span><span class=p>,</span>
            <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=mf>0.</span>
        <span class=p>})</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span>
            <span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>,</span> <span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>,</span>
            <span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>,</span> <span class=s1>&#39;weight_ns_sum&#39;</span>
        <span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

        <span class=c1># correct the RA wrapping</span>
        <span class=n>ra_wrap_mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mf>360.</span><span class=p>)</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
        <span class=n>sources_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>ra_wrap_mask</span><span class=p>,</span> <span class=s1>&#39;wavg_ra&#39;</span>
        <span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>ra_wrap_mask</span><span class=p>][</span><span class=s2>&quot;wavg_ra&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span> <span class=o>-</span> <span class=mf>360.</span>

        <span class=c1># Switch relations column to int</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_relations&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_relations&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>sources_df</span>

    <span class=k>def</span> <span class=nf>_get_epoch_pair_plotting_df</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>df_filter</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>epoch_pair_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>vs_label</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>m_label</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>vs_min</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>m_min</span><span class=p>:</span> <span class=nb>float</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Generates some standard parameters used by both two epoch plotting</span>
<span class=sd>        routines (bokeh and matplotlib).</span>

<span class=sd>        Args:</span>
<span class=sd>            df_filter: Dataframe of measurement pairs with metric</span>
<span class=sd>                information (pre-filtered). A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            epoch_pair_id: The epoch pair to plot.</span>
<span class=sd>            vs_label: The name of the vs column to use (vs_int or vs_peak).</span>
<span class=sd>            m_label: The name of the m column to use (m_int or m_peak).</span>
<span class=sd>            vs_min: The minimum Vs metric value to be considered a candidate.</span>
<span class=sd>            m_min: The minimum m metric absolute value to be</span>
<span class=sd>                considered as candidates.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Tuple of (df_filter, num_pairs, num_candidates, td_days).</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>td_days</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>epoch_pair_id</span><span class=p>][</span><span class=s1>&#39;td&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span>
            <span class=o>/</span> <span class=p>(</span><span class=mf>3600.</span> <span class=o>*</span> <span class=mf>24.</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>num_pairs</span> <span class=o>=</span> <span class=n>df_filter</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

        <span class=c1># convert Vs to absolute for plotting purposes.</span>
        <span class=n>df_filter</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>

        <span class=n>num_candidates</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span>
            <span class=p>(</span><span class=n>df_filter</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>vs_min</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>df_filter</span><span class=p>[</span><span class=n>m_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;</span> <span class=n>m_min</span><span class=p>)</span>
        <span class=p>]</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

        <span class=n>unique_meas_ids</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>pd</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>df_filter</span><span class=p>[[</span><span class=s1>&#39;meas_id_a&#39;</span><span class=p>,</span> <span class=s1>&#39;meas_id_b&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>ravel</span><span class=p>(</span><span class=s1>&#39;K&#39;</span><span class=p>))</span>
        <span class=p>)</span>

        <span class=n>temp_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>unique_meas_ids</span><span class=p>)</span>
        <span class=p>][[</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;forced&#39;</span><span class=p>]]</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=n>temp_meas</span> <span class=o>=</span> <span class=n>temp_meas</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

        <span class=n>temp_meas</span> <span class=o>=</span> <span class=n>temp_meas</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

        <span class=n>df_filter</span> <span class=o>=</span> <span class=n>df_filter</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>temp_meas</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;meas_id_a&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>df_filter</span> <span class=o>=</span> <span class=n>df_filter</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>temp_meas</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;meas_id_b&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
        <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;forced&#39;</span><span class=p>:</span> <span class=s1>&#39;forced_a&#39;</span><span class=p>})</span>

        <span class=n>df_filter</span><span class=p>[</span><span class=s1>&#39;forced_sum&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>df_filter</span><span class=p>[[</span><span class=s1>&#39;forced_a&#39;</span><span class=p>,</span> <span class=s1>&#39;forced_b&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=s1>&#39;sum&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>str</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>df_filter</span><span class=p>,</span> <span class=n>num_pairs</span><span class=p>,</span> <span class=n>num_candidates</span><span class=p>,</span> <span class=n>td_days</span>

    <span class=k>def</span> <span class=nf>_plot_epoch_pair_bokeh</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>epoch_pair_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>vs_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
        <span class=n>m_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.26</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>remove_two_forced</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>plot_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Model</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Adapted from code written by Andrew O&#39;Brien.</span>
<span class=sd>        Plot the results of the two epoch analysis using bokeh. Currently this</span>
<span class=sd>        can only plot one epoch pair at a time.</span>

<span class=sd>        Args:</span>
<span class=sd>            epoch_pair_id: The epoch pair to plot.</span>
<span class=sd>            df: Dataframe of measurement pairs with metric information. A</span>
<span class=sd>                `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            vs_min: The minimum Vs metric value to be considered a candidate,</span>
<span class=sd>                defaults to 4.3.</span>
<span class=sd>            m_min: The minimum m metric absolute value to be considered a</span>
<span class=sd>                candidates, defaults to 0.26.</span>
<span class=sd>            use_int_flux: Whether to use the integrated fluxes instead of</span>
<span class=sd>                the peak fluxes.</span>
<span class=sd>            remove_two_forced: Will exclude any pairs that are both forced</span>
<span class=sd>                extractions if True, defaults to False.</span>
<span class=sd>            plot_style: Select whether to plot with style &#39;a&#39; (Mooley) or</span>
<span class=sd>                &#39;b&#39; (Radcliffe). Defaults to &#39;a&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Bokeh figure.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>vs_label</span> <span class=o>=</span> <span class=s1>&#39;vs_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;vs_peak&#39;</span>
        <span class=n>m_label</span> <span class=o>=</span> <span class=s1>&#39;m_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;m_peak&#39;</span>

        <span class=n>df_filter</span><span class=p>,</span> <span class=n>num_pairs</span><span class=p>,</span> <span class=n>num_candidates</span><span class=p>,</span> <span class=n>td_days</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_get_epoch_pair_plotting_df</span><span class=p>(</span>
                <span class=n>df</span><span class=p>,</span> <span class=n>epoch_pair_id</span><span class=p>,</span> <span class=n>vs_label</span><span class=p>,</span> <span class=n>m_label</span><span class=p>,</span> <span class=n>vs_min</span><span class=p>,</span> <span class=n>m_min</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=n>candidate_perc</span> <span class=o>=</span> <span class=n>num_candidates</span> <span class=o>/</span> <span class=n>num_pairs</span> <span class=o>*</span> <span class=mf>100.</span>

        <span class=n>cmap</span> <span class=o>=</span> <span class=n>factor_cmap</span><span class=p>(</span>
            <span class=s1>&#39;forced_sum&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=n>Category10_3</span><span class=p>,</span> <span class=n>factors</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;0&#39;</span><span class=p>,</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>plot_style</span> <span class=o>==</span> <span class=s1>&#39;a&#39;</span><span class=p>:</span>
            <span class=n>df_filter</span><span class=p>[</span><span class=n>m_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span><span class=n>m_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>

            <span class=n>fig</span> <span class=o>=</span> <span class=n>figure</span><span class=p>(</span>
                <span class=n>x_axis_label</span><span class=o>=</span><span class=s2>&quot;m&quot;</span><span class=p>,</span>
                <span class=n>y_axis_label</span><span class=o>=</span><span class=s2>&quot;Vs&quot;</span><span class=p>,</span>
                <span class=n>y_axis_type</span><span class=o>=</span><span class=s1>&#39;log&#39;</span><span class=p>,</span>
                <span class=n>title</span><span class=o>=</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>epoch_pair_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>td_days</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> days&quot;</span>
                    <span class=sa>f</span><span class=s2>&quot; </span><span class=si>{</span><span class=n>num_candidates</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>num_pairs</span><span class=si>}</span><span class=s2> candidates &quot;</span>
                    <span class=sa>f</span><span class=s2>&quot;(</span><span class=si>{</span><span class=n>candidate_perc</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%)&quot;</span>
                <span class=p>),</span>
                <span class=n>tools</span><span class=o>=</span><span class=s2>&quot;pan,box_select,lasso_select,box_zoom,wheel_zoom,reset&quot;</span><span class=p>,</span>
                <span class=n>tooltips</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;source&quot;</span><span class=p>,</span> <span class=s2>&quot;@source_id&quot;</span><span class=p>)],</span>
            <span class=p>)</span>

            <span class=n>range_len</span> <span class=o>=</span> <span class=mi>2</span> <span class=k>if</span> <span class=n>remove_two_forced</span> <span class=k>else</span> <span class=mi>3</span>

            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>range_len</span><span class=p>):</span>
                <span class=n>source</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span><span class=n>df_filter</span><span class=p>[</span><span class=s1>&#39;forced_sum&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)]</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>source</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
                    <span class=n>fig</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>m_label</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>vs_label</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                        <span class=n>source</span><span class=o>=</span><span class=n>source</span><span class=p>,</span>
                        <span class=n>color</span><span class=o>=</span><span class=n>cmap</span><span class=p>,</span>
                        <span class=n>marker</span><span class=o>=</span><span class=s2>&quot;circle&quot;</span><span class=p>,</span>
                        <span class=n>legend_label</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2> forced&quot;</span><span class=p>,</span>
                        <span class=n>size</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
                        <span class=n>nonselection_fill_alpha</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
                        <span class=n>nonselection_fill_color</span><span class=o>=</span><span class=s2>&quot;grey&quot;</span><span class=p>,</span>
                        <span class=n>nonselection_line_color</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                    <span class=p>)</span>
            <span class=c1># Vertical line</span>
            <span class=n>vline</span> <span class=o>=</span> <span class=n>Span</span><span class=p>(</span>
                <span class=n>location</span><span class=o>=</span><span class=n>m_min</span><span class=p>,</span> <span class=n>dimension</span><span class=o>=</span><span class=s1>&#39;height&#39;</span><span class=p>,</span> <span class=n>line_color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span>
                <span class=n>line_dash</span><span class=o>=</span><span class=s1>&#39;dashed&#39;</span>
            <span class=p>)</span>
            <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>vline</span><span class=p>)</span>
            <span class=c1># Horizontal line</span>
            <span class=n>hline</span> <span class=o>=</span> <span class=n>Span</span><span class=p>(</span>
                <span class=n>location</span><span class=o>=</span><span class=n>vs_min</span><span class=p>,</span> <span class=n>dimension</span><span class=o>=</span><span class=s1>&#39;width&#39;</span><span class=p>,</span> <span class=n>line_color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span>
                <span class=n>line_dash</span><span class=o>=</span><span class=s1>&#39;dashed&#39;</span>
            <span class=p>)</span>
            <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>hline</span><span class=p>)</span>

            <span class=n>variable_region</span> <span class=o>=</span> <span class=n>BoxAnnotation</span><span class=p>(</span>
                <span class=n>left</span><span class=o>=</span><span class=n>m_min</span><span class=p>,</span>
                <span class=n>bottom</span><span class=o>=</span><span class=n>vs_min</span><span class=p>,</span>
                <span class=n>fill_color</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=p>,</span>
                <span class=n>fill_alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span>
                <span class=n>level</span><span class=o>=</span><span class=s2>&quot;underlay&quot;</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>variable_region</span><span class=p>)</span>
            <span class=n>fig</span><span class=o>.</span><span class=n>legend</span><span class=o>.</span><span class=n>location</span> <span class=o>=</span> <span class=s2>&quot;bottom_right&quot;</span>

        <span class=k>else</span><span class=p>:</span>

            <span class=n>fig</span> <span class=o>=</span> <span class=n>figure</span><span class=p>(</span>
                <span class=n>x_axis_label</span><span class=o>=</span><span class=s2>&quot;Vs&quot;</span><span class=p>,</span>
                <span class=n>y_axis_label</span><span class=o>=</span><span class=s2>&quot;m&quot;</span><span class=p>,</span>
                <span class=n>title</span><span class=o>=</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>epoch_pair_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>td_days</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> days&quot;</span>
                    <span class=sa>f</span><span class=s2>&quot; </span><span class=si>{</span><span class=n>num_candidates</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>num_pairs</span><span class=si>}</span><span class=s2> candidates &quot;</span>
                    <span class=sa>f</span><span class=s2>&quot;(</span><span class=si>{</span><span class=n>candidate_perc</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%)&quot;</span>
                <span class=p>),</span>
                <span class=n>tools</span><span class=o>=</span><span class=s2>&quot;pan,box_select,lasso_select,box_zoom,wheel_zoom,reset&quot;</span><span class=p>,</span>
                <span class=n>tooltips</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;source&quot;</span><span class=p>,</span> <span class=s2>&quot;@source_id&quot;</span><span class=p>)],</span>
            <span class=p>)</span>

            <span class=n>range_len</span> <span class=o>=</span> <span class=mi>2</span> <span class=k>if</span> <span class=n>remove_two_forced</span> <span class=k>else</span> <span class=mi>3</span>

            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>range_len</span><span class=p>):</span>
                <span class=n>source</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span><span class=n>df_filter</span><span class=p>[</span><span class=s1>&#39;forced_sum&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)]</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>source</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
                    <span class=n>fig</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>vs_label</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>m_label</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                        <span class=n>source</span><span class=o>=</span><span class=n>source</span><span class=p>,</span>
                        <span class=n>color</span><span class=o>=</span><span class=n>cmap</span><span class=p>,</span>
                        <span class=n>marker</span><span class=o>=</span><span class=s2>&quot;circle&quot;</span><span class=p>,</span>
                        <span class=n>legend_label</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2> forced&quot;</span><span class=p>,</span>
                        <span class=n>size</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
                        <span class=n>nonselection_fill_alpha</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
                        <span class=n>nonselection_fill_color</span><span class=o>=</span><span class=s2>&quot;grey&quot;</span><span class=p>,</span>
                        <span class=n>nonselection_line_color</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                    <span class=p>)</span>

            <span class=n>variable_region_1</span> <span class=o>=</span> <span class=n>BoxAnnotation</span><span class=p>(</span>
                <span class=n>left</span><span class=o>=</span><span class=n>vs_min</span><span class=p>,</span> <span class=n>bottom</span><span class=o>=</span><span class=n>m_min</span><span class=p>,</span>
                <span class=n>fill_color</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;underlay&quot;</span>
            <span class=p>)</span>
            <span class=n>variable_region_2</span> <span class=o>=</span> <span class=n>BoxAnnotation</span><span class=p>(</span>
                <span class=n>left</span><span class=o>=</span><span class=n>vs_min</span><span class=p>,</span> <span class=n>top</span><span class=o>=-</span><span class=n>m_min</span><span class=p>,</span> <span class=n>fill_color</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;underlay&quot;</span>
            <span class=p>)</span>
            <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>variable_region_1</span><span class=p>)</span>
            <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>variable_region_2</span><span class=p>)</span>

            <span class=n>fig</span><span class=o>.</span><span class=n>legend</span><span class=o>.</span><span class=n>location</span> <span class=o>=</span> <span class=s2>&quot;top_right&quot;</span>

        <span class=n>fig</span><span class=o>.</span><span class=n>legend</span><span class=o>.</span><span class=n>click_policy</span> <span class=o>=</span> <span class=s2>&quot;hide&quot;</span>

        <span class=k>return</span> <span class=n>fig</span>

    <span class=k>def</span> <span class=nf>_plot_epoch_pair_matplotlib</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>epoch_pair_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>vs_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
        <span class=n>m_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.26</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>remove_two_forced</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>plot_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Plot the results of the two epoch analysis using matplotlib. Currently</span>
<span class=sd>        this can only plot one epoch pair at a time.</span>

<span class=sd>        Args:</span>
<span class=sd>            epoch_pair_id: The epoch pair to plot.</span>
<span class=sd>            df: Dataframe of measurement pairs with metric information. A</span>
<span class=sd>                `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            vs_min: The minimum Vs metric value to be considered a candidate,</span>
<span class=sd>                defaults to 4.3.</span>
<span class=sd>            m_min: The minimum m metric absolute value to be considered a</span>
<span class=sd>                candidates, defaults to 0.26.</span>
<span class=sd>            use_int_flux: Whether to use the integrated fluxes instead of the</span>
<span class=sd>                peak fluxes.</span>
<span class=sd>            remove_two_forced: Will exclude any pairs that are both forced</span>
<span class=sd>                extractions if True, defaults to False.</span>
<span class=sd>            plot_style: Select whether to plot with style &#39;a&#39; (Mooley) or</span>
<span class=sd>                &#39;b&#39; (Radcliffe). Defaults to &#39;a&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Matplotlib pyplot figure containing the plot.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>  <span class=c1># close any previous ones</span>

        <span class=n>vs_label</span> <span class=o>=</span> <span class=s1>&#39;vs_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;vs_peak&#39;</span>
        <span class=n>m_label</span> <span class=o>=</span> <span class=s1>&#39;m_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;m_peak&#39;</span>

        <span class=n>df_filter</span><span class=p>,</span> <span class=n>num_pairs</span><span class=p>,</span> <span class=n>num_candidates</span><span class=p>,</span> <span class=n>td_days</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_get_epoch_pair_plotting_df</span><span class=p>(</span>
                <span class=n>df</span><span class=p>,</span> <span class=n>epoch_pair_id</span><span class=p>,</span> <span class=n>vs_label</span><span class=p>,</span> <span class=n>m_label</span><span class=p>,</span> <span class=n>vs_min</span><span class=p>,</span> <span class=n>m_min</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=n>candidate_perc</span> <span class=o>=</span> <span class=n>num_candidates</span> <span class=o>/</span> <span class=n>num_pairs</span> <span class=o>*</span> <span class=mf>100.</span>

        <span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
        <span class=n>ax</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>111</span><span class=p>)</span>

        <span class=n>colors</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;C0&quot;</span><span class=p>,</span> <span class=s2>&quot;C1&quot;</span><span class=p>,</span> <span class=s2>&quot;C2&quot;</span><span class=p>]</span>
        <span class=n>labels</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;0 forced&quot;</span><span class=p>,</span> <span class=s2>&quot;1 forced&quot;</span><span class=p>,</span> <span class=s2>&quot;2 forced&quot;</span><span class=p>]</span>

        <span class=n>range_len</span> <span class=o>=</span> <span class=mi>2</span> <span class=k>if</span> <span class=n>remove_two_forced</span> <span class=k>else</span> <span class=mi>3</span>

        <span class=k>if</span> <span class=n>plot_style</span> <span class=o>==</span> <span class=s1>&#39;a&#39;</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>range_len</span><span class=p>):</span>
                <span class=n>mask</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span><span class=s1>&#39;forced_sum&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>mask</span><span class=p>):</span>
                    <span class=n>ax</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span>
                        <span class=n>df_filter</span><span class=p>[</span><span class=n>mask</span><span class=p>][</span><span class=n>m_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>(),</span>
                        <span class=n>df_filter</span><span class=p>[</span><span class=n>mask</span><span class=p>][</span><span class=n>vs_label</span><span class=p>],</span>
                        <span class=n>c</span><span class=o>=</span><span class=n>colors</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>label</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
                        <span class=n>zorder</span><span class=o>=</span><span class=mi>2</span>
                    <span class=p>)</span>

            <span class=n>ax</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>vs_min</span><span class=p>,</span> <span class=n>ls</span><span class=o>=</span><span class=s2>&quot;--&quot;</span><span class=p>,</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>axvline</span><span class=p>(</span><span class=n>m_min</span><span class=p>,</span> <span class=n>ls</span><span class=o>=</span><span class=s2>&quot;--&quot;</span><span class=p>,</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>

            <span class=n>y_limits</span> <span class=o>=</span> <span class=n>ax</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>()</span>
            <span class=n>x_limits</span> <span class=o>=</span> <span class=n>ax</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>()</span>

            <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
                <span class=p>[</span><span class=n>m_min</span><span class=p>,</span> <span class=mf>1e5</span><span class=p>],</span> <span class=n>vs_min</span><span class=p>,</span> <span class=mf>1e5</span><span class=p>,</span>
                <span class=n>color</span><span class=o>=</span><span class=s1>&#39;navajowhite&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>1</span>
            <span class=p>)</span>

            <span class=n>ax</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>x_limits</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>y_limits</span><span class=p>)</span>

            <span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;|$m$|&quot;</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;$V_</span><span class=si>{s}</span><span class=s2>$&quot;</span><span class=p>)</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>([</span><span class=n>vs_min</span><span class=p>,</span> <span class=mi>100</span><span class=p>],</span> <span class=n>m_min</span><span class=p>,</span> <span class=mf>4.2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;gold&quot;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
                <span class=p>[</span><span class=n>vs_min</span><span class=p>,</span> <span class=mi>100</span><span class=p>],</span> <span class=o>-</span><span class=mf>4.2</span><span class=p>,</span> <span class=n>m_min</span> <span class=o>*</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;gold&quot;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span>
            <span class=p>)</span>

            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>range_len</span><span class=p>):</span>
                <span class=n>mask</span> <span class=o>=</span> <span class=n>df_filter</span><span class=p>[</span><span class=s1>&#39;forced_sum&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>mask</span><span class=p>):</span>
                    <span class=n>ax</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span>
                        <span class=n>df_filter</span><span class=p>[</span><span class=n>mask</span><span class=p>][</span><span class=n>vs_label</span><span class=p>],</span> <span class=n>df_filter</span><span class=p>[</span><span class=n>mask</span><span class=p>][</span><span class=n>m_label</span><span class=p>],</span>
                        <span class=n>c</span><span class=o>=</span><span class=n>colors</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>label</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
                    <span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=o>-</span><span class=mf>4.0</span><span class=p>,</span> <span class=mf>4.0</span><span class=p>)</span>

            <span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;$m$&quot;</span><span class=p>)</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;$V_</span><span class=si>{s}</span><span class=s2>$&quot;</span><span class=p>)</span>

        <span class=n>date_string</span> <span class=o>=</span> <span class=s2>&quot;Epoch </span><span class=si>{}</span><span class=s2> (Time </span><span class=si>{:.2f}</span><span class=s2> days)&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>epoch_pair_id</span><span class=p>,</span> <span class=n>td_days</span>
        <span class=p>)</span>
        <span class=n>number_string</span> <span class=o>=</span> <span class=s2>&quot;Candidates: </span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2> (</span><span class=si>{:.2f}</span><span class=s2> %)&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>num_candidates</span><span class=p>,</span> <span class=n>num_pairs</span><span class=p>,</span> <span class=p>(</span><span class=mf>100.</span> <span class=o>*</span> <span class=n>num_candidates</span> <span class=o>/</span> <span class=n>num_pairs</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span>
            <span class=mf>0.6</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=n>date_string</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>number_string</span><span class=p>,</span>
            <span class=n>transform</span><span class=o>=</span><span class=n>ax</span><span class=o>.</span><span class=n>transAxes</span>
        <span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>

        <span class=k>return</span> <span class=n>fig</span>

    <span class=k>def</span> <span class=nf>plot_two_epoch_pairs</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>epoch_pair_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>vs_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
        <span class=n>m_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.26</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>remove_two_forced</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>plot_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>,</span>
        <span class=n>plot_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Model</span><span class=p>,</span> <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Adapted from code written by Andrew O&#39;Brien.</span>
<span class=sd>        Plot the results of the two epoch analysis. Currently this can only</span>
<span class=sd>        plot one epoch pair at a time.</span>

<span class=sd>        Args:</span>
<span class=sd>            epoch_pair_id: The epoch pair to plot.</span>
<span class=sd>            query: String query to apply to the dataframe before the analysis</span>
<span class=sd>                is run, defaults to None.</span>
<span class=sd>            df: Dataframe of sources from the pipeline run, defaults to None.</span>
<span class=sd>                If None then the sources from the PipeAnalysis object are used.</span>
<span class=sd>            vs_min: The minimum Vs metric value to be considered a candidate,</span>
<span class=sd>                defaults to 4.3.</span>
<span class=sd>            m_min: The minimum m metric absolute value to be considered a</span>
<span class=sd>                candidate, defaults to 0.26.</span>
<span class=sd>            use_int_flux: Whether to use the integrated fluxes instead of the</span>
<span class=sd>                peak fluxes.</span>
<span class=sd>            remove_two_forced: Will exclude any pairs that are both forced</span>
<span class=sd>                extractions if True, defaults to False.</span>
<span class=sd>            plot_type: Selects whether the returned plot is &#39;bokeh&#39; or</span>
<span class=sd>                &#39;matplotlib&#39;, defaults to &#39;bokeh&#39;.</span>
<span class=sd>            plot_style: Select whether to plot with style &#39;a&#39; (Mooley)</span>
<span class=sd>                or &#39;b&#39; (Radcliffe). Defaults to &#39;a&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Bokeh or matplotlib figure.</span>

<span class=sd>        Raises:</span>
<span class=sd>            Exception: The two epoch metrics must be loaded before using this</span>
<span class=sd>                function.</span>
<span class=sd>            Exception: &#39;plot_type&#39; is not recognised.</span>
<span class=sd>            Exception: `plot_style` is not recognised.</span>
<span class=sd>            Exception: Pair with entered ID does not exist.</span>
<span class=sd>            MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>                exist for this run</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
                <span class=s2>&quot;The two epoch metrics must first be loaded to use the&quot;</span>
                <span class=s2>&quot; plotting function. Please do so with the command:</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=s2>&quot;&#39;mypiperun.load_two_epoch_metrics()&#39;</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=s2>&quot;and try again.&quot;</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>plot_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=s1>&#39;matplotlib&#39;</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
                <span class=s2>&quot;&#39;plot_type&#39; value is not recognised!&quot;</span>
                <span class=s2>&quot; Must be either &#39;bokeh&#39; or &#39;matplotlib&#39;.&quot;</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>plot_style</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
                <span class=s2>&quot;&#39;plot_style&#39; value is not recognised!&quot;</span>
                <span class=s2>&quot; Must be either &#39;a&#39; for Mooley or &#39;b&#39; for Radcliffe.&quot;</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>epoch_pair_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Pair with ID &#39;</span><span class=si>{</span><span class=n>epoch_pair_id</span><span class=si>}</span><span class=s2>&#39; does not exist!&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

        <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

        <span class=n>pair_epoch_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>epoch_pair_id</span><span class=p>][</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>pair_epoch_key</span> <span class=o>==</span> <span class=n>pair_epoch_key</span>
            <span class=p>]</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span>

        <span class=k>if</span> <span class=n>plot_type</span> <span class=o>==</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>:</span>
            <span class=n>fig</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_epoch_pair_bokeh</span><span class=p>(</span>
                <span class=n>epoch_pair_id</span><span class=p>,</span>
                <span class=n>pairs_df</span><span class=p>,</span>
                <span class=n>vs_min</span><span class=p>,</span>
                <span class=n>m_min</span><span class=p>,</span>
                <span class=n>use_int_flux</span><span class=p>,</span>
                <span class=n>remove_two_forced</span><span class=p>,</span>
                <span class=n>plot_style</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>fig</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_epoch_pair_matplotlib</span><span class=p>(</span>
                <span class=n>epoch_pair_id</span><span class=p>,</span>
                <span class=n>pairs_df</span><span class=p>,</span>
                <span class=n>vs_min</span><span class=p>,</span>
                <span class=n>m_min</span><span class=p>,</span>
                <span class=n>use_int_flux</span><span class=p>,</span>
                <span class=n>remove_two_forced</span><span class=p>,</span>
                <span class=n>plot_style</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>fig</span>

    <span class=k>def</span> <span class=nf>run_two_epoch_analysis</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>vs</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>m</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Run the two epoch analysis on the pipeline run, with optional</span>
<span class=sd>        inputs to use a query or filtered dataframe.</span>

<span class=sd>        Args:</span>
<span class=sd>            vs: The minimum Vs metric value to be considered a candidate.</span>
<span class=sd>            m: The minimum m metric absolute value to be considered a</span>
<span class=sd>                candidate.</span>
<span class=sd>            query: String query to apply to the dataframe before the analysis</span>
<span class=sd>                is run, defaults to None.</span>
<span class=sd>            df: Dataframe of sources from the pipeline run, defaults to None.</span>
<span class=sd>                If None then the sources from the PipeAnalysis object are used.</span>
<span class=sd>            use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>                peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Tuple containing two dataframes of the candidate sources and pairs.</span>

<span class=sd>        Raises:</span>
<span class=sd>            Exception: The two epoch metrics must be loaded before using this</span>
<span class=sd>                function.</span>
<span class=sd>            MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>                exist for this run</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
                <span class=s2>&quot;The two epoch metrics must first be loaded to use the&quot;</span>
                <span class=s2>&quot; plotting function. Please do so with the command:</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=s2>&quot;&#39;mypiperun.load_two_epoch_metrics()&#39;</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=s2>&quot;and try again.&quot;</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

        <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

        <span class=n>allowed_sources</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
                <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span>
                    <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span>
                <span class=p>]</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                    <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span>
                <span class=p>]</span>

        <span class=n>vs_label</span> <span class=o>=</span> <span class=s1>&#39;vs_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;vs_peak&#39;</span>
        <span class=n>m_abs_label</span> <span class=o>=</span> <span class=s1>&#39;m_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;m_peak&#39;</span>

        <span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
        <span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>

        <span class=c1># If vaex convert these to pandas</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span>
                <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>vs</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>m</span><span class=p>)</span>
            <span class=p>]</span>

            <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>candidate_pairs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>vs</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>m</span><span class=p>)</span>
            <span class=p>]</span>

        <span class=n>unique_sources</span> <span class=o>=</span> <span class=n>candidate_pairs</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>unique</span><span class=p>()</span>

        <span class=n>candidate_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>unique_sources</span><span class=p>]</span>

        <span class=k>return</span> <span class=n>candidate_sources</span><span class=p>,</span> <span class=n>candidate_pairs</span>

    <span class=k>def</span> <span class=nf>_fit_eta_v</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Fits the eta and v distributions with Gaussians. Used from</span>
<span class=sd>        within the &#39;run_eta_v_analysis&#39; method.</span>

<span class=sd>        Args:</span>
<span class=sd>            df: DataFrame containing the sources from the pipeline run. A</span>
<span class=sd>                `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>                peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>        Returns: Tuple containing the eta_fit_mean, eta_fit_sigma, v_fit_mean</span>
<span class=sd>            and the v_fit_sigma.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
            <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_int&#39;</span>
            <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_int&#39;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_peak&#39;</span>
            <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_peak&#39;</span>

        <span class=n>eta_log</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>])</span>
        <span class=n>v_log</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>])</span>

        <span class=n>eta_log_clipped</span> <span class=o>=</span> <span class=n>sigma_clip</span><span class=p>(</span>
            <span class=n>eta_log</span><span class=p>,</span> <span class=n>masked</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>stdfunc</span><span class=o>=</span><span class=n>mad_std</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=mi>3</span>
        <span class=p>)</span>
        <span class=n>v_log_clipped</span> <span class=o>=</span> <span class=n>sigma_clip</span><span class=p>(</span>
            <span class=n>v_log</span><span class=p>,</span> <span class=n>masked</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>stdfunc</span><span class=o>=</span><span class=n>mad_std</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=mi>3</span>
        <span class=p>)</span>

        <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span> <span class=o>=</span> <span class=n>norm</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>eta_log_clipped</span><span class=p>)</span>
        <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span> <span class=o>=</span> <span class=n>norm</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>v_log_clipped</span><span class=p>)</span>

        <span class=k>return</span> <span class=p>(</span><span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span> <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>_gaussian_fit</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span> <span class=n>param_mean</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>param_sigma</span><span class=p>:</span> <span class=nb>float</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>norm</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Returns the Guassian to add to the matplotlib plot.</span>

<span class=sd>        Args:</span>
<span class=sd>            data: Series object containing the log10 values of the</span>
<span class=sd>                distribution to plot.</span>
<span class=sd>            param_mean: The calculated mean of the Gaussian to fit.</span>
<span class=sd>            param_sigma: The calculated sigma of the Gaussian to fit.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Tuple containing the range of the returned data and the</span>
<span class=sd>            Gaussian fit.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>range_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=mi>1000</span><span class=p>)</span>
        <span class=n>fit</span> <span class=o>=</span> <span class=n>norm</span><span class=o>.</span><span class=n>pdf</span><span class=p>(</span><span class=n>range_data</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>param_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>param_sigma</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>range_data</span><span class=p>,</span> <span class=n>fit</span>

    <span class=k>def</span> <span class=nf>_make_bins</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Calculates the bins that should be used for the v, eta distribution</span>
<span class=sd>        using bayesian blocks.</span>

<span class=sd>        Args:</span>
<span class=sd>            x: Series object containing the log10 values of the</span>
<span class=sd>                distribution to plot.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Bins to apply.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>new_bins</span> <span class=o>=</span> <span class=n>bayesian_blocks</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
        <span class=n>binsx</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>new_bins</span><span class=p>[</span><span class=n>a</span><span class=p>]</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span>
                <span class=nb>len</span><span class=p>(</span><span class=n>new_bins</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
            <span class=p>)</span> <span class=k>if</span> <span class=nb>abs</span><span class=p>((</span><span class=n>new_bins</span><span class=p>[</span><span class=n>a</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>new_bins</span><span class=p>[</span><span class=n>a</span><span class=p>])</span> <span class=o>/</span> <span class=n>new_bins</span><span class=p>[</span><span class=n>a</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mf>0.05</span>
        <span class=p>]</span>
        <span class=n>binsx</span> <span class=o>=</span> <span class=n>binsx</span> <span class=o>+</span> <span class=p>[</span><span class=n>new_bins</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]]</span>

        <span class=k>return</span> <span class=n>binsx</span>

    <span class=k>def</span> <span class=nf>eta_v_diagnostic_plot</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Adapted from code written by Antonia Rowlinson.</span>
<span class=sd>        Produces the eta, V &#39;diagnostic plot&#39;</span>
<span class=sd>        (see Rowlinson et al., 2018,</span>
<span class=sd>        https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>

<span class=sd>        Args:</span>
<span class=sd>            eta_cutoff: The log10 eta_cutoff from the analysis.</span>
<span class=sd>            v_cutoff: The log10 v_cutoff from the analysis.</span>
<span class=sd>            df: Dataframe containing the sources from the Pipeline run. If</span>
<span class=sd>                not provided then the `self.sources` dataframe will be used.</span>
<span class=sd>                A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>                peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            matplotlib figure containing the plot.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>  <span class=c1># close any previous ones</span>

        <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

        <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
            <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_int&#39;</span>
            <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_int&#39;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_peak&#39;</span>
            <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_peak&#39;</span>

        <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>eta_cutoff</span><span class=p>)</span>
        <span class=n>v_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>v_cutoff</span><span class=p>)</span>

        <span class=n>nullfmt</span> <span class=o>=</span> <span class=n>NullFormatter</span><span class=p>()</span>  <span class=c1># no labels</span>

        <span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>12</span><span class=p>))</span>
        <span class=n>ax1</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>221</span><span class=p>)</span>
        <span class=n>ax2</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>222</span><span class=p>)</span>
        <span class=n>ax3</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>223</span><span class=p>)</span>
        <span class=n>ax4</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>224</span><span class=p>)</span>
        <span class=n>fontP</span> <span class=o>=</span> <span class=n>FontProperties</span><span class=p>()</span>
        <span class=n>fontP</span><span class=o>.</span><span class=n>set_size</span><span class=p>(</span><span class=s1>&#39;large&#39;</span><span class=p>)</span>
        <span class=n>fig</span><span class=o>.</span><span class=n>subplots_adjust</span><span class=p>(</span><span class=n>hspace</span><span class=o>=</span><span class=mf>.001</span><span class=p>,</span> <span class=n>wspace</span><span class=o>=</span><span class=mf>0.001</span><span class=p>)</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$\eta_\nu$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$V_\nu$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Max Flux (Jy)&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Max Flux / Median Flux&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span>

        <span class=n>xdata_ax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span>
        <span class=n>xdata_ax4</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]</span>
        <span class=n>ydata_ax1</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>]</span>
        <span class=n>ydata_ax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>]</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax3</span><span class=p>,</span> <span class=n>ydata_ax1</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>,</span> <span class=n>ydata_ax1</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax3</span><span class=p>,</span> <span class=n>ydata_ax3</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>,</span> <span class=n>ydata_ax3</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span>

        <span class=n>Xax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span>
        <span class=n>Xax4</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]</span>
        <span class=n>Yax1</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>]</span>
        <span class=n>Yax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>eta_cutoff</span> <span class=o>!=</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>v_cutoff</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>ax1</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
                <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>
            <span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
                <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>
            <span class=n>ax3</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
                <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>
            <span class=n>ax4</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
                <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>

        <span class=n>ax1</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>set_xscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>set_xscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
        <span class=n>xmin_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Xax3</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
        <span class=n>xmax_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Xax3</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
        <span class=n>xmin_ax4</span> <span class=o>=</span> <span class=mf>0.8</span>
        <span class=n>xmax_ax4</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>)</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
        <span class=n>ymin_ax1</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Yax1</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
        <span class=n>ymax_ax1</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Yax1</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
        <span class=n>ymin_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Yax3</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
        <span class=n>ymax_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Yax3</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ymin_ax1</span><span class=p>,</span> <span class=n>ymax_ax1</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ymin_ax3</span><span class=p>,</span> <span class=n>ymax_ax3</span><span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>xmin_ax3</span><span class=p>,</span> <span class=n>xmax_ax3</span><span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>xmin_ax4</span><span class=p>,</span> <span class=n>xmax_ax4</span><span class=p>)</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>ax3</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ax3</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>ax4</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ax1</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>fig</span>

    <span class=k>def</span> <span class=nf>_plot_eta_v_matplotlib</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>eta_fit_mean</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>eta_fit_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>v_fit_mean</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>v_fit_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>eta_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>v_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Adapted from code written by Antonia Rowlinson.</span>
<span class=sd>        Produces the eta, V candidates plot</span>
<span class=sd>        (see Rowlinson et al., 2018,</span>
<span class=sd>        https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>
<span class=sd>        Returns a matplotlib version.</span>
<span class=sd>        Args:</span>
<span class=sd>            df: Dataframe containing the sources from the pipeline run.</span>
<span class=sd>                A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            eta_fit_mean: The mean of the eta fitted Gaussian.</span>
<span class=sd>            eta_fit_sigma: The sigma of the eta fitted Gaussian.</span>
<span class=sd>            v_fit_mean: The mean of the v fitted Gaussian.</span>
<span class=sd>            v_fit_sigma: The sigma of the v fitted Gaussian.</span>
<span class=sd>            eta_cutoff: The log10 eta_cutoff from the analysis.</span>
<span class=sd>            v_cutoff: The log10 v_cutoff from the analysis.</span>
<span class=sd>            use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>                peak fluxes, defaults to &#39;False&#39;.</span>
<span class=sd>        Returns:</span>
<span class=sd>            Matplotlib figure containing the plot.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>  <span class=c1># close any previous ones</span>
        <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
            <span class=n>x_label</span> <span class=o>=</span> <span class=s1>&#39;eta_int&#39;</span>
            <span class=n>y_label</span> <span class=o>=</span> <span class=s1>&#39;v_int&#39;</span>
            <span class=n>title</span> <span class=o>=</span> <span class=s2>&quot;Int. Flux&quot;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>x_label</span> <span class=o>=</span> <span class=s1>&#39;eta_peak&#39;</span>
            <span class=n>y_label</span> <span class=o>=</span> <span class=s1>&#39;v_peak&#39;</span>
            <span class=n>title</span> <span class=o>=</span> <span class=s1>&#39;Peak Flux&#39;</span>

        <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>eta_cutoff</span><span class=p>)</span>
        <span class=n>v_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>v_cutoff</span><span class=p>)</span>

        <span class=n>nullfmt</span> <span class=o>=</span> <span class=n>NullFormatter</span><span class=p>()</span>  <span class=c1># no labels</span>
        <span class=n>fontP</span> <span class=o>=</span> <span class=n>FontProperties</span><span class=p>()</span>
        <span class=n>fontP</span><span class=o>.</span><span class=n>set_size</span><span class=p>(</span><span class=s1>&#39;large&#39;</span><span class=p>)</span>
        <span class=n>left</span><span class=p>,</span> <span class=n>width</span> <span class=o>=</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.65</span>
        <span class=n>bottom</span><span class=p>,</span> <span class=n>height</span> <span class=o>=</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.65</span>
        <span class=n>bottom_h</span> <span class=o>=</span> <span class=n>left_h</span> <span class=o>=</span> <span class=n>left</span> <span class=o>+</span> <span class=n>width</span> <span class=o>+</span> <span class=mf>0.02</span>
        <span class=n>rect_scatter</span> <span class=o>=</span> <span class=p>[</span><span class=n>left</span><span class=p>,</span> <span class=n>bottom</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>]</span>
        <span class=n>rect_histx</span> <span class=o>=</span> <span class=p>[</span><span class=n>left</span><span class=p>,</span> <span class=n>bottom_h</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>]</span>
        <span class=n>rect_histy</span> <span class=o>=</span> <span class=p>[</span><span class=n>left_h</span><span class=p>,</span> <span class=n>bottom</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=n>height</span><span class=p>]</span>
        <span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>12</span><span class=p>))</span>
        <span class=n>axScatter</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>223</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$\eta_{\nu}$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$V_{\nu}$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
        <span class=n>axHistx</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>221</span><span class=p>)</span>
        <span class=n>axHisty</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>224</span><span class=p>)</span>
        <span class=n>axHistx</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
        <span class=n>axHisty</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
        <span class=n>axHistx</span><span class=o>.</span><span class=n>axes</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_ticklabels</span><span class=p>([])</span>
        <span class=n>axHisty</span><span class=o>.</span><span class=n>axes</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_ticklabels</span><span class=p>([])</span>

        <span class=n>xdata_var</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>x_label</span><span class=p>])</span>
        <span class=n>ydata_var</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>y_label</span><span class=p>])</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_var</span><span class=p>,</span> <span class=n>ydata_var</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;C0&#39;</span><span class=p>)</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
            <span class=p>[</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=mf>1e4</span><span class=p>],</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=mf>1e4</span><span class=p>,</span>
            <span class=n>color</span><span class=o>=</span><span class=s1>&#39;navajowhite&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span>
        <span class=p>)</span>

        <span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>x_label</span><span class=p>])</span>
        <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>y_label</span><span class=p>])</span>

        <span class=n>axHistx</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span>
            <span class=n>x</span><span class=p>,</span> <span class=n>bins</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_make_bins</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>density</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
            <span class=n>histtype</span><span class=o>=</span><span class=s1>&#39;stepfilled&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;C0&#39;</span>
        <span class=p>)</span>
        <span class=n>axHisty</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span>
            <span class=n>y</span><span class=p>,</span> <span class=n>bins</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_make_bins</span><span class=p>(</span><span class=n>y</span><span class=p>),</span> <span class=n>density</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
            <span class=n>histtype</span><span class=o>=</span><span class=s1>&#39;stepfilled&#39;</span><span class=p>,</span> <span class=n>orientation</span><span class=o>=</span><span class=s1>&#39;horizontal&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;C0&#39;</span>
        <span class=p>)</span>

        <span class=n>xmin</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>)</span>
        <span class=n>xmax</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=mf>1.1</span><span class=p>)</span>
        <span class=n>ymin</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>y</span><span class=p>)</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>)</span>
        <span class=n>ymax</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>y</span><span class=p>)</span> <span class=o>+</span> <span class=mf>1.1</span><span class=p>)</span>
        <span class=n>xvals</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=n>xmin</span><span class=p>,</span> <span class=n>xmax</span><span class=p>)</span>
        <span class=n>xtxts</span> <span class=o>=</span> <span class=p>[</span><span class=sa>r</span><span class=s1>&#39;$10^{&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;}$&#39;</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>xvals</span><span class=p>]</span>
        <span class=n>yvals</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=n>ymin</span><span class=p>,</span> <span class=n>ymax</span><span class=p>)</span>
        <span class=n>ytxts</span> <span class=o>=</span> <span class=p>[</span><span class=sa>r</span><span class=s1>&#39;$10^{&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;}$&#39;</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>yvals</span><span class=p>]</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>([</span><span class=n>xmin</span><span class=p>,</span> <span class=n>xmax</span><span class=p>])</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>([</span><span class=n>ymin</span><span class=p>,</span> <span class=n>ymax</span><span class=p>])</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_xticks</span><span class=p>(</span><span class=n>xvals</span><span class=p>)</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_xticklabels</span><span class=p>(</span><span class=n>xtxts</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_yticks</span><span class=p>(</span><span class=n>yvals</span><span class=p>)</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_yticklabels</span><span class=p>(</span><span class=n>ytxts</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
        <span class=n>axHistx</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>axScatter</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
        <span class=n>axHisty</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>axScatter</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>

        <span class=k>if</span> <span class=n>eta_cutoff</span> <span class=o>!=</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>v_cutoff</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>axHistx</span><span class=o>.</span><span class=n>axvline</span><span class=p>(</span>
                <span class=n>x</span><span class=o>=</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>
            <span class=n>axHisty</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
                <span class=n>y</span><span class=o>=</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>
            <span class=n>axScatter</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
                <span class=n>y</span><span class=o>=</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>
            <span class=n>axScatter</span><span class=o>.</span><span class=n>axvline</span><span class=p>(</span>
                <span class=n>x</span><span class=o>=</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
            <span class=p>)</span>

        <span class=n>range_x</span><span class=p>,</span> <span class=n>fitx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gaussian_fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>)</span>
        <span class=n>axHistx</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>range_x</span><span class=p>,</span> <span class=n>fitx</span><span class=p>,</span> <span class=s1>&#39;k:&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
        <span class=n>range_y</span><span class=p>,</span> <span class=n>fity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gaussian_fit</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>)</span>
        <span class=n>axHisty</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fity</span><span class=p>,</span> <span class=n>range_y</span><span class=p>,</span> <span class=s1>&#39;k:&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>

        <span class=n>axHistx</span><span class=o>.</span><span class=n>set_position</span><span class=p>(</span><span class=n>rect_histx</span><span class=p>)</span>
        <span class=n>axHisty</span><span class=o>.</span><span class=n>set_position</span><span class=p>(</span><span class=n>rect_histy</span><span class=p>)</span>
        <span class=n>axScatter</span><span class=o>.</span><span class=n>set_position</span><span class=p>(</span><span class=n>rect_scatter</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>fig</span>

    <span class=k>def</span> <span class=nf>_plot_eta_v_bokeh</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>eta_fit_mean</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>eta_fit_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>v_fit_mean</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>v_fit_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>eta_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>v_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>gridplot</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Adapted from code written by Andrew O&#39;Brien.</span>
<span class=sd>        Produces the eta, V candidates plot</span>
<span class=sd>        (see Rowlinson et al., 2018,</span>
<span class=sd>        https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>
<span class=sd>        Returns a bokeh version.</span>

<span class=sd>        Args:</span>
<span class=sd>            df: Dataframe containing the sources from the pipeline run. A</span>
<span class=sd>                `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            eta_fit_mean: The mean of the eta fitted Gaussian.</span>
<span class=sd>            eta_fit_sigma: The sigma of the eta fitted Gaussian.</span>
<span class=sd>            v_fit_mean: The mean of the v fitted Gaussian.</span>
<span class=sd>            v_fit_sigma: The sigma of the v fitted Gaussian.</span>
<span class=sd>            eta_cutoff: The log10 eta_cutoff from the analysis.</span>
<span class=sd>            v_cutoff: The log10 v_cutoff from the analysis.</span>
<span class=sd>            use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>                peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Bokeh grid object containing figure.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
            <span class=n>x_label</span> <span class=o>=</span> <span class=s1>&#39;eta_int&#39;</span>
            <span class=n>y_label</span> <span class=o>=</span> <span class=s1>&#39;v_int&#39;</span>
            <span class=n>title</span> <span class=o>=</span> <span class=s2>&quot;Int. Flux&quot;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>x_label</span> <span class=o>=</span> <span class=s1>&#39;eta_peak&#39;</span>
            <span class=n>y_label</span> <span class=o>=</span> <span class=s1>&#39;v_peak&#39;</span>
            <span class=n>title</span> <span class=o>=</span> <span class=s1>&#39;Peak Flux&#39;</span>

        <span class=n>bokeh_df</span> <span class=o>=</span> <span class=n>df</span>
        <span class=n>negative_v</span> <span class=o>=</span> <span class=n>bokeh_df</span><span class=p>[</span><span class=n>y_label</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=n>negative_v</span><span class=o>.</span><span class=n>any</span><span class=p>():</span>
            <span class=n>indices</span> <span class=o>=</span> <span class=n>bokeh_df</span><span class=p>[</span><span class=n>negative_v</span><span class=p>]</span><span class=o>.</span><span class=n>index</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Negative V encountered. Removing...&quot;</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Negative V indices: </span><span class=si>{</span><span class=n>indices</span><span class=o>.</span><span class=n>values</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

            <span class=n>bokeh_df</span> <span class=o>=</span> <span class=n>bokeh_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>indices</span><span class=p>)</span>

        <span class=c1># generate fitted curve data for plotting</span>
        <span class=n>eta_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span>
            <span class=n>norm</span><span class=o>.</span><span class=n>ppf</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>eta_fit_sigma</span><span class=p>),</span>
            <span class=n>norm</span><span class=o>.</span><span class=n>ppf</span><span class=p>(</span><span class=mf>0.999</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>eta_fit_sigma</span><span class=p>),</span>
        <span class=p>)</span>
        <span class=n>eta_y</span> <span class=o>=</span> <span class=n>norm</span><span class=o>.</span><span class=n>pdf</span><span class=p>(</span><span class=n>eta_x</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>eta_fit_sigma</span><span class=p>)</span>

        <span class=n>v_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span>
            <span class=n>norm</span><span class=o>.</span><span class=n>ppf</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>v_fit_sigma</span><span class=p>),</span>
            <span class=n>norm</span><span class=o>.</span><span class=n>ppf</span><span class=p>(</span><span class=mf>0.999</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>v_fit_sigma</span><span class=p>),</span>
        <span class=p>)</span>
        <span class=n>v_y</span> <span class=o>=</span> <span class=n>norm</span><span class=o>.</span><span class=n>pdf</span><span class=p>(</span><span class=n>v_x</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>scale</span><span class=o>=</span><span class=n>v_fit_sigma</span><span class=p>)</span>

        <span class=n>PLOT_WIDTH</span> <span class=o>=</span> <span class=mi>700</span>
        <span class=n>PLOT_HEIGHT</span> <span class=o>=</span> <span class=n>PLOT_WIDTH</span>
        <span class=n>fig</span> <span class=o>=</span> <span class=n>figure</span><span class=p>(</span>
            <span class=n>width</span><span class=o>=</span><span class=n>PLOT_WIDTH</span><span class=p>,</span>
            <span class=n>height</span><span class=o>=</span><span class=n>PLOT_HEIGHT</span><span class=p>,</span>
            <span class=n>aspect_scale</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
            <span class=n>x_axis_type</span><span class=o>=</span><span class=s2>&quot;log&quot;</span><span class=p>,</span>
            <span class=n>y_axis_type</span><span class=o>=</span><span class=s2>&quot;log&quot;</span><span class=p>,</span>
            <span class=n>x_axis_label</span><span class=o>=</span><span class=s2>&quot;eta&quot;</span><span class=p>,</span>
            <span class=n>y_axis_label</span><span class=o>=</span><span class=s2>&quot;V&quot;</span><span class=p>,</span>
            <span class=n>tooltips</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;source&quot;</span><span class=p>,</span> <span class=s2>&quot;@id&quot;</span><span class=p>)],</span>
        <span class=p>)</span>
        <span class=n>cmap</span> <span class=o>=</span> <span class=n>linear_cmap</span><span class=p>(</span>
            <span class=s2>&quot;n_selavy&quot;</span><span class=p>,</span>
            <span class=n>cc</span><span class=o>.</span><span class=n>kb</span><span class=p>,</span>
            <span class=n>df</span><span class=p>[</span><span class=s2>&quot;n_selavy&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>(),</span>
            <span class=n>df</span><span class=p>[</span><span class=s2>&quot;n_selavy&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>(),</span>
        <span class=p>)</span>

        <span class=n>fig</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span>
            <span class=n>x</span><span class=o>=</span><span class=n>x_label</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=n>y_label</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=n>cmap</span><span class=p>,</span>
            <span class=n>marker</span><span class=o>=</span><span class=s2>&quot;circle&quot;</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>source</span><span class=o>=</span><span class=n>df</span>
        <span class=p>)</span>

        <span class=c1># axis histograms</span>
        <span class=c1># filter out any forced-phot points for these</span>
        <span class=n>x_hist</span> <span class=o>=</span> <span class=n>figure</span><span class=p>(</span>
            <span class=n>width</span><span class=o>=</span><span class=n>PLOT_WIDTH</span><span class=p>,</span>
            <span class=n>height</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
            <span class=n>x_range</span><span class=o>=</span><span class=n>fig</span><span class=o>.</span><span class=n>x_range</span><span class=p>,</span>
            <span class=n>y_axis_type</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
            <span class=n>x_axis_type</span><span class=o>=</span><span class=s2>&quot;log&quot;</span><span class=p>,</span>
            <span class=n>x_axis_location</span><span class=o>=</span><span class=s2>&quot;above&quot;</span><span class=p>,</span>
            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;VAST eta-V </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>title</span><span class=p>),</span>
            <span class=n>tools</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>x_hist_data</span><span class=p>,</span> <span class=n>x_hist_edges</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>histogram</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>bokeh_df</span><span class=p>[</span><span class=n>x_label</span><span class=p>]),</span> <span class=n>density</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>bins</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>x_hist</span><span class=o>.</span><span class=n>quad</span><span class=p>(</span>
            <span class=n>top</span><span class=o>=</span><span class=n>x_hist_data</span><span class=p>,</span>
            <span class=n>bottom</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
            <span class=n>left</span><span class=o>=</span><span class=mi>10</span> <span class=o>**</span> <span class=n>x_hist_edges</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>
            <span class=n>right</span><span class=o>=</span><span class=mi>10</span> <span class=o>**</span> <span class=n>x_hist_edges</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span>
        <span class=p>)</span>
        <span class=n>x_hist</span><span class=o>.</span><span class=n>line</span><span class=p>(</span><span class=mi>10</span> <span class=o>**</span> <span class=n>eta_x</span><span class=p>,</span> <span class=n>eta_y</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;black&quot;</span><span class=p>)</span>
        <span class=n>x_hist_sigma_span</span> <span class=o>=</span> <span class=n>Span</span><span class=p>(</span>
            <span class=n>location</span><span class=o>=</span><span class=n>eta_cutoff</span><span class=p>,</span>
            <span class=n>dimension</span><span class=o>=</span><span class=s2>&quot;height&quot;</span><span class=p>,</span>
            <span class=n>line_color</span><span class=o>=</span><span class=s2>&quot;black&quot;</span><span class=p>,</span>
            <span class=n>line_dash</span><span class=o>=</span><span class=s2>&quot;dashed&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>x_hist</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>x_hist_sigma_span</span><span class=p>)</span>
        <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>x_hist_sigma_span</span><span class=p>)</span>

        <span class=n>y_hist</span> <span class=o>=</span> <span class=n>figure</span><span class=p>(</span>
            <span class=n>height</span><span class=o>=</span><span class=n>PLOT_HEIGHT</span><span class=p>,</span>
            <span class=n>width</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
            <span class=n>y_range</span><span class=o>=</span><span class=n>fig</span><span class=o>.</span><span class=n>y_range</span><span class=p>,</span>
            <span class=n>x_axis_type</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
            <span class=n>y_axis_type</span><span class=o>=</span><span class=s2>&quot;log&quot;</span><span class=p>,</span>
            <span class=n>y_axis_location</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>,</span>
            <span class=n>tools</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>y_hist_data</span><span class=p>,</span> <span class=n>y_hist_edges</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>histogram</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>bokeh_df</span><span class=p>[</span><span class=n>y_label</span><span class=p>]),</span> <span class=n>density</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>bins</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>y_hist</span><span class=o>.</span><span class=n>quad</span><span class=p>(</span>
            <span class=n>right</span><span class=o>=</span><span class=n>y_hist_data</span><span class=p>,</span>
            <span class=n>left</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
            <span class=n>top</span><span class=o>=</span><span class=mi>10</span> <span class=o>**</span> <span class=n>y_hist_edges</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>
            <span class=n>bottom</span><span class=o>=</span><span class=mi>10</span> <span class=o>**</span> <span class=n>y_hist_edges</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span>
        <span class=p>)</span>
        <span class=n>y_hist</span><span class=o>.</span><span class=n>line</span><span class=p>(</span><span class=n>v_y</span><span class=p>,</span> <span class=mi>10</span> <span class=o>**</span> <span class=n>v_x</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;black&quot;</span><span class=p>)</span>
        <span class=n>y_hist_sigma_span</span> <span class=o>=</span> <span class=n>Span</span><span class=p>(</span>
            <span class=n>location</span><span class=o>=</span><span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>dimension</span><span class=o>=</span><span class=s2>&quot;width&quot;</span><span class=p>,</span>
            <span class=n>line_color</span><span class=o>=</span><span class=s2>&quot;black&quot;</span><span class=p>,</span>
            <span class=n>line_dash</span><span class=o>=</span><span class=s2>&quot;dashed&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>y_hist</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>y_hist_sigma_span</span><span class=p>)</span>
        <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>y_hist_sigma_span</span><span class=p>)</span>

        <span class=n>variable_region</span> <span class=o>=</span> <span class=n>BoxAnnotation</span><span class=p>(</span>
            <span class=n>left</span><span class=o>=</span><span class=n>eta_cutoff</span><span class=p>,</span>
            <span class=n>bottom</span><span class=o>=</span><span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>fill_color</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=p>,</span>
            <span class=n>fill_alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span>
            <span class=n>level</span><span class=o>=</span><span class=s2>&quot;underlay&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>fig</span><span class=o>.</span><span class=n>add_layout</span><span class=p>(</span><span class=n>variable_region</span><span class=p>)</span>
        <span class=n>grid</span> <span class=o>=</span> <span class=n>gridplot</span><span class=p>(</span>
            <span class=p>[[</span><span class=n>x_hist</span><span class=p>,</span> <span class=n>Spacer</span><span class=p>(</span><span class=n>width</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>100</span><span class=p>)],</span> <span class=p>[</span><span class=n>fig</span><span class=p>,</span> <span class=n>y_hist</span><span class=p>]]</span>
        <span class=p>)</span>
        <span class=n>grid</span><span class=o>.</span><span class=n>css_classes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;mx-auto&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>grid</span>

    <span class=k>def</span> <span class=nf>run_eta_v_analysis</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>eta_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>v_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
        <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>,</span>
        <span class=n>diagnostic</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span>
        <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span>
              <span class=nb>float</span><span class=p>,</span>
              <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
              <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>,</span>
              <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>],</span>
        <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span>
              <span class=nb>float</span><span class=p>,</span>
              <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
              <span class=n>gridplot</span><span class=p>,</span>
              <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>]</span>
    <span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Run the eta, v analysis on the pipeline run, with optional</span>
<span class=sd>        inputs to use a query or filtered dataframe (see Rowlinson</span>
<span class=sd>        et al., 2018,</span>
<span class=sd>        https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>

<span class=sd>        Args:</span>
<span class=sd>            eta_sigma: The minimum sigma value of the eta distribution</span>
<span class=sd>                to be used as a threshold.</span>
<span class=sd>            v_sigma: The minimum sigma value of the v distribution</span>
<span class=sd>                to be used as a threshold.</span>
<span class=sd>            query: String query to apply to the dataframe before</span>
<span class=sd>                the analysis is run, defaults to None.</span>
<span class=sd>            df: Dataframe of sources from the pipeline run, defaults</span>
<span class=sd>                to None. If None then the sources from the PipeAnalysis object</span>
<span class=sd>                are used.</span>
<span class=sd>            use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>                peak fluxes, defaults to &#39;False&#39;.</span>
<span class=sd>            plot_type: Select which format the candidates plot should be</span>
<span class=sd>                returned in. Either &#39;bokeh&#39; or &#39;matplotlib&#39;, defaults</span>
<span class=sd>                to &#39;bokeh&#39;.</span>
<span class=sd>            diagnostic: When &#39;True&#39; the diagnostic plot is also returned,</span>
<span class=sd>                defaults to &#39;False&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Tuple containing the eta cutoff value, the v cutoff value,</span>
<span class=sd>                dataframe of candidates, candidates plot and, if selected, the</span>
<span class=sd>                diagnostic plot.</span>

<span class=sd>        Raise:</span>
<span class=sd>            Exception: Entered `plot_type` is not a valid plot type.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>plot_types</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=s1>&#39;matplotlib&#39;</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>plot_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>plot_types</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
                <span class=s2>&quot;Not a valid plot type!&quot;</span>
                <span class=s2>&quot; Must be &#39;bokeh&#39; or &#39;matplotlib&#39;.&quot;</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

        <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

        <span class=p>(</span>
            <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
            <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span>
        <span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fit_eta_v</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span><span class=p>)</span>

        <span class=n>v_cutoff</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=p>(</span><span class=n>v_fit_mean</span> <span class=o>+</span> <span class=n>v_sigma</span> <span class=o>*</span> <span class=n>v_fit_sigma</span><span class=p>)</span>
        <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=p>(</span><span class=n>eta_fit_mean</span> <span class=o>+</span> <span class=n>eta_sigma</span> <span class=o>*</span> <span class=n>eta_fit_sigma</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>plot_type</span> <span class=o>==</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>:</span>
            <span class=n>plot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_eta_v_bokeh</span><span class=p>(</span>
                <span class=n>df</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
                <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span>
                <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>plot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_eta_v_matplotlib</span><span class=p>(</span>
                <span class=n>df</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
                <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span>
                <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
            <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;int&#39;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;peak&#39;</span>

        <span class=n>candidates</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
            <span class=s2>&quot;v_</span><span class=si>{0}</span><span class=s2> &gt; </span><span class=si>{1}</span><span class=s2> &quot;</span>
            <span class=s2>&quot;&amp; eta_</span><span class=si>{0}</span><span class=s2> &gt; </span><span class=si>{2}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>label</span><span class=p>,</span>
                <span class=n>v_cutoff</span><span class=p>,</span>
                <span class=n>eta_cutoff</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>diagnostic</span><span class=p>:</span>
            <span class=n>diag</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>eta_v_diagnostic_plot</span><span class=p>(</span>
                <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>df</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>plot</span><span class=p>,</span> <span class=n>diag</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>plot</span>

    <span class=k>def</span> <span class=nf>add_credible_levels</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Calculate the minimum credible region of a given skymap</span>
<span class=sd>        containing each source.</span>

<span class=sd>        Args:</span>
<span class=sd>            filename: The path to the skymap in healpix format</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>add_credible_levels</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span> <span class=n>bands</span><span class=p>,</span> <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=s1>&#39;processes&#39;</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.__init__ class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Constructor method.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>name</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The name of the pipeline run.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>images</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Images dataframe from the pipeline run loaded from images.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>skyregions</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Sky regions dataframe from the pipeline run loaded from skyregions.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>relations</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Relations dataframe from the pipeline run loaded from relations.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>sources</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Sources dataframe from the pipeline run loaded from sources.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>associations</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Associations dataframe from the pipeline run loaded from 'associations.parquet'. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>bands</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>The bands dataframe from the pipeline run loaded from 'bands.parquet'.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>measurements</code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Measurements dataframe from the pipeline run loaded from measurements.parquet and the forced measurements parquet files. A <code>pandas.core.frame.DataFrame</code> or <code>vaex.dataframe.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>measurement_pairs_file</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The location of the two epoch pairs file from the pipeline. It is a list of locations due to the fact that two pipeline runs could be combined.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>vaex_meas</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>'True' if the measurements have been loaded using vaex from an arrow file. <code>False</code> means the measurements are loaded into a pandas DataFrame.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td><code>n_workers</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>Number of workers (cpus) available.</p> </div> </td> <td> <code><span title="vasttools.pipeline.HOST_NCPU">HOST_NCPU</span> - 1</code> </td> </tr> <tr class=doc-section-item> <td><code>scheduler</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Dask scheduling option to use. Options are "processes" (parallel processing) or "single-threaded". Defaults to "single-threaded".</p> </div> </td> <td> <code>&#39;processes&#39;</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span>
<span class=normal>873</span>
<span class=normal>874</span>
<span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span>
<span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span>
<span class=normal>888</span>
<span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span>
<span class=normal>892</span>
<span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span>
<span class=normal>911</span>
<span class=normal>912</span>
<span class=normal>913</span>
<span class=normal>914</span>
<span class=normal>915</span>
<span class=normal>916</span>
<span class=normal>917</span>
<span class=normal>918</span>
<span class=normal>919</span>
<span class=normal>920</span>
<span class=normal>921</span>
<span class=normal>922</span>
<span class=normal>923</span>
<span class=normal>924</span>
<span class=normal>925</span>
<span class=normal>926</span>
<span class=normal>927</span>
<span class=normal>928</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>skyregions</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>relations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>sources</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>associations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>bands</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>measurements</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
    <span class=n>measurement_pairs_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>vaex_meas</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
    <span class=n>scheduler</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;processes&#39;</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Constructor method.</span>

<span class=sd>    Args:</span>
<span class=sd>        name: The name of the pipeline run.</span>
<span class=sd>        images: Images dataframe from the pipeline run</span>
<span class=sd>            loaded from images.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        skyregions: Sky regions dataframe from the pipeline run</span>
<span class=sd>            loaded from skyregions.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        relations: Relations dataframe from the pipeline run</span>
<span class=sd>            loaded from relations.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        sources: Sources dataframe from the pipeline run</span>
<span class=sd>            loaded from sources.parquet. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        associations: Associations dataframe from the pipeline run loaded</span>
<span class=sd>            from &#39;associations.parquet&#39;. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        bands: The bands dataframe from the pipeline run loaded from</span>
<span class=sd>            &#39;bands.parquet&#39;.</span>
<span class=sd>        measurements: Measurements dataframe from the pipeline run</span>
<span class=sd>            loaded from measurements.parquet and the forced measurements</span>
<span class=sd>            parquet files.  A `pandas.core.frame.DataFrame` or</span>
<span class=sd>            `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>        measurement_pairs_file: The location of the two epoch pairs file</span>
<span class=sd>            from the pipeline. It is a list of locations due to the fact</span>
<span class=sd>            that two pipeline runs could be combined.</span>
<span class=sd>        vaex_meas: &#39;True&#39; if the measurements have been loaded using</span>
<span class=sd>            vaex from an arrow file. `False` means the measurements are</span>
<span class=sd>            loaded into a pandas DataFrame.</span>
<span class=sd>        n_workers: Number of workers (cpus) available.</span>
<span class=sd>        scheduler: Dask scheduling option to use. Options are &quot;processes&quot;</span>
<span class=sd>            (parallel processing) or &quot;single-threaded&quot;. Defaults to</span>
<span class=sd>            &quot;single-threaded&quot;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span>
        <span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span>
        <span class=n>bands</span><span class=p>,</span> <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=p>,</span> <span class=n>n_workers</span><span class=p>,</span>
        <span class=n>scheduler</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.add_credible_levels class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_credible_levels</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.add_credible_levels class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Calculate the minimum credible region of a given skymap containing each source.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>filename</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The path to the skymap in healpix format</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2450</span>
<span class=normal>2451</span>
<span class=normal>2452</span>
<span class=normal>2453</span>
<span class=normal>2454</span>
<span class=normal>2455</span>
<span class=normal>2456</span>
<span class=normal>2457</span>
<span class=normal>2458</span>
<span class=normal>2459</span>
<span class=normal>2460</span>
<span class=normal>2461</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>add_credible_levels</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate the minimum credible region of a given skymap</span>
<span class=sd>    containing each source.</span>

<span class=sd>    Args:</span>
<span class=sd>        filename: The path to the skymap in healpix format</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>add_credible_levels</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class="doc doc-heading"> <code class="highlight language-python"><span class=n>eta_v_diagnostic_plot</span><span class=p>(</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.eta_v_diagnostic_plot class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Adapted from code written by Antonia Rowlinson. Produces the eta, V 'diagnostic plot' (see Rowlinson et al., 2018, https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>eta_cutoff</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The log10 eta_cutoff from the analysis.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>v_cutoff</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The log10 v_cutoff from the analysis.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>df</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Dataframe containing the sources from the Pipeline run. If not provided then the <code>self.sources</code> dataframe will be used. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>use_int_flux</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Use integrated fluxes for the analysis instead of peak fluxes, defaults to 'False'.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="matplotlib.figure.Figure">Figure</span></code> </td> <td> <div class=doc-md-description> <p>matplotlib figure containing the plot.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span>
<span class=normal>1950</span>
<span class=normal>1951</span>
<span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span>
<span class=normal>1979</span>
<span class=normal>1980</span>
<span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span>
<span class=normal>1986</span>
<span class=normal>1987</span>
<span class=normal>1988</span>
<span class=normal>1989</span>
<span class=normal>1990</span>
<span class=normal>1991</span>
<span class=normal>1992</span>
<span class=normal>1993</span>
<span class=normal>1994</span>
<span class=normal>1995</span>
<span class=normal>1996</span>
<span class=normal>1997</span>
<span class=normal>1998</span>
<span class=normal>1999</span>
<span class=normal>2000</span>
<span class=normal>2001</span>
<span class=normal>2002</span>
<span class=normal>2003</span>
<span class=normal>2004</span>
<span class=normal>2005</span>
<span class=normal>2006</span>
<span class=normal>2007</span>
<span class=normal>2008</span>
<span class=normal>2009</span>
<span class=normal>2010</span>
<span class=normal>2011</span>
<span class=normal>2012</span>
<span class=normal>2013</span>
<span class=normal>2014</span>
<span class=normal>2015</span>
<span class=normal>2016</span>
<span class=normal>2017</span>
<span class=normal>2018</span>
<span class=normal>2019</span>
<span class=normal>2020</span>
<span class=normal>2021</span>
<span class=normal>2022</span>
<span class=normal>2023</span>
<span class=normal>2024</span>
<span class=normal>2025</span>
<span class=normal>2026</span>
<span class=normal>2027</span>
<span class=normal>2028</span>
<span class=normal>2029</span>
<span class=normal>2030</span>
<span class=normal>2031</span>
<span class=normal>2032</span>
<span class=normal>2033</span>
<span class=normal>2034</span>
<span class=normal>2035</span>
<span class=normal>2036</span>
<span class=normal>2037</span>
<span class=normal>2038</span>
<span class=normal>2039</span>
<span class=normal>2040</span>
<span class=normal>2041</span>
<span class=normal>2042</span>
<span class=normal>2043</span>
<span class=normal>2044</span>
<span class=normal>2045</span>
<span class=normal>2046</span>
<span class=normal>2047</span>
<span class=normal>2048</span>
<span class=normal>2049</span>
<span class=normal>2050</span>
<span class=normal>2051</span>
<span class=normal>2052</span>
<span class=normal>2053</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>eta_v_diagnostic_plot</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
    <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Adapted from code written by Antonia Rowlinson.</span>
<span class=sd>    Produces the eta, V &#39;diagnostic plot&#39;</span>
<span class=sd>    (see Rowlinson et al., 2018,</span>
<span class=sd>    https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>

<span class=sd>    Args:</span>
<span class=sd>        eta_cutoff: The log10 eta_cutoff from the analysis.</span>
<span class=sd>        v_cutoff: The log10 v_cutoff from the analysis.</span>
<span class=sd>        df: Dataframe containing the sources from the Pipeline run. If</span>
<span class=sd>            not provided then the `self.sources` dataframe will be used.</span>
<span class=sd>            A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>            peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        matplotlib figure containing the plot.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>  <span class=c1># close any previous ones</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
        <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_int&#39;</span>
        <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_int&#39;</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>eta_label</span> <span class=o>=</span> <span class=s1>&#39;eta_peak&#39;</span>
        <span class=n>v_label</span> <span class=o>=</span> <span class=s1>&#39;v_peak&#39;</span>

    <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>eta_cutoff</span><span class=p>)</span>
    <span class=n>v_cutoff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=n>v_cutoff</span><span class=p>)</span>

    <span class=n>nullfmt</span> <span class=o>=</span> <span class=n>NullFormatter</span><span class=p>()</span>  <span class=c1># no labels</span>

    <span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>12</span><span class=p>))</span>
    <span class=n>ax1</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>221</span><span class=p>)</span>
    <span class=n>ax2</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>222</span><span class=p>)</span>
    <span class=n>ax3</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>223</span><span class=p>)</span>
    <span class=n>ax4</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>224</span><span class=p>)</span>
    <span class=n>fontP</span> <span class=o>=</span> <span class=n>FontProperties</span><span class=p>()</span>
    <span class=n>fontP</span><span class=o>.</span><span class=n>set_size</span><span class=p>(</span><span class=s1>&#39;large&#39;</span><span class=p>)</span>
    <span class=n>fig</span><span class=o>.</span><span class=n>subplots_adjust</span><span class=p>(</span><span class=n>hspace</span><span class=o>=</span><span class=mf>.001</span><span class=p>,</span> <span class=n>wspace</span><span class=o>=</span><span class=mf>0.001</span><span class=p>)</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$\eta_\nu$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;$V_\nu$&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>28</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Max Flux (Jy)&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Max Flux / Median Flux&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span>

    <span class=n>xdata_ax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>xdata_ax4</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>ydata_ax1</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>]</span>
    <span class=n>ydata_ax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>]</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax3</span><span class=p>,</span> <span class=n>ydata_ax1</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>,</span> <span class=n>ydata_ax1</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax3</span><span class=p>,</span> <span class=n>ydata_ax3</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>,</span> <span class=n>ydata_ax3</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mf>10.</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span>

    <span class=n>Xax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>Xax4</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]</span>
    <span class=n>Yax1</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>eta_label</span><span class=p>]</span>
    <span class=n>Yax3</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>v_label</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>eta_cutoff</span> <span class=o>!=</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>v_cutoff</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>
        <span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>
        <span class=n>ax4</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span>
            <span class=n>y</span><span class=o>=</span><span class=mf>10.</span><span class=o>**</span><span class=n>v_cutoff</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span>
        <span class=p>)</span>

    <span class=n>ax1</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_xscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_yscale</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span>
    <span class=n>xmin_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Xax3</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
    <span class=n>xmax_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Xax3</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
    <span class=n>xmin_ax4</span> <span class=o>=</span> <span class=mf>0.8</span>
    <span class=n>xmax_ax4</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>xdata_ax4</span><span class=p>)</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
    <span class=n>ymin_ax1</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Yax1</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
    <span class=n>ymax_ax1</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Yax1</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
    <span class=n>ymin_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>Yax3</span><span class=p>))</span> <span class=o>-</span> <span class=mf>1.1</span><span class=p>))</span>
    <span class=n>ymax_ax3</span> <span class=o>=</span> <span class=mf>10.</span><span class=o>**</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log10</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>Yax3</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1.2</span><span class=p>))</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ymin_ax1</span><span class=p>,</span> <span class=n>ymax_ax1</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ymin_ax3</span><span class=p>,</span> <span class=n>ymax_ax3</span><span class=p>)</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>xmin_ax3</span><span class=p>,</span> <span class=n>xmax_ax3</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>xmin_ax4</span><span class=p>,</span> <span class=n>xmax_ax4</span><span class=p>)</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>ax3</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ax3</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span><span class=n>ax4</span><span class=o>.</span><span class=n>get_xlim</span><span class=p>())</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=n>ax1</span><span class=o>.</span><span class=n>get_ylim</span><span class=p>())</span>
    <span class=n>ax1</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
    <span class=n>ax4</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>yaxis</span><span class=o>.</span><span class=n>set_major_formatter</span><span class=p>(</span><span class=n>nullfmt</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>fig</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class="doc doc-heading"> <code class="highlight language-python"><span class=n>plot_two_epoch_pairs</span><span class=p>(</span><span class=n>epoch_pair_id</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>vs_min</span><span class=o>=</span><span class=mf>4.3</span><span class=p>,</span> <span class=n>m_min</span><span class=o>=</span><span class=mf>0.26</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>remove_two_forced</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=o>=</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=n>plot_style</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.plot_two_epoch_pairs class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Adapted from code written by Andrew O'Brien. Plot the results of the two epoch analysis. Currently this can only plot one epoch pair at a time.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>epoch_pair_id</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>The epoch pair to plot.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>query</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>String query to apply to the dataframe before the analysis is run, defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>df</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Dataframe of sources from the pipeline run, defaults to None. If None then the sources from the PipeAnalysis object are used.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>vs_min</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The minimum Vs metric value to be considered a candidate, defaults to 4.3.</p> </div> </td> <td> <code>4.3</code> </td> </tr> <tr class=doc-section-item> <td><code>m_min</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The minimum m metric absolute value to be considered a candidate, defaults to 0.26.</p> </div> </td> <td> <code>0.26</code> </td> </tr> <tr class=doc-section-item> <td><code>use_int_flux</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Whether to use the integrated fluxes instead of the peak fluxes.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td><code>remove_two_forced</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Will exclude any pairs that are both forced extractions if True, defaults to False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td><code>plot_type</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Selects whether the returned plot is 'bokeh' or 'matplotlib', defaults to 'bokeh'.</p> </div> </td> <td> <code>&#39;bokeh&#39;</code> </td> </tr> <tr class=doc-section-item> <td><code>plot_style</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Select whether to plot with style 'a' (Mooley) or 'b' (Radcliffe). Defaults to 'a'.</p> </div> </td> <td> <code>&#39;a&#39;</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.Union">Union</span>[<span title="bokeh.models.Model">Model</span>, <span title="matplotlib.figure.Figure">Figure</span>]</code> </td> <td> <div class=doc-md-description> <p>Bokeh or matplotlib figure.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p>The two epoch metrics must be loaded before using this function.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p>'plot_type' is not recognised.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p><code>plot_style</code> is not recognised.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p>Pair with entered ID does not exist.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.MeasPairsDoNotExistError" href="#vasttools.pipeline.MeasPairsDoNotExistError">MeasPairsDoNotExistError</a></code> </td> <td> <div class=doc-md-description> <p>The measurement pairs file(s) do not exist for this run</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1663</span>
<span class=normal>1664</span>
<span class=normal>1665</span>
<span class=normal>1666</span>
<span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span>
<span class=normal>1725</span>
<span class=normal>1726</span>
<span class=normal>1727</span>
<span class=normal>1728</span>
<span class=normal>1729</span>
<span class=normal>1730</span>
<span class=normal>1731</span>
<span class=normal>1732</span>
<span class=normal>1733</span>
<span class=normal>1734</span>
<span class=normal>1735</span>
<span class=normal>1736</span>
<span class=normal>1737</span>
<span class=normal>1738</span>
<span class=normal>1739</span>
<span class=normal>1740</span>
<span class=normal>1741</span>
<span class=normal>1742</span>
<span class=normal>1743</span>
<span class=normal>1744</span>
<span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>plot_two_epoch_pairs</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>epoch_pair_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>vs_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
    <span class=n>m_min</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.26</span><span class=p>,</span>
    <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>remove_two_forced</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>plot_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>,</span>
    <span class=n>plot_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Model</span><span class=p>,</span> <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Adapted from code written by Andrew O&#39;Brien.</span>
<span class=sd>    Plot the results of the two epoch analysis. Currently this can only</span>
<span class=sd>    plot one epoch pair at a time.</span>

<span class=sd>    Args:</span>
<span class=sd>        epoch_pair_id: The epoch pair to plot.</span>
<span class=sd>        query: String query to apply to the dataframe before the analysis</span>
<span class=sd>            is run, defaults to None.</span>
<span class=sd>        df: Dataframe of sources from the pipeline run, defaults to None.</span>
<span class=sd>            If None then the sources from the PipeAnalysis object are used.</span>
<span class=sd>        vs_min: The minimum Vs metric value to be considered a candidate,</span>
<span class=sd>            defaults to 4.3.</span>
<span class=sd>        m_min: The minimum m metric absolute value to be considered a</span>
<span class=sd>            candidate, defaults to 0.26.</span>
<span class=sd>        use_int_flux: Whether to use the integrated fluxes instead of the</span>
<span class=sd>            peak fluxes.</span>
<span class=sd>        remove_two_forced: Will exclude any pairs that are both forced</span>
<span class=sd>            extractions if True, defaults to False.</span>
<span class=sd>        plot_type: Selects whether the returned plot is &#39;bokeh&#39; or</span>
<span class=sd>            &#39;matplotlib&#39;, defaults to &#39;bokeh&#39;.</span>
<span class=sd>        plot_style: Select whether to plot with style &#39;a&#39; (Mooley)</span>
<span class=sd>            or &#39;b&#39; (Radcliffe). Defaults to &#39;a&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Bokeh or matplotlib figure.</span>

<span class=sd>    Raises:</span>
<span class=sd>        Exception: The two epoch metrics must be loaded before using this</span>
<span class=sd>            function.</span>
<span class=sd>        Exception: &#39;plot_type&#39; is not recognised.</span>
<span class=sd>        Exception: `plot_style` is not recognised.</span>
<span class=sd>        Exception: Pair with entered ID does not exist.</span>
<span class=sd>        MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>            exist for this run</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;The two epoch metrics must first be loaded to use the&quot;</span>
            <span class=s2>&quot; plotting function. Please do so with the command:</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;&#39;mypiperun.load_two_epoch_metrics()&#39;</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;and try again.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=s1>&#39;matplotlib&#39;</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;&#39;plot_type&#39; value is not recognised!&quot;</span>
            <span class=s2>&quot; Must be either &#39;bokeh&#39; or &#39;matplotlib&#39;.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>plot_style</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;&#39;plot_style&#39; value is not recognised!&quot;</span>
            <span class=s2>&quot; Must be either &#39;a&#39; for Mooley or &#39;b&#39; for Radcliffe.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>epoch_pair_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Pair with ID &#39;</span><span class=si>{</span><span class=n>epoch_pair_id</span><span class=si>}</span><span class=s2>&#39; does not exist!&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

    <span class=n>pair_epoch_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>epoch_pair_id</span><span class=p>][</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>pair_epoch_key</span> <span class=o>==</span> <span class=n>pair_epoch_key</span>
        <span class=p>]</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=o>==</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>:</span>
        <span class=n>fig</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_epoch_pair_bokeh</span><span class=p>(</span>
            <span class=n>epoch_pair_id</span><span class=p>,</span>
            <span class=n>pairs_df</span><span class=p>,</span>
            <span class=n>vs_min</span><span class=p>,</span>
            <span class=n>m_min</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=p>,</span>
            <span class=n>remove_two_forced</span><span class=p>,</span>
            <span class=n>plot_style</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>fig</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_epoch_pair_matplotlib</span><span class=p>(</span>
            <span class=n>epoch_pair_id</span><span class=p>,</span>
            <span class=n>pairs_df</span><span class=p>,</span>
            <span class=n>vs_min</span><span class=p>,</span>
            <span class=n>m_min</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=p>,</span>
            <span class=n>remove_two_forced</span><span class=p>,</span>
            <span class=n>plot_style</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>fig</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.recalc_measurement_pairs_df class="doc doc-heading"> <code class="highlight language-python"><span class=n>recalc_measurement_pairs_df</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.recalc_measurement_pairs_df class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>A method to recalculate the two epoch pair metrics based upon a provided altered measurements dataframe.</p> <p>Designed for use when the measurement fluxes have been changed.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>measurements_df</code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>The altered measurements dataframe in the same format as the standard pipeline dataframe.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>The recalculated measurement pairs dataframe.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>recalc_measurement_pairs_df</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>measurements_df</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    A method to recalculate the two epoch pair metrics based upon a</span>
<span class=sd>    provided altered measurements dataframe.</span>

<span class=sd>    Designed for use when the measurement fluxes have been changed.</span>

<span class=sd>    Args:</span>
<span class=sd>        measurements_df: The altered measurements dataframe in the same</span>
<span class=sd>            format as the standard pipeline dataframe.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The recalculated measurement pairs dataframe.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>load_two_epoch_metrics</span><span class=p>()</span>

    <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_filter_meas_pairs_df</span><span class=p>(</span>
        <span class=n>measurements_df</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>]]</span>
    <span class=p>)</span>

    <span class=c1># an attempt to conserve memory</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>new_measurement_pairs</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>):</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;vs_int&#39;</span><span class=p>,</span> <span class=s1>&#39;m_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;m_int&#39;</span><span class=p>]</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;vs_int&#39;</span><span class=p>,</span> <span class=s1>&#39;m_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;m_int&#39;</span><span class=p>],</span>
            <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>

    <span class=n>flux_cols</span> <span class=o>=</span> <span class=p>[</span>
        <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span>
        <span class=s1>&#39;id&#39;</span>
    <span class=p>]</span>

    <span class=c1># convert a vaex measurements df to panads so an index can be set</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>):</span>
        <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=p>[</span><span class=n>flux_cols</span><span class=p>]</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>flux_cols</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>measurements_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>measurements_df</span>
        <span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>flux_cols</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=s1>&#39;id&#39;</span><span class=p>:</span>
            <span class=k>continue</span>
        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]:</span>
            <span class=n>pairs_i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;_</span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s1>&#39;</span>
            <span class=n>id_values</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;meas_id_</span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
            <span class=n>new_flux_values</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>id_values</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
            <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=n>pairs_i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_flux_values</span>

    <span class=k>del</span> <span class=n>measurements_df</span>

    <span class=c1># calculate 2-epoch metrics</span>
    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;vs_peak&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_vs_metric</span><span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_err_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_err_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
    <span class=p>)</span>
    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;vs_int&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_vs_metric</span><span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_err_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_err_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
    <span class=p>)</span>
    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;m_peak&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_m_metric</span><span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_peak_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
    <span class=p>)</span>
    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s2>&quot;m_int&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>calculate_m_metric</span><span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;flux_int_b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>new_measurement_pairs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.recalc_sources_df class="doc doc-heading"> <code class="highlight language-python"><span class=n>recalc_sources_df</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>,</span> <span class=n>min_vs</span><span class=o>=</span><span class=mf>4.3</span><span class=p>,</span> <span class=n>measurement_pairs_df</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.recalc_sources_df class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Regenerates a sources dataframe using a user provided measurements dataframe.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>measurements_df</code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Dataframe of measurements with default pipeline columns. A <code>pandas.core.frame.DataFrame</code> or <code>vaex.dataframe.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>min_vs</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>Minimum value of the Vs two epoch parameter to use when appending the two epoch metrics maximum.</p> </div> </td> <td> <code>4.3</code> </td> </tr> <tr class=doc-section-item> <td><code>measurement_pairs_df</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>The recalculated measurement pairs dataframe if applicable. If not provided then the process will assume the fluxes have not changed and will purely filter the measurement pairs dataframe.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>The regenerated sources_df. A <code>pandas.core.frame.DataFrame</code></p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>instance.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.MeasPairsDoNotExistError" href="#vasttools.pipeline.MeasPairsDoNotExistError">MeasPairsDoNotExistError</a></code> </td> <td> <div class=doc-md-description> <p>The measurement pairs file(s) do not exist for this run</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span>
<span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>recalc_sources_df</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>measurements_df</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
    <span class=n>min_vs</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>4.3</span><span class=p>,</span>
    <span class=n>measurement_pairs_df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Regenerates a sources dataframe using a user provided measurements</span>
<span class=sd>    dataframe.</span>

<span class=sd>    Args:</span>
<span class=sd>        measurements_df: Dataframe of measurements with default pipeline</span>
<span class=sd>            columns. A `pandas.core.frame.DataFrame` or</span>
<span class=sd>            `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>        min_vs: Minimum value of the Vs two epoch parameter to use</span>
<span class=sd>            when appending the two epoch metrics maximum.</span>
<span class=sd>        measurement_pairs_df: The recalculated measurement pairs dataframe</span>
<span class=sd>            if applicable. If not provided then the process will assume</span>
<span class=sd>            the fluxes have not changed and will purely filter the</span>
<span class=sd>            measurement pairs dataframe.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The regenerated sources_df.  A `pandas.core.frame.DataFrame`</span>
<span class=sd>        instance.</span>

<span class=sd>    Raises:</span>
<span class=sd>        MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>            exist for this run</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

    <span class=c1># Two epoch metrics</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>load_two_epoch_metrics</span><span class=p>()</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=n>measurements_df</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements_df</span><span class=p>)</span>

    <span class=c1># account for RA wrapping</span>
    <span class=n>ra_wrap_mask</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>ra</span> <span class=o>&lt;=</span> <span class=mf>0.1</span>
    <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra_wrap&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
        <span class=n>ra_wrap_mask</span><span class=p>,</span> <span class=n>measurements_df</span><span class=p>[</span><span class=n>ra_wrap_mask</span><span class=p>]</span><span class=o>.</span><span class=n>ra</span> <span class=o>+</span> <span class=mf>360.</span><span class=p>,</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;interim_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;ra_wrap&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;interim_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>measurements_df</span><span class=p>[</span><span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>]:</span>
        <span class=n>measurements_df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_sq&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>measurements_df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>**</span> <span class=mf>2.</span><span class=p>)</span>

    <span class=c1># most of the aggregate calculations done in vaex</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
        <span class=n>by</span><span class=o>=</span><span class=s1>&#39;source&#39;</span><span class=p>,</span>
        <span class=n>agg</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;interim_ew&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;interim_ns&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;avg_compactness&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span>
                <span class=s1>&#39;compactness&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;min_snr&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span>
                <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;max_snr&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span>
                <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span>
            <span class=p>),</span>
            <span class=s1>&#39;avg_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
            <span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
            <span class=s1>&#39;max_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
            <span class=s1>&#39;max_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_int&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_peak_isl_ratio&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>),</span>
            <span class=s1>&#39;min_flux_int_isl_ratio&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_measurements&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_selavy&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==False&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_forced&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=n>selection</span><span class=o>=</span><span class=s1>&#39;forced==True&#39;</span><span class=p>),</span>
            <span class=s1>&#39;n_siblings&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=s1>&#39;has_siblings&#39;</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=c1># Drop sources which no longer have any selavy measurements</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=n>sources_df</span><span class=o>.</span><span class=n>n_selavy</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>

    <span class=c1># Calculate average position</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>])</span>
    <span class=p>)</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;weight_ns_sum&#39;</span><span class=p>])</span>
    <span class=p>)</span>

    <span class=c1># the RA wrapping is reverted at the end of the function when the</span>
    <span class=c1># df is in pandas format.</span>

    <span class=c1># TraP variability metrics, using Dask.</span>
    <span class=n>measurements_df_temp</span> <span class=o>=</span> <span class=n>measurements_df</span><span class=p>[[</span>
        <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span>
    <span class=p>]]</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=n>col_dtype</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;eta_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;eta_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
    <span class=p>}</span>

    <span class=n>sources_df_fluxes</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements_df_temp</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>)</span>
        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=n>pipeline_get_variable_metrics</span><span class=p>,</span>
            <span class=n>meta</span><span class=o>=</span><span class=n>col_dtype</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=n>num_workers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># Switch to pandas at this point to perform join</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_fluxes</span><span class=p>)</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>[[</span><span class=s1>&#39;new&#39;</span><span class=p>,</span> <span class=s1>&#39;new_high_sigma&#39;</span><span class=p>]],</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>measurement_pairs_df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_filter_meas_pairs_df</span><span class=p>(</span>
            <span class=n>measurements_df</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>]]</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>):</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=p>[</span>
                <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span>
                <span class=ow>or</span> <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span>
            <span class=p>]</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>min_vs_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_or</span><span class=p>(</span>
            <span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span><span class=p>)</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(),</span>
            <span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>min_vs</span><span class=p>)</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>min_vs_mask</span><span class=p>]</span>
        <span class=n>new_measurement_pairs</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>new_measurement_pairs</span><span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_int_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_peak_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;vs_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_int_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_peak_abs&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_measurement_pairs</span><span class=p>[</span><span class=s1>&#39;m_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=n>sources_df_two_epochs</span> <span class=o>=</span> <span class=n>new_measurement_pairs</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
        <span class=s1>&#39;source_id&#39;</span><span class=p>,</span>
        <span class=n>agg</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;vs_significant_max_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;vs_int_abs&#39;</span><span class=p>),</span>
            <span class=s1>&#39;vs_significant_max_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;vs_peak_abs&#39;</span><span class=p>),</span>
            <span class=s1>&#39;m_abs_significant_max_int&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;m_int_abs&#39;</span><span class=p>),</span>
            <span class=s1>&#39;m_abs_significant_max_peak&#39;</span><span class=p>:</span> <span class=n>vaex</span><span class=o>.</span><span class=n>agg</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=s1>&#39;m_peak_abs&#39;</span><span class=p>),</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>sources_df_two_epochs</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df_two_epochs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;source_id&#39;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_two_epochs</span><span class=p>)</span>

    <span class=k>del</span> <span class=n>sources_df_two_epochs</span>

    <span class=c1># new relation numbers</span>
    <span class=n>relation_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>logical_and</span><span class=p>(</span>
        <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>from_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>sources_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)),</span>
        <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>to_source_id</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>sources_df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>))</span>
    <span class=p>)</span>

    <span class=n>new_relations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_mask</span><span class=p>]</span>

    <span class=n>sources_df_relations</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>new_relations</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;from_source_id&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;to_source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;n_relations&#39;</span><span class=p>})</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sources_df_relations</span><span class=p>)</span>
    <span class=c1># nearest neighbour</span>
    <span class=n>sources_sky_coord</span> <span class=o>=</span> <span class=n>gen_skycoord_from_df</span><span class=p>(</span>
        <span class=n>sources_df</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=s1>&#39;wavg_dec&#39;</span>
    <span class=p>)</span>

    <span class=n>idx</span><span class=p>,</span> <span class=n>d2d</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>sources_sky_coord</span><span class=o>.</span><span class=n>match_to_catalog_sky</span><span class=p>(</span>
        <span class=n>sources_sky_coord</span><span class=p>,</span> <span class=n>nthneighbor</span><span class=o>=</span><span class=mi>2</span>
    <span class=p>)</span>

    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_neighbour_dist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>d2d</span><span class=o>.</span><span class=n>degree</span>

    <span class=c1># Fill the NaN values.</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=p>{</span>
        <span class=s2>&quot;vs_significant_max_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s2>&quot;m_abs_significant_max_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s2>&quot;vs_significant_max_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s2>&quot;m_abs_significant_max_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
        <span class=s1>&#39;n_relations&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
        <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=mf>0.</span><span class=p>,</span>
        <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=mf>0.</span>
    <span class=p>})</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span>
        <span class=s1>&#39;interim_ew_sum&#39;</span><span class=p>,</span> <span class=s1>&#39;interim_ns_sum&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ew_sum&#39;</span><span class=p>,</span> <span class=s1>&#39;weight_ns_sum&#39;</span>
    <span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=c1># correct the RA wrapping</span>
    <span class=n>ra_wrap_mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mf>360.</span><span class=p>)</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span>
    <span class=n>sources_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=n>ra_wrap_mask</span><span class=p>,</span> <span class=s1>&#39;wavg_ra&#39;</span>
    <span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>ra_wrap_mask</span><span class=p>][</span><span class=s2>&quot;wavg_ra&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span> <span class=o>-</span> <span class=mf>360.</span>

    <span class=c1># Switch relations column to int</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_relations&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;n_relations&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>sources_df</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_eta_v_analysis</span><span class=p>(</span><span class=n>eta_sigma</span><span class=p>,</span> <span class=n>v_sigma</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=o>=</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=n>diagnostic</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.run_eta_v_analysis class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Run the eta, v analysis on the pipeline run, with optional inputs to use a query or filtered dataframe (see Rowlinson et al., 2018, https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>eta_sigma</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The minimum sigma value of the eta distribution to be used as a threshold.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>v_sigma</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The minimum sigma value of the v distribution to be used as a threshold.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>query</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>String query to apply to the dataframe before the analysis is run, defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>df</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Dataframe of sources from the pipeline run, defaults to None. If None then the sources from the PipeAnalysis object are used.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>use_int_flux</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Use integrated fluxes for the analysis instead of peak fluxes, defaults to 'False'.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td><code>plot_type</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Select which format the candidates plot should be returned in. Either 'bokeh' or 'matplotlib', defaults to 'bokeh'.</p> </div> </td> <td> <code>&#39;bokeh&#39;</code> </td> </tr> <tr class=doc-section-item> <td><code>diagnostic</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>When 'True' the diagnostic plot is also returned, defaults to 'False'.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[float, float, <span title="pandas.DataFrame">DataFrame</span>, <span title="matplotlib.figure.Figure">Figure</span>, <span title="matplotlib.figure.Figure">Figure</span>], <span title="typing.Tuple">Tuple</span>[float, float, <span title="pandas.DataFrame">DataFrame</span>, <span title="bokeh.layouts.gridplot">gridplot</span>, <span title="matplotlib.figure.Figure">Figure</span>]]</code> </td> <td> <div class=doc-md-description> <p>Tuple containing the eta cutoff value, the v cutoff value, dataframe of candidates, candidates plot and, if selected, the diagnostic plot.</p> </div> </td> </tr> </tbody> </table> <details class=raise open> <summary>Raise</summary> <p>Exception: Entered <code>plot_type</code> is not a valid plot type.</p> </details> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2344</span>
<span class=normal>2345</span>
<span class=normal>2346</span>
<span class=normal>2347</span>
<span class=normal>2348</span>
<span class=normal>2349</span>
<span class=normal>2350</span>
<span class=normal>2351</span>
<span class=normal>2352</span>
<span class=normal>2353</span>
<span class=normal>2354</span>
<span class=normal>2355</span>
<span class=normal>2356</span>
<span class=normal>2357</span>
<span class=normal>2358</span>
<span class=normal>2359</span>
<span class=normal>2360</span>
<span class=normal>2361</span>
<span class=normal>2362</span>
<span class=normal>2363</span>
<span class=normal>2364</span>
<span class=normal>2365</span>
<span class=normal>2366</span>
<span class=normal>2367</span>
<span class=normal>2368</span>
<span class=normal>2369</span>
<span class=normal>2370</span>
<span class=normal>2371</span>
<span class=normal>2372</span>
<span class=normal>2373</span>
<span class=normal>2374</span>
<span class=normal>2375</span>
<span class=normal>2376</span>
<span class=normal>2377</span>
<span class=normal>2378</span>
<span class=normal>2379</span>
<span class=normal>2380</span>
<span class=normal>2381</span>
<span class=normal>2382</span>
<span class=normal>2383</span>
<span class=normal>2384</span>
<span class=normal>2385</span>
<span class=normal>2386</span>
<span class=normal>2387</span>
<span class=normal>2388</span>
<span class=normal>2389</span>
<span class=normal>2390</span>
<span class=normal>2391</span>
<span class=normal>2392</span>
<span class=normal>2393</span>
<span class=normal>2394</span>
<span class=normal>2395</span>
<span class=normal>2396</span>
<span class=normal>2397</span>
<span class=normal>2398</span>
<span class=normal>2399</span>
<span class=normal>2400</span>
<span class=normal>2401</span>
<span class=normal>2402</span>
<span class=normal>2403</span>
<span class=normal>2404</span>
<span class=normal>2405</span>
<span class=normal>2406</span>
<span class=normal>2407</span>
<span class=normal>2408</span>
<span class=normal>2409</span>
<span class=normal>2410</span>
<span class=normal>2411</span>
<span class=normal>2412</span>
<span class=normal>2413</span>
<span class=normal>2414</span>
<span class=normal>2415</span>
<span class=normal>2416</span>
<span class=normal>2417</span>
<span class=normal>2418</span>
<span class=normal>2419</span>
<span class=normal>2420</span>
<span class=normal>2421</span>
<span class=normal>2422</span>
<span class=normal>2423</span>
<span class=normal>2424</span>
<span class=normal>2425</span>
<span class=normal>2426</span>
<span class=normal>2427</span>
<span class=normal>2428</span>
<span class=normal>2429</span>
<span class=normal>2430</span>
<span class=normal>2431</span>
<span class=normal>2432</span>
<span class=normal>2433</span>
<span class=normal>2434</span>
<span class=normal>2435</span>
<span class=normal>2436</span>
<span class=normal>2437</span>
<span class=normal>2438</span>
<span class=normal>2439</span>
<span class=normal>2440</span>
<span class=normal>2441</span>
<span class=normal>2442</span>
<span class=normal>2443</span>
<span class=normal>2444</span>
<span class=normal>2445</span>
<span class=normal>2446</span>
<span class=normal>2447</span>
<span class=normal>2448</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>run_eta_v_analysis</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>eta_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>v_sigma</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
    <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>plot_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>,</span>
    <span class=n>diagnostic</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span>
    <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span>
          <span class=nb>float</span><span class=p>,</span>
          <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
          <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>,</span>
          <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>],</span>
    <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span>
          <span class=nb>float</span><span class=p>,</span>
          <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
          <span class=n>gridplot</span><span class=p>,</span>
          <span class=n>matplotlib</span><span class=o>.</span><span class=n>figure</span><span class=o>.</span><span class=n>Figure</span><span class=p>]</span>
<span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run the eta, v analysis on the pipeline run, with optional</span>
<span class=sd>    inputs to use a query or filtered dataframe (see Rowlinson</span>
<span class=sd>    et al., 2018,</span>
<span class=sd>    https://ui.adsabs.harvard.edu/abs/2019A%26C....27..111R/abstract).</span>

<span class=sd>    Args:</span>
<span class=sd>        eta_sigma: The minimum sigma value of the eta distribution</span>
<span class=sd>            to be used as a threshold.</span>
<span class=sd>        v_sigma: The minimum sigma value of the v distribution</span>
<span class=sd>            to be used as a threshold.</span>
<span class=sd>        query: String query to apply to the dataframe before</span>
<span class=sd>            the analysis is run, defaults to None.</span>
<span class=sd>        df: Dataframe of sources from the pipeline run, defaults</span>
<span class=sd>            to None. If None then the sources from the PipeAnalysis object</span>
<span class=sd>            are used.</span>
<span class=sd>        use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>            peak fluxes, defaults to &#39;False&#39;.</span>
<span class=sd>        plot_type: Select which format the candidates plot should be</span>
<span class=sd>            returned in. Either &#39;bokeh&#39; or &#39;matplotlib&#39;, defaults</span>
<span class=sd>            to &#39;bokeh&#39;.</span>
<span class=sd>        diagnostic: When &#39;True&#39; the diagnostic plot is also returned,</span>
<span class=sd>            defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Tuple containing the eta cutoff value, the v cutoff value,</span>
<span class=sd>            dataframe of candidates, candidates plot and, if selected, the</span>
<span class=sd>            diagnostic plot.</span>

<span class=sd>    Raise:</span>
<span class=sd>        Exception: Entered `plot_type` is not a valid plot type.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>plot_types</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;bokeh&#39;</span><span class=p>,</span> <span class=s1>&#39;matplotlib&#39;</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>plot_types</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;Not a valid plot type!&quot;</span>
            <span class=s2>&quot; Must be &#39;bokeh&#39; or &#39;matplotlib&#39;.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

    <span class=p>(</span>
        <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
        <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span>
    <span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fit_eta_v</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span><span class=p>)</span>

    <span class=n>v_cutoff</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=p>(</span><span class=n>v_fit_mean</span> <span class=o>+</span> <span class=n>v_sigma</span> <span class=o>*</span> <span class=n>v_fit_sigma</span><span class=p>)</span>
    <span class=n>eta_cutoff</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=p>(</span><span class=n>eta_fit_mean</span> <span class=o>+</span> <span class=n>eta_sigma</span> <span class=o>*</span> <span class=n>eta_fit_sigma</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>plot_type</span> <span class=o>==</span> <span class=s1>&#39;bokeh&#39;</span><span class=p>:</span>
        <span class=n>plot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_eta_v_bokeh</span><span class=p>(</span>
            <span class=n>df</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
            <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>plot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_plot_eta_v_matplotlib</span><span class=p>(</span>
            <span class=n>df</span><span class=p>,</span> <span class=n>eta_fit_mean</span><span class=p>,</span> <span class=n>eta_fit_sigma</span><span class=p>,</span>
            <span class=n>v_fit_mean</span><span class=p>,</span> <span class=n>v_fit_sigma</span><span class=p>,</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>use_int_flux</span><span class=p>:</span>
        <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;int&#39;</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;peak&#39;</span>

    <span class=n>candidates</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
        <span class=s2>&quot;v_</span><span class=si>{0}</span><span class=s2> &gt; </span><span class=si>{1}</span><span class=s2> &quot;</span>
        <span class=s2>&quot;&amp; eta_</span><span class=si>{0}</span><span class=s2> &gt; </span><span class=si>{2}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>label</span><span class=p>,</span>
            <span class=n>v_cutoff</span><span class=p>,</span>
            <span class=n>eta_cutoff</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>diagnostic</span><span class=p>:</span>
        <span class=n>diag</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>eta_v_diagnostic_plot</span><span class=p>(</span>
            <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>df</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=n>use_int_flux</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>plot</span><span class=p>,</span> <span class=n>diag</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>eta_cutoff</span><span class=p>,</span> <span class=n>v_cutoff</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>plot</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_two_epoch_analysis</span><span class=p>(</span><span class=n>vs</span><span class=p>,</span> <span class=n>m</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>df</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeAnalysis.run_two_epoch_analysis class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Run the two epoch analysis on the pipeline run, with optional inputs to use a query or filtered dataframe.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>vs</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The minimum Vs metric value to be considered a candidate.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>m</code></td> <td> <code>float</code> </td> <td> <div class=doc-md-description> <p>The minimum m metric absolute value to be considered a candidate.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>query</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>String query to apply to the dataframe before the analysis is run, defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>df</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Dataframe of sources from the pipeline run, defaults to None. If None then the sources from the PipeAnalysis object are used.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>use_int_flux</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Use integrated fluxes for the analysis instead of peak fluxes, defaults to 'False'.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.Tuple">Tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Tuple containing two dataframes of the candidate sources and pairs.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p>The two epoch metrics must be loaded before using this function.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.MeasPairsDoNotExistError" href="#vasttools.pipeline.MeasPairsDoNotExistError">MeasPairsDoNotExistError</a></code> </td> <td> <div class=doc-md-description> <p>The measurement pairs file(s) do not exist for this run</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>run_two_epoch_analysis</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>vs</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>m</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>df</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>use_int_flux</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run the two epoch analysis on the pipeline run, with optional</span>
<span class=sd>    inputs to use a query or filtered dataframe.</span>

<span class=sd>    Args:</span>
<span class=sd>        vs: The minimum Vs metric value to be considered a candidate.</span>
<span class=sd>        m: The minimum m metric absolute value to be considered a</span>
<span class=sd>            candidate.</span>
<span class=sd>        query: String query to apply to the dataframe before the analysis</span>
<span class=sd>            is run, defaults to None.</span>
<span class=sd>        df: Dataframe of sources from the pipeline run, defaults to None.</span>
<span class=sd>            If None then the sources from the PipeAnalysis object are used.</span>
<span class=sd>        use_int_flux: Use integrated fluxes for the analysis instead of</span>
<span class=sd>            peak fluxes, defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Tuple containing two dataframes of the candidate sources and pairs.</span>

<span class=sd>    Raises:</span>
<span class=sd>        Exception: The two epoch metrics must be loaded before using this</span>
<span class=sd>            function.</span>
<span class=sd>        MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>            exist for this run</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span>
            <span class=s2>&quot;The two epoch metrics must first be loaded to use the&quot;</span>
            <span class=s2>&quot; plotting function. Please do so with the command:</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;&#39;mypiperun.load_two_epoch_metrics()&#39;</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=s2>&quot;and try again.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>df</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>

    <span class=k>if</span> <span class=n>query</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

    <span class=n>allowed_sources</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span>
                <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span>
            <span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>allowed_sources</span><span class=p>)</span>
            <span class=p>]</span>

    <span class=n>vs_label</span> <span class=o>=</span> <span class=s1>&#39;vs_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;vs_peak&#39;</span>
    <span class=n>m_abs_label</span> <span class=o>=</span> <span class=s1>&#39;m_int&#39;</span> <span class=k>if</span> <span class=n>use_int_flux</span> <span class=k>else</span> <span class=s1>&#39;m_peak&#39;</span>

    <span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>
    <span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span><span class=o>.</span><span class=n>abs</span><span class=p>()</span>

    <span class=c1># If vaex convert these to pandas</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span>
            <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>vs</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>m</span><span class=p>)</span>
        <span class=p>]</span>

        <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>candidate_pairs</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>candidate_pairs</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>vs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>vs</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=n>m_abs_label</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>m</span><span class=p>)</span>
        <span class=p>]</span>

    <span class=n>unique_sources</span> <span class=o>=</span> <span class=n>candidate_pairs</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>unique</span><span class=p>()</span>

    <span class=n>candidate_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>unique_sources</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>candidate_sources</span><span class=p>,</span> <span class=n>candidate_pairs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.PipeRun class="doc doc-heading"> <code>PipeRun</code> <a href=#vasttools.pipeline.PipeRun class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>object</code></p> <p>Class that represents a Pipeline run.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.associations">associations</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Associations dataframe from the pipeline run loaded from 'associations.parquet'.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.bands">bands</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>The bands dataframe from the pipeline run loaded from 'bands.parquet'.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.images">images</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the images of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.measurements">measurements</span></code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the measurements of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.measurement_pairs_file">measurement_pairs_file</span></code></td> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td> <div class=doc-md-description> <p>List containing the locations of the measurement_pairs.parquet (or.arrow) file(s).</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.name">name</span></code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The pipeline run name.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.n_workers">n_workers</span></code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>Number of workers (cpus) available.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.relations">relations</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the relations of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.skyregions">skyregions</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the skyregions of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.sources">sources</span></code></td> <td> <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Dataframe containing all the information on the sources of the pipeline run.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title="vasttools.pipeline.PipeRun.sources_skycoord">sources_skycoord</span></code></td> <td> <code><span title="astroy.coordinates.SkyCoord">SkyCoord</span></code> </td> <td> <div class=doc-md-description> <p>A SkyCoord object of the default sources attribute.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>PipeRun</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Class that represents a Pipeline run.</span>

<span class=sd>    Attributes:</span>
<span class=sd>        associations (pandas.core.frame.DataFrame): Associations dataframe</span>
<span class=sd>            from the pipeline run loaded from &#39;associations.parquet&#39;.</span>
<span class=sd>        bands (pandas.core.frame.DataFrame): The bands dataframe from the</span>
<span class=sd>            pipeline run loaded from &#39;bands.parquet&#39;.</span>
<span class=sd>        images (pandas.core.frame.DataFrame): Dataframe containing all the</span>
<span class=sd>            information on the images of the pipeline run.</span>
<span class=sd>        measurements (Union[pd.DataFrame, vaex.dataframe.DataFrame]):</span>
<span class=sd>            Dataframe containing all the information on the measurements of</span>
<span class=sd>            the pipeline run.</span>
<span class=sd>        measurement_pairs_file (List[str]): List containing the locations of</span>
<span class=sd>            the measurement_pairs.parquet (or.arrow) file(s).</span>
<span class=sd>        name (str): The pipeline run name.</span>
<span class=sd>        n_workers (int): Number of workers (cpus) available.</span>
<span class=sd>        relations (pandas.core.frame.DataFrame): Dataframe containing all the</span>
<span class=sd>            information on the relations of the pipeline run.</span>
<span class=sd>        skyregions (pandas.core.frame.DataFrame): Dataframe containing all the</span>
<span class=sd>            information on the skyregions of the pipeline run.</span>
<span class=sd>        sources (pandas.core.frame.DataFrame): Dataframe containing all the</span>
<span class=sd>            information on the sources of the pipeline run.</span>
<span class=sd>        sources_skycoord (astroy.coordinates.SkyCoord): A SkyCoord object of</span>
<span class=sd>            the default sources attribute.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>images</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>skyregions</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>relations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>sources</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>associations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>bands</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
        <span class=n>measurements</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
        <span class=n>measurement_pairs_file</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
        <span class=n>vaex_meas</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
        <span class=n>scheduler</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;processes&#39;</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Constructor method.</span>

<span class=sd>        Args:</span>
<span class=sd>            name: The name of the pipeline run.</span>
<span class=sd>            images: Images dataframe from the pipeline run loaded from</span>
<span class=sd>                &#39;images.parquet&#39;. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            skyregions: Skyregions dataframe from the pipeline run loaded from</span>
<span class=sd>                skyregions.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            relations: Relations dataframe from the pipeline run loaded from</span>
<span class=sd>                relations.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            sources: Sources dataframe from the pipeline run loaded from</span>
<span class=sd>                sources.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>            associations: Associations dataframe from the pipeline run loaded</span>
<span class=sd>                from &#39;associations.parquet&#39;. A `pandas.core.frame.DataFrame`</span>
<span class=sd>                instance.</span>
<span class=sd>            bands: The bands dataframe from the pipeline run loaded from</span>
<span class=sd>                &#39;bands.parquet&#39;.</span>
<span class=sd>            measurements: Measurements dataframe from the pipeline run</span>
<span class=sd>                loaded from measurements.parquet and the forced measurements</span>
<span class=sd>                parquet files.  A `pandas.core.frame.DataFrame` or</span>
<span class=sd>                `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>            measurement_pairs_file: The location of the two epoch pairs file</span>
<span class=sd>                from the pipeline. It is a list of locations due to the fact</span>
<span class=sd>                that two pipeline runs could be combined.</span>
<span class=sd>            vaex_meas: &#39;True&#39; if the measurements have been loaded using</span>
<span class=sd>                vaex from an arrow file. `False` means the measurements are</span>
<span class=sd>                loaded into a pandas DataFrame.</span>
<span class=sd>            n_workers: Number of workers (cpus) available. Default is</span>
<span class=sd>                determined by running `cpu_count()`.</span>
<span class=sd>            scheduler: Dask scheduling option to use. Options are &quot;processes&quot;</span>
<span class=sd>                (parallel processing) or &quot;single-threaded&quot;. Defaults to</span>
<span class=sd>                &quot;single-threaded&quot;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=nb>super</span><span class=p>(</span><span class=n>PipeRun</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>images</span> <span class=o>=</span> <span class=n>images</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span> <span class=o>=</span> <span class=n>skyregions</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=n>sources</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sources_skycoord</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>associations</span> <span class=o>=</span> <span class=n>associations</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>bands</span> <span class=o>=</span> <span class=n>bands</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=n>measurement_pairs_file</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>relations</span> <span class=o>=</span> <span class=n>relations</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span> <span class=o>=</span> <span class=n>n_workers</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=o>=</span> <span class=n>vaex_meas</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span> <span class=o>=</span> <span class=n>scheduler</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;vasttools.pipeline.PipeRun&#39;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Created PipeRun instance&#39;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_check_measurement_pairs_file</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>_check_measurement_pairs_file</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>measurement_pairs_exists</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=k>for</span> <span class=n>filepath</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Measurement pairs file (</span><span class=si>{</span><span class=n>filepath</span><span class=si>}</span><span class=s2>) does&quot;</span>
                                    <span class=sa>f</span><span class=s2>&quot; not exist. You will be unable to access&quot;</span>
                                    <span class=sa>f</span><span class=s2>&quot; measurement pairs or two-epoch metrics.&quot;</span>
                                    <span class=p>)</span>
                <span class=n>measurement_pairs_exists</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=k>return</span> <span class=n>measurement_pairs_exists</span>

    <span class=k>def</span> <span class=nf>combine_with_run</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=p>:</span> <span class=n>PipeRun</span><span class=p>,</span> <span class=n>new_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeRun</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Combines the output of another PipeRun object with the PipeRun</span>
<span class=sd>        from which this method is being called from.</span>

<span class=sd>        !!!warning</span>
<span class=sd>            It is assumed you are loading runs from the same Pipeline</span>
<span class=sd>            instance. If this is not the case then erroneous results may be</span>
<span class=sd>            returned.</span>

<span class=sd>        Args:</span>
<span class=sd>            other_PipeRun: The other pipeline run to merge.</span>
<span class=sd>            new_name: If not None then the PipeRun attribute &#39;name&#39;</span>
<span class=sd>                is changed to the given value.</span>

<span class=sd>        Returns:</span>
<span class=sd>            The self object with the other pipeline run added.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>images</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>images</span><span class=p>]</span>
        <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>skyregions</span><span class=p>],</span>
            <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
                <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span>
            <span class=p>)</span>

        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
                <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span><span class=p>)</span>
            <span class=p>)</span>

        <span class=k>elif</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>)</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
                <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
                <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span><span class=p>],</span>
                <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>([</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span><span class=p>])</span>

        <span class=n>sources_to_add</span> <span class=o>=</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=o>~</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>index</span>
            <span class=p>))</span>
        <span class=p>]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>,</span> <span class=n>sources_to_add</span><span class=p>])</span>

        <span class=c1># need to keep access to all the different pairs files</span>
        <span class=c1># for two epoch metrics.</span>
        <span class=n>orig_run_pairs_exist</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span>
        <span class=n>other_run_pairs_exist</span> <span class=o>=</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span>

        <span class=k>if</span> <span class=n>orig_run_pairs_exist</span> <span class=ow>and</span> <span class=n>other_run_pairs_exist</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>

        <span class=k>elif</span> <span class=n>orig_run_pairs_exist</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Not combining measurement pairs because they &quot;</span>
                                <span class=s2>&quot; do not exist for the new run.&quot;</span>
                                <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=k>elif</span> <span class=n>other_run_pairs_exist</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Not combining measurement pairs because they &quot;</span>
                                <span class=s2>&quot; do not exist for the original run.&quot;</span>
                                <span class=p>)</span>

        <span class=k>del</span> <span class=n>sources_to_add</span>

        <span class=k>if</span> <span class=n>new_name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>new_name</span>

        <span class=k>return</span> <span class=bp>self</span>

    <span class=k>def</span> <span class=nf>get_sources_skycoord</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>user_sources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>ra_col</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span>
        <span class=n>dec_col</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;wavg_dec&#39;</span><span class=p>,</span>
        <span class=n>ra_unit</span><span class=p>:</span> <span class=n>u</span><span class=o>.</span><span class=n>Unit</span> <span class=o>=</span> <span class=n>u</span><span class=o>.</span><span class=n>degree</span><span class=p>,</span>
        <span class=n>dec_unit</span><span class=p>:</span> <span class=n>u</span><span class=o>.</span><span class=n>Unit</span> <span class=o>=</span> <span class=n>u</span><span class=o>.</span><span class=n>degree</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>astropy</span><span class=o>.</span><span class=n>coordinates</span><span class=o>.</span><span class=n>sky_coordinate</span><span class=o>.</span><span class=n>SkyCoord</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        A convenience function to generate a SkyCoord object from the</span>
<span class=sd>        sources dataframe. Also has support for custom source lists.</span>

<span class=sd>        Args:</span>
<span class=sd>            user_sources: Provide a user generated source dataframe</span>
<span class=sd>                in place of using the default run sources dataframe.</span>
<span class=sd>            ra_col: The column to use for the Right Ascension.</span>
<span class=sd>            dec_col: The column to use for the Declination.</span>
<span class=sd>            ra_unit: The unit of the RA column, defaults to degrees.</span>
<span class=sd>                Must be an astropy.unit value.</span>
<span class=sd>            dec_unit: The unit of the Dec column, defaults to degrees.</span>
<span class=sd>                Must be an astropy.unit value.</span>

<span class=sd>        Returns:</span>
<span class=sd>            A SkyCoord containing the source coordinates.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>user_sources</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>the_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>the_sources</span> <span class=o>=</span> <span class=n>user_sources</span>

        <span class=n>sources_skycoord</span> <span class=o>=</span> <span class=n>gen_skycoord_from_df</span><span class=p>(</span>
            <span class=n>the_sources</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=n>ra_col</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=n>dec_col</span><span class=p>,</span> <span class=n>ra_unit</span><span class=o>=</span><span class=n>ra_unit</span><span class=p>,</span>
            <span class=n>dec_unit</span><span class=o>=</span><span class=n>dec_unit</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>sources_skycoord</span>

    <span class=k>def</span> <span class=nf>get_source</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>field</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>stokes</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;I&#39;</span><span class=p>,</span>
        <span class=n>outdir</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>,</span>
        <span class=n>user_measurements</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span>
            <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span>
        <span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>user_sources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Source</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Fetches an individual source and returns a</span>
<span class=sd>        vasttools.source.Source object.</span>

<span class=sd>        Users do not need</span>
<span class=sd>        to change the field, stokes and outdir parameters.</span>

<span class=sd>        Args:</span>
<span class=sd>            id: The id of the source to load.</span>
<span class=sd>            field: The field of the source being loaded, defaults</span>
<span class=sd>                to None. If None then the run name is used as the field.</span>
<span class=sd>            stokes: Stokes parameter of the source, defaults to &#39;I&#39;.</span>
<span class=sd>            outdir: The output directory where generated plots will</span>
<span class=sd>                be saved, defauls to &#39;.&#39; (the current working directory).</span>
<span class=sd>            user_measurements: A user generated measurements dataframe to</span>
<span class=sd>                use instead of the default pipeline result. The type must match</span>
<span class=sd>                the default type of the pipeline (vaex or pandas). Defaults to</span>
<span class=sd>                None, in which case the default pipeline measurements are used.</span>
<span class=sd>            user_sources: A user generated sources dataframe to use</span>
<span class=sd>                instead of the default pipeline result. Format is always a</span>
<span class=sd>                pandas dataframe. Defaults to None, in which case the default</span>
<span class=sd>                pipeline measurements are used.</span>

<span class=sd>        Returns:</span>
<span class=sd>            A vast-tools `Source` object corresponding to the requested source.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=n>user_measurements</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>the_measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>the_measurements</span> <span class=o>=</span> <span class=n>user_measurements</span>

        <span class=k>if</span> <span class=n>user_sources</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>the_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>the_sources</span> <span class=o>=</span> <span class=n>user_sources</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=n>measurements</span> <span class=o>=</span> <span class=n>the_measurements</span><span class=p>[</span>
                <span class=n>the_measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>id</span>
            <span class=p>]</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurements</span> <span class=o>=</span> <span class=n>the_measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=n>the_measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>id</span>
            <span class=p>]</span>

        <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span>
                <span class=s1>&#39;path&#39;</span><span class=p>,</span>
                <span class=s1>&#39;noise_path&#39;</span><span class=p>,</span>
                <span class=s1>&#39;measurements_path&#39;</span><span class=p>,</span>
                <span class=s1>&#39;frequency&#39;</span>
            <span class=p>]],</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id&#39;</span><span class=p>,</span>
            <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;path&#39;</span><span class=p>:</span> <span class=s1>&#39;image&#39;</span><span class=p>,</span>
                <span class=s1>&#39;noise_path&#39;</span><span class=p>:</span> <span class=s1>&#39;rms&#39;</span><span class=p>,</span>
                <span class=s1>&#39;measurements_path&#39;</span><span class=p>:</span> <span class=s1>&#39;selavy&#39;</span>
            <span class=p>}</span>
        <span class=p>)</span>

        <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;time&#39;</span><span class=p>:</span> <span class=s1>&#39;dateobs&#39;</span><span class=p>,</span>
            <span class=p>}</span>
        <span class=p>)</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span>
            <span class=n>by</span><span class=o>=</span><span class=s1>&#39;dateobs&#39;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=n>s</span> <span class=o>=</span> <span class=n>the_sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span>

        <span class=n>num_measurements</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=s1>&#39;n_measurements&#39;</span><span class=p>]</span>

        <span class=n>source_coord</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
            <span class=n>s</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>],</span>
            <span class=n>s</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>],</span>
            <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>source_name</span> <span class=o>=</span> <span class=s2>&quot;VAST </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>source_coord</span><span class=o>.</span><span class=n>to_string</span><span class=p>(</span>
                <span class=s2>&quot;hmsdms&quot;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>precision</span><span class=o>=</span><span class=mi>1</span>
            <span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
                <span class=s2>&quot; &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
            <span class=p>)[:</span><span class=mi>15</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=n>source_epochs</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_measurements</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
        <span class=k>if</span> <span class=n>field</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>field</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>
        <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;field&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span>
        <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;epoch&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>source_epochs</span>
        <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;stokes&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>stokes</span>
        <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;skycoord&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>source_coord</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_measurements</span><span class=p>)</span>
        <span class=p>]</span>
        <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;detection&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;forced&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>False</span>
        <span class=n>source_fields</span> <span class=o>=</span> <span class=p>[</span><span class=n>field</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_measurements</span><span class=p>)]</span>
        <span class=n>source_stokes</span> <span class=o>=</span> <span class=n>stokes</span>
        <span class=n>source_base_folder</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>source_crossmatch_radius</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>source_outdir</span> <span class=o>=</span> <span class=n>outdir</span>
        <span class=n>source_image_type</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=n>thesource</span> <span class=o>=</span> <span class=n>Source</span><span class=p>(</span>
            <span class=n>source_coord</span><span class=p>,</span>
            <span class=n>source_name</span><span class=p>,</span>
            <span class=n>source_epochs</span><span class=p>,</span>
            <span class=n>source_fields</span><span class=p>,</span>
            <span class=n>source_stokes</span><span class=p>,</span>
            <span class=kc>None</span><span class=p>,</span>
            <span class=n>source_crossmatch_radius</span><span class=p>,</span>
            <span class=n>measurements</span><span class=p>,</span>
            <span class=n>source_base_folder</span><span class=p>,</span>
            <span class=n>source_image_type</span><span class=p>,</span>
            <span class=n>islands</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
            <span class=n>outdir</span><span class=o>=</span><span class=n>source_outdir</span><span class=p>,</span>
            <span class=n>pipeline</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>thesource</span>

    <span class=k>def</span> <span class=nf>_raise_if_no_pairs</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>MeasPairsDoNotExistError</span><span class=p>(</span><span class=s2>&quot;This method cannot be used as &quot;</span>
                                           <span class=s2>&quot;the measurement pairs are not &quot;</span>
                                           <span class=s2>&quot;available for this pipeline run.&quot;</span>
                                           <span class=p>)</span>

    <span class=k>def</span> <span class=nf>load_two_epoch_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Loads the two epoch metrics dataframe, usually stored as either</span>
<span class=sd>        &#39;measurement_pairs.parquet&#39; or &#39;measurement_pairs.arrow&#39;.</span>

<span class=sd>        The two epoch metrics dataframe is stored as an attribute to the</span>
<span class=sd>        PipeRun object as self.measurement_pairs_df. An epoch &#39;key&#39; is also</span>
<span class=sd>        added to the dataframe.</span>

<span class=sd>        Also creates a &#39;pairs_df&#39; that lists all the possible epoch pairs.</span>
<span class=sd>        This is stored as the attribute self.pairs_df.</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>

<span class=sd>        Raises:</span>
<span class=sd>            MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>                exist for this run</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

        <span class=n>image_ids</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
            <span class=p>{</span><span class=s1>&#39;pair&#39;</span><span class=p>:</span> <span class=n>combinations</span><span class=p>(</span><span class=n>image_ids</span><span class=p>,</span> <span class=mi>2</span><span class=p>)}</span>
        <span class=p>)</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;pair&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())</span>
            <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;image_id_a&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s1>&#39;image_id_b&#39;</span><span class=p>})</span>
            <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>]],</span>
                <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id_a&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>]],</span>
                <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id_b&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;index&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>,</span>
                <span class=s1>&#39;name_a&#39;</span><span class=p>:</span> <span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span>
                <span class=s1>&#39;name_b&#39;</span><span class=p>:</span> <span class=s1>&#39;image_name_b&#39;</span>
            <span class=p>}</span>
        <span class=p>)</span>

        <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;td&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;datetime_b&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;datetime_a&#39;</span><span class=p>]</span>

        <span class=n>pairs_df</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;datetime_a&#39;</span><span class=p>,</span> <span class=s1>&#39;datetime_b&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

        <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>pairs_df</span><span class=p>[[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_b&#39;</span><span class=p>]]</span>
            <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>arrow_files</span> <span class=o>=</span> <span class=p>(</span>
                <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.arrow&quot;</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>arrow_files</span><span class=p>):</span>
                <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>open_many</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=n>arrow_files</span><span class=p>]</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=o>~</span><span class=n>arrow_files</span><span class=p>]:</span>
                    <span class=n>temp</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                    <span class=n>temp</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
                    <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurement pairs have been loaded with vaex.&quot;</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>
                <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;.arrow&#39;</span><span class=p>):</span>
                <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>vaex</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
                <span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurement pairs have been loaded with vaex.&quot;</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
                <span class=p>)</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;_&quot;</span>
                <span class=o>+</span> <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span>
            <span class=p>)</span>

            <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
                <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>pair_epoch_key</span><span class=p>,</span> <span class=n>agg</span><span class=o>=</span><span class=s1>&#39;count&#39;</span>
            <span class=p>)</span>

            <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>pair_counts</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
                <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=s1>&#39;total_pairs&#39;</span><span class=p>}</span>
            <span class=p>)</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>measurement_pairs_df</span><span class=p>[[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_b&#39;</span><span class=p>]]</span>
                <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                    <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                    <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
                <span class=p>)</span>
            <span class=p>)</span>

            <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=p>[</span>
                <span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span>
            <span class=p>]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
                <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>:</span> <span class=s1>&#39;total_pairs&#39;</span><span class=p>}</span>
            <span class=p>)</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>pair_counts</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>

        <span class=k>del</span> <span class=n>pair_counts</span>

        <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>subset</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;total_pairs&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;td&#39;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span> <span class=nf>_add_times</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span> <span class=n>every_hour</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Adds the times required for planet searching.</span>

<span class=sd>        By default it adds the beginning and end of the observation.</span>
<span class=sd>        The every_hour option adds the time every hour during the observation,</span>
<span class=sd>        which is required for the Sun and Moon.</span>

<span class=sd>        Args:</span>
<span class=sd>            row: The series row containing the information.</span>
<span class=sd>            every_hour: Add times to the dataframe every hour during the</span>
<span class=sd>                observation, defaults to &#39;False&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            List of times to be searched for planets, in the format of rows.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;duration&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mf>0.</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>every_hour</span><span class=p>:</span>
            <span class=n>hours</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;duration&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=mf>3600.</span><span class=p>)</span>
            <span class=n>times</span> <span class=o>=</span> <span class=p>[</span>
                <span class=n>row</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span>
                    <span class=n>seconds</span><span class=o>=</span><span class=mf>3600.</span> <span class=o>*</span> <span class=n>h</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>h</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>hours</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
            <span class=p>]</span>
            <span class=k>return</span> <span class=n>times</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>[</span>
                <span class=n>row</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>],</span>
                <span class=n>row</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span>
                    <span class=n>seconds</span><span class=o>=</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;duration&#39;</span><span class=p>]</span>
                <span class=p>)</span>
            <span class=p>]</span>

    <span class=k>def</span> <span class=nf>check_for_planets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Checks the pipeline run for any planets in the field.</span>

<span class=sd>        All planets are checked: Mercury, Venus, Mars, Jupiter,</span>
<span class=sd>        Saturn, Uranus, Neptune, Pluto in addition to the Sun and Moon.</span>

<span class=sd>        Returns:</span>
<span class=sd>            DataFrame with list of planet positions. It will be empty if no</span>
<span class=sd>                planets are found. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=kn>from</span> <span class=nn>vasttools</span> <span class=kn>import</span> <span class=n>ALLOWED_PLANETS</span>
        <span class=n>ap</span> <span class=o>=</span> <span class=n>ALLOWED_PLANETS</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=n>planets_df</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span>
                <span class=s1>&#39;datetime&#39;</span><span class=p>,</span>
                <span class=s1>&#39;duration&#39;</span><span class=p>,</span>
                <span class=s1>&#39;centre_ra&#39;</span><span class=p>,</span>
                <span class=s1>&#39;centre_dec&#39;</span><span class=p>,</span>
            <span class=p>]]</span>
            <span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
            <span class=o>.</span><span class=n>rename</span><span class=p>(</span>
                <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
                    <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=s1>&#39;image_id&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;datetime&#39;</span><span class=p>:</span> <span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;centre_ra&#39;</span><span class=p>:</span> <span class=s1>&#39;centre-ra&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;centre_dec&#39;</span><span class=p>:</span> <span class=s1>&#39;centre-dec&#39;</span>
                <span class=p>}</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=c1># Split off a sun and moon df so we can check more times</span>
        <span class=n>sun_moon_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=n>ap</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;sun&#39;</span><span class=p>)</span>
        <span class=n>ap</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;moon&#39;</span><span class=p>)</span>

        <span class=c1># check planets at start and end of observation</span>
        <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>planets_df</span><span class=p>[[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span> <span class=s1>&#39;duration&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_add_times</span><span class=p>,</span>
            <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>
        <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>ap</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>planets_df</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])]</span>

        <span class=c1># check sun and moon every hour</span>
        <span class=n>sun_moon_df</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sun_moon_df</span><span class=p>[[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span> <span class=s1>&#39;duration&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_add_times</span><span class=p>,</span>
            <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=kc>True</span><span class=p>,),</span>
            <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>

        <span class=n>sun_moon_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
            <span class=p>[</span><span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;moon&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>sun_moon_df</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
        <span class=p>]</span>

        <span class=n>planets_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>planets_df</span><span class=p>,</span> <span class=n>sun_moon_df</span><span class=p>],</span> <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>del</span> <span class=n>sun_moon_df</span>

        <span class=n>planets_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;planet&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=s1>&#39;duration&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>
        <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>capitalize</span><span class=p>()</span>

        <span class=c1># reset index as there might be doubles but keep the id column as this</span>
        <span class=c1># signifies the image id.</span>
        <span class=n>planets_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=n>meta</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
            <span class=s1>&#39;DATEOBS&#39;</span><span class=p>:</span> <span class=s1>&#39;datetime64[ns]&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre-ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre-dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;planet&#39;</span><span class=p>:</span> <span class=s1>&#39;U&#39;</span><span class=p>,</span>
            <span class=s1>&#39;ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
            <span class=s1>&#39;sep&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span>
        <span class=p>}</span>

        <span class=n>result</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>planets_df</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>)</span>
            <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;planet&#39;</span><span class=p>)</span>
            <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                <span class=n>match_planet_to_field</span><span class=p>,</span>
                <span class=n>meta</span><span class=o>=</span><span class=n>meta</span>
            <span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>(</span>
                <span class=n>scheduler</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=p>,</span>
                <span class=n>n_workers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;No planets found.&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span> <span class=nf>filter_by_moc</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>moc</span><span class=p>:</span> <span class=n>mocpy</span><span class=o>.</span><span class=n>MOC</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Filters the PipeRun object to only contain the sources that are</span>
<span class=sd>        located within the provided moc area.</span>

<span class=sd>        Args:</span>
<span class=sd>            moc: MOC instance for which to filter the run by.</span>

<span class=sd>        Returns:</span>
<span class=sd>            A new `PipeRun` object containing the sources within the MOC.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>source_mask</span> <span class=o>=</span> <span class=n>moc</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span><span class=o>.</span><span class=n>dec</span><span class=p>)</span>

        <span class=n>new_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>source_mask</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
            <span class=n>new_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span>
            <span class=n>new_meas</span> <span class=o>=</span> <span class=n>new_meas</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>new_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
                    <span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
                <span class=p>)]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=n>new_images</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_meas</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=n>new_skyregions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_images</span><span class=p>[</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=n>new_associations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>associations</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>associations</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
                <span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
            <span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=p>]</span>

        <span class=n>new_bands</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bands</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>bands</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_images</span><span class=p>[</span><span class=s1>&#39;band_id&#39;</span><span class=p>])</span>
        <span class=p>]</span>

        <span class=n>new_relations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=p>[</span><span class=s1>&#39;from_source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
                <span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
            <span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=p>]</span>

        <span class=n>new_PipeRun</span> <span class=o>=</span> <span class=n>PipeAnalysis</span><span class=p>(</span>
            <span class=n>name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
            <span class=n>images</span><span class=o>=</span><span class=n>new_images</span><span class=p>,</span>
            <span class=n>skyregions</span><span class=o>=</span><span class=n>new_skyregions</span><span class=p>,</span>
            <span class=n>relations</span><span class=o>=</span><span class=n>new_relations</span><span class=p>,</span>
            <span class=n>sources</span><span class=o>=</span><span class=n>new_sources</span><span class=p>,</span>
            <span class=n>associations</span><span class=o>=</span><span class=n>new_associations</span><span class=p>,</span>
            <span class=n>bands</span><span class=o>=</span><span class=n>new_bands</span><span class=p>,</span>
            <span class=n>measurements</span><span class=o>=</span><span class=n>new_meas</span><span class=p>,</span>
            <span class=n>measurement_pairs_file</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>,</span>
            <span class=n>vaex_meas</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>new_PipeRun</span>

    <span class=k>def</span> <span class=nf>create_moc</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>max_depth</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>9</span><span class=p>,</span> <span class=n>ignore_large_run_warning</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>mocpy</span><span class=o>.</span><span class=n>MOC</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Create a MOC file that represents the area covered by</span>
<span class=sd>        the pipeline run.</span>

<span class=sd>        !!!warning</span>
<span class=sd>            This will take a very long time for large runs.</span>

<span class=sd>        Args:</span>
<span class=sd>            max_depth: Max depth parameter passed to the</span>
<span class=sd>                MOC.from_polygon_skycoord() function, defaults to 9.</span>
<span class=sd>            ignore_large_run_warning: Ignores the warning of creating a MOC on</span>
<span class=sd>                a large run.</span>

<span class=sd>        Returns:</span>
<span class=sd>            MOC object containing the area covered by the pipeline run.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>images_to_use</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span>
            <span class=s1>&#39;skyreg_id&#39;</span>
        <span class=p>)[</span><span class=s1>&#39;path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>ignore_large_run_warning</span> <span class=ow>and</span> <span class=n>images_to_use</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span>
                <span class=s2>&quot;Creating a MOC for a large run will take a long time!&quot;</span>
                <span class=s2>&quot; Run again with &#39;ignore_large_run_warning=True` if you&quot;</span>
                <span class=s2>&quot; are sure you want to run this. A smaller `max_depth` is&quot;</span>
                <span class=s2>&quot; highly recommended.&quot;</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=n>moc</span> <span class=o>=</span> <span class=n>create_moc_from_fits</span><span class=p>(</span>
            <span class=n>images_to_use</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
            <span class=n>max_depth</span><span class=o>=</span><span class=n>max_depth</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>images_to_use</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>img</span> <span class=ow>in</span> <span class=n>images_to_use</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
                <span class=n>img_moc</span> <span class=o>=</span> <span class=n>create_moc_from_fits</span><span class=p>(</span>
                    <span class=n>img</span><span class=p>,</span>
                    <span class=n>max_depth</span>
                <span class=p>)</span>
                <span class=n>moc</span> <span class=o>=</span> <span class=n>moc</span><span class=o>.</span><span class=n>union</span><span class=p>(</span><span class=n>img_moc</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>moc</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>relations</span><span class=p>,</span> <span class=n>sources</span><span class=p>,</span> <span class=n>associations</span><span class=p>,</span> <span class=n>bands</span><span class=p>,</span> <span class=n>measurements</span><span class=p>,</span> <span class=n>measurement_pairs_file</span><span class=p>,</span> <span class=n>vaex_meas</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=s1>&#39;processes&#39;</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.__init__ class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Constructor method.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>name</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The name of the pipeline run.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>images</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Images dataframe from the pipeline run loaded from 'images.parquet'. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>skyregions</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Skyregions dataframe from the pipeline run loaded from skyregions.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>relations</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Relations dataframe from the pipeline run loaded from relations.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>sources</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Sources dataframe from the pipeline run loaded from sources.parquet. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>associations</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Associations dataframe from the pipeline run loaded from 'associations.parquet'. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>bands</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>The bands dataframe from the pipeline run loaded from 'bands.parquet'.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>measurements</code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Measurements dataframe from the pipeline run loaded from measurements.parquet and the forced measurements parquet files. A <code>pandas.core.frame.DataFrame</code> or <code>vaex.dataframe.DataFrame</code> instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>measurement_pairs_file</code></td> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td> <div class=doc-md-description> <p>The location of the two epoch pairs file from the pipeline. It is a list of locations due to the fact that two pipeline runs could be combined.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>vaex_meas</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>'True' if the measurements have been loaded using vaex from an arrow file. <code>False</code> means the measurements are loaded into a pandas DataFrame.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td><code>n_workers</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>Number of workers (cpus) available. Default is determined by running <code>cpu_count()</code>.</p> </div> </td> <td> <code><span title="vasttools.pipeline.HOST_NCPU">HOST_NCPU</span> - 1</code> </td> </tr> <tr class=doc-section-item> <td><code>scheduler</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Dask scheduling option to use. Options are "processes" (parallel processing) or "single-threaded". Defaults to "single-threaded".</p> </div> </td> <td> <code>&#39;processes&#39;</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>skyregions</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>relations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>sources</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>associations</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>bands</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>measurements</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>],</span>
    <span class=n>measurement_pairs_file</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
    <span class=n>vaex_meas</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
    <span class=n>scheduler</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;processes&#39;</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Constructor method.</span>

<span class=sd>    Args:</span>
<span class=sd>        name: The name of the pipeline run.</span>
<span class=sd>        images: Images dataframe from the pipeline run loaded from</span>
<span class=sd>            &#39;images.parquet&#39;. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        skyregions: Skyregions dataframe from the pipeline run loaded from</span>
<span class=sd>            skyregions.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        relations: Relations dataframe from the pipeline run loaded from</span>
<span class=sd>            relations.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        sources: Sources dataframe from the pipeline run loaded from</span>
<span class=sd>            sources.parquet. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>        associations: Associations dataframe from the pipeline run loaded</span>
<span class=sd>            from &#39;associations.parquet&#39;. A `pandas.core.frame.DataFrame`</span>
<span class=sd>            instance.</span>
<span class=sd>        bands: The bands dataframe from the pipeline run loaded from</span>
<span class=sd>            &#39;bands.parquet&#39;.</span>
<span class=sd>        measurements: Measurements dataframe from the pipeline run</span>
<span class=sd>            loaded from measurements.parquet and the forced measurements</span>
<span class=sd>            parquet files.  A `pandas.core.frame.DataFrame` or</span>
<span class=sd>            `vaex.dataframe.DataFrame` instance.</span>
<span class=sd>        measurement_pairs_file: The location of the two epoch pairs file</span>
<span class=sd>            from the pipeline. It is a list of locations due to the fact</span>
<span class=sd>            that two pipeline runs could be combined.</span>
<span class=sd>        vaex_meas: &#39;True&#39; if the measurements have been loaded using</span>
<span class=sd>            vaex from an arrow file. `False` means the measurements are</span>
<span class=sd>            loaded into a pandas DataFrame.</span>
<span class=sd>        n_workers: Number of workers (cpus) available. Default is</span>
<span class=sd>            determined by running `cpu_count()`.</span>
<span class=sd>        scheduler: Dask scheduling option to use. Options are &quot;processes&quot;</span>
<span class=sd>            (parallel processing) or &quot;single-threaded&quot;. Defaults to</span>
<span class=sd>            &quot;single-threaded&quot;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=nb>super</span><span class=p>(</span><span class=n>PipeRun</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>images</span> <span class=o>=</span> <span class=n>images</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span> <span class=o>=</span> <span class=n>skyregions</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=n>sources</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sources_skycoord</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>associations</span> <span class=o>=</span> <span class=n>associations</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>bands</span> <span class=o>=</span> <span class=n>bands</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=n>measurement_pairs_file</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>relations</span> <span class=o>=</span> <span class=n>relations</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span> <span class=o>=</span> <span class=n>n_workers</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=o>=</span> <span class=n>vaex_meas</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span> <span class=o>=</span> <span class=n>scheduler</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;vasttools.pipeline.PipeRun&#39;</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Created PipeRun instance&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_check_measurement_pairs_file</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.check_for_planets class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_for_planets</span><span class=p>()</span></code> <a href=#vasttools.pipeline.PipeRun.check_for_planets class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Checks the pipeline run for any planets in the field.</p> <p>All planets are checked: Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto in addition to the Sun and Moon.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>DataFrame with list of planet positions. It will be empty if no planets are found. A <code>pandas.core.frame.DataFrame</code> instance.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>check_for_planets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Checks the pipeline run for any planets in the field.</span>

<span class=sd>    All planets are checked: Mercury, Venus, Mars, Jupiter,</span>
<span class=sd>    Saturn, Uranus, Neptune, Pluto in addition to the Sun and Moon.</span>

<span class=sd>    Returns:</span>
<span class=sd>        DataFrame with list of planet positions. It will be empty if no</span>
<span class=sd>            planets are found. A `pandas.core.frame.DataFrame` instance.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span> <span class=nn>vasttools</span> <span class=kn>import</span> <span class=n>ALLOWED_PLANETS</span>
    <span class=n>ap</span> <span class=o>=</span> <span class=n>ALLOWED_PLANETS</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>planets_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span>
            <span class=s1>&#39;datetime&#39;</span><span class=p>,</span>
            <span class=s1>&#39;duration&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_ra&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_dec&#39;</span><span class=p>,</span>
        <span class=p>]]</span>
        <span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=s1>&#39;image_id&#39;</span><span class=p>,</span>
                <span class=s1>&#39;datetime&#39;</span><span class=p>:</span> <span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span>
                <span class=s1>&#39;centre_ra&#39;</span><span class=p>:</span> <span class=s1>&#39;centre-ra&#39;</span><span class=p>,</span>
                <span class=s1>&#39;centre_dec&#39;</span><span class=p>:</span> <span class=s1>&#39;centre-dec&#39;</span>
            <span class=p>}</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># Split off a sun and moon df so we can check more times</span>
    <span class=n>sun_moon_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=n>ap</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;sun&#39;</span><span class=p>)</span>
    <span class=n>ap</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;moon&#39;</span><span class=p>)</span>

    <span class=c1># check planets at start and end of observation</span>
    <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>planets_df</span><span class=p>[[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span> <span class=s1>&#39;duration&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_add_times</span><span class=p>,</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>
    <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>ap</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>planets_df</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])]</span>

    <span class=c1># check sun and moon every hour</span>
    <span class=n>sun_moon_df</span><span class=p>[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sun_moon_df</span><span class=p>[[</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>,</span> <span class=s1>&#39;duration&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_add_times</span><span class=p>,</span>
        <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=kc>True</span><span class=p>,),</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>sun_moon_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
        <span class=p>[</span><span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;moon&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>sun_moon_df</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
    <span class=p>]</span>

    <span class=n>planets_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>planets_df</span><span class=p>,</span> <span class=n>sun_moon_df</span><span class=p>],</span> <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>del</span> <span class=n>sun_moon_df</span>

    <span class=n>planets_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;planet&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s1>&#39;DATEOBS&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=s1>&#39;duration&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>
    <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>planets_df</span><span class=p>[</span><span class=s1>&#39;planet&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>capitalize</span><span class=p>()</span>

    <span class=c1># reset index as there might be doubles but keep the id column as this</span>
    <span class=c1># signifies the image id.</span>
    <span class=n>planets_df</span> <span class=o>=</span> <span class=n>planets_df</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=n>meta</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
        <span class=s1>&#39;DATEOBS&#39;</span><span class=p>:</span> <span class=s1>&#39;datetime64[ns]&#39;</span><span class=p>,</span>
        <span class=s1>&#39;centre-ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;centre-dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;planet&#39;</span><span class=p>:</span> <span class=s1>&#39;U&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;sep&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span>
    <span class=p>}</span>

    <span class=n>result</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>planets_df</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span><span class=p>)</span>
        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;planet&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=n>match_planet_to_field</span><span class=p>,</span>
            <span class=n>meta</span><span class=o>=</span><span class=n>meta</span>
        <span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>(</span>
            <span class=n>scheduler</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=p>,</span>
            <span class=n>n_workers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_workers</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;No planets found.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>result</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.combine_with_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>combine_with_run</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=p>,</span> <span class=n>new_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.combine_with_run class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Combines the output of another PipeRun object with the PipeRun from which this method is being called from.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>It is assumed you are loading runs from the same Pipeline instance. If this is not the case then erroneous results may be returned.</p> </div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>other_PipeRun</code></td> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.PipeRun" href="#vasttools.pipeline.PipeRun">PipeRun</a></code> </td> <td> <div class=doc-md-description> <p>The other pipeline run to merge.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>new_name</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>If not None then the PipeRun attribute 'name' is changed to the given value.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.PipeRun" href="#vasttools.pipeline.PipeRun">PipeRun</a></code> </td> <td> <div class=doc-md-description> <p>The self object with the other pipeline run added.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>combine_with_run</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=p>:</span> <span class=n>PipeRun</span><span class=p>,</span> <span class=n>new_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeRun</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Combines the output of another PipeRun object with the PipeRun</span>
<span class=sd>    from which this method is being called from.</span>

<span class=sd>    !!!warning</span>
<span class=sd>        It is assumed you are loading runs from the same Pipeline</span>
<span class=sd>        instance. If this is not the case then erroneous results may be</span>
<span class=sd>        returned.</span>

<span class=sd>    Args:</span>
<span class=sd>        other_PipeRun: The other pipeline run to merge.</span>
<span class=sd>        new_name: If not None then the PipeRun attribute &#39;name&#39;</span>
<span class=sd>            is changed to the given value.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The self object with the other pipeline run added.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>images</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
        <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>images</span><span class=p>]</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
        <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>skyregions</span><span class=p>],</span>
        <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span>
        <span class=p>)</span>

    <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=k>elif</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=ow>and</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>)</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
            <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>,</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurements</span><span class=p>],</span>
            <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>([</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span><span class=p>])</span>

    <span class=n>sources_to_add</span> <span class=o>=</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=o>~</span><span class=p>(</span><span class=n>other_PipeRun</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>index</span>
        <span class=p>))</span>
    <span class=p>]</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>,</span> <span class=n>sources_to_add</span><span class=p>])</span>

    <span class=c1># need to keep access to all the different pairs files</span>
    <span class=c1># for two epoch metrics.</span>
    <span class=n>orig_run_pairs_exist</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span>
    <span class=n>other_run_pairs_exist</span> <span class=o>=</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span>

    <span class=k>if</span> <span class=n>orig_run_pairs_exist</span> <span class=ow>and</span> <span class=n>other_run_pairs_exist</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>other_PipeRun</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>

    <span class=k>elif</span> <span class=n>orig_run_pairs_exist</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Not combining measurement pairs because they &quot;</span>
                            <span class=s2>&quot; do not exist for the new run.&quot;</span>
                            <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_measurement_pairs_exists</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=k>elif</span> <span class=n>other_run_pairs_exist</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Not combining measurement pairs because they &quot;</span>
                            <span class=s2>&quot; do not exist for the original run.&quot;</span>
                            <span class=p>)</span>

    <span class=k>del</span> <span class=n>sources_to_add</span>

    <span class=k>if</span> <span class=n>new_name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>new_name</span>

    <span class=k>return</span> <span class=bp>self</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.create_moc class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_moc</span><span class=p>(</span><span class=n>max_depth</span><span class=o>=</span><span class=mi>9</span><span class=p>,</span> <span class=n>ignore_large_run_warning</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.create_moc class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Create a MOC file that represents the area covered by the pipeline run.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>This will take a very long time for large runs.</p> </div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>max_depth</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>Max depth parameter passed to the MOC.from_polygon_skycoord() function, defaults to 9.</p> </div> </td> <td> <code>9</code> </td> </tr> <tr class=doc-section-item> <td><code>ignore_large_run_warning</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Ignores the warning of creating a MOC on a large run.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="mocpy.MOC">MOC</span></code> </td> <td> <div class=doc-md-description> <p>MOC object containing the area covered by the pipeline run.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>create_moc</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>max_depth</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>9</span><span class=p>,</span> <span class=n>ignore_large_run_warning</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>mocpy</span><span class=o>.</span><span class=n>MOC</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Create a MOC file that represents the area covered by</span>
<span class=sd>    the pipeline run.</span>

<span class=sd>    !!!warning</span>
<span class=sd>        This will take a very long time for large runs.</span>

<span class=sd>    Args:</span>
<span class=sd>        max_depth: Max depth parameter passed to the</span>
<span class=sd>            MOC.from_polygon_skycoord() function, defaults to 9.</span>
<span class=sd>        ignore_large_run_warning: Ignores the warning of creating a MOC on</span>
<span class=sd>            a large run.</span>

<span class=sd>    Returns:</span>
<span class=sd>        MOC object containing the area covered by the pipeline run.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>images_to_use</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span>
        <span class=s1>&#39;skyreg_id&#39;</span>
    <span class=p>)[</span><span class=s1>&#39;path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>ignore_large_run_warning</span> <span class=ow>and</span> <span class=n>images_to_use</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span>
            <span class=s2>&quot;Creating a MOC for a large run will take a long time!&quot;</span>
            <span class=s2>&quot; Run again with &#39;ignore_large_run_warning=True` if you&quot;</span>
            <span class=s2>&quot; are sure you want to run this. A smaller `max_depth` is&quot;</span>
            <span class=s2>&quot; highly recommended.&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span>

    <span class=n>moc</span> <span class=o>=</span> <span class=n>create_moc_from_fits</span><span class=p>(</span>
        <span class=n>images_to_use</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
        <span class=n>max_depth</span><span class=o>=</span><span class=n>max_depth</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>images_to_use</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>img</span> <span class=ow>in</span> <span class=n>images_to_use</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
            <span class=n>img_moc</span> <span class=o>=</span> <span class=n>create_moc_from_fits</span><span class=p>(</span>
                <span class=n>img</span><span class=p>,</span>
                <span class=n>max_depth</span>
            <span class=p>)</span>
            <span class=n>moc</span> <span class=o>=</span> <span class=n>moc</span><span class=o>.</span><span class=n>union</span><span class=p>(</span><span class=n>img_moc</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>moc</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.filter_by_moc class="doc doc-heading"> <code class="highlight language-python"><span class=n>filter_by_moc</span><span class=p>(</span><span class=n>moc</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.filter_by_moc class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Filters the PipeRun object to only contain the sources that are located within the provided moc area.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>moc</code></td> <td> <code><span title="mocpy.MOC">MOC</span></code> </td> <td> <div class=doc-md-description> <p>MOC instance for which to filter the run by.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.PipeAnalysis" href="#vasttools.pipeline.PipeAnalysis">PipeAnalysis</a></code> </td> <td> <div class=doc-md-description> <p>A new <code>PipeRun</code> object containing the sources within the MOC.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>filter_by_moc</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>moc</span><span class=p>:</span> <span class=n>mocpy</span><span class=o>.</span><span class=n>MOC</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Filters the PipeRun object to only contain the sources that are</span>
<span class=sd>    located within the provided moc area.</span>

<span class=sd>    Args:</span>
<span class=sd>        moc: MOC instance for which to filter the run by.</span>

<span class=sd>    Returns:</span>
<span class=sd>        A new `PipeRun` object containing the sources within the MOC.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>source_mask</span> <span class=o>=</span> <span class=n>moc</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources_skycoord</span><span class=o>.</span><span class=n>dec</span><span class=p>)</span>

    <span class=n>new_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>source_mask</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=n>new_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span>
        <span class=n>new_meas</span> <span class=o>=</span> <span class=n>new_meas</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>new_meas</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
                <span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
            <span class=p>)]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>new_images</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_meas</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>new_skyregions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>skyregions</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_images</span><span class=p>[</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=n>new_associations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>associations</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>associations</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
            <span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
        <span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=p>]</span>

    <span class=n>new_bands</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bands</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>bands</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>new_images</span><span class=p>[</span><span class=s1>&#39;band_id&#39;</span><span class=p>])</span>
    <span class=p>]</span>

    <span class=n>new_relations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=p>[</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>relations</span><span class=p>[</span><span class=s1>&#39;from_source_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
            <span class=n>new_sources</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
        <span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=p>]</span>

    <span class=n>new_PipeRun</span> <span class=o>=</span> <span class=n>PipeAnalysis</span><span class=p>(</span>
        <span class=n>name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
        <span class=n>images</span><span class=o>=</span><span class=n>new_images</span><span class=p>,</span>
        <span class=n>skyregions</span><span class=o>=</span><span class=n>new_skyregions</span><span class=p>,</span>
        <span class=n>relations</span><span class=o>=</span><span class=n>new_relations</span><span class=p>,</span>
        <span class=n>sources</span><span class=o>=</span><span class=n>new_sources</span><span class=p>,</span>
        <span class=n>associations</span><span class=o>=</span><span class=n>new_associations</span><span class=p>,</span>
        <span class=n>bands</span><span class=o>=</span><span class=n>new_bands</span><span class=p>,</span>
        <span class=n>measurements</span><span class=o>=</span><span class=n>new_meas</span><span class=p>,</span>
        <span class=n>measurement_pairs_file</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>,</span>
        <span class=n>vaex_meas</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>new_PipeRun</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.get_source class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_source</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=n>field</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>stokes</span><span class=o>=</span><span class=s1>&#39;I&#39;</span><span class=p>,</span> <span class=n>outdir</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>user_measurements</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>user_sources</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.get_source class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Fetches an individual source and returns a vasttools.source.Source object.</p> <p>Users do not need to change the field, stokes and outdir parameters.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>id</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>The id of the source to load.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>field</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>The field of the source being loaded, defaults to None. If None then the run name is used as the field.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>stokes</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Stokes parameter of the source, defaults to 'I'.</p> </div> </td> <td> <code>&#39;I&#39;</code> </td> </tr> <tr class=doc-section-item> <td><code>outdir</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The output directory where generated plots will be saved, defauls to '.' (the current working directory).</p> </div> </td> <td> <code>&#39;.&#39;</code> </td> </tr> <tr class=doc-section-item> <td><code>user_measurements</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="vaex.dataframe.DataFrame">DataFrame</span>]]</code> </td> <td> <div class=doc-md-description> <p>A user generated measurements dataframe to use instead of the default pipeline result. The type must match the default type of the pipeline (vaex or pandas). Defaults to None, in which case the default pipeline measurements are used.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>user_sources</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>A user generated sources dataframe to use instead of the default pipeline result. Format is always a pandas dataframe. Defaults to None, in which case the default pipeline measurements are used.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.source.Source" href="../source/#vasttools.source.Source">Source</a></code> </td> <td> <div class=doc-md-description> <p>A vast-tools <code>Source</code> object corresponding to the requested source.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_source</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>field</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>stokes</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;I&#39;</span><span class=p>,</span>
    <span class=n>outdir</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>,</span>
    <span class=n>user_measurements</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span>
        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>vaex</span><span class=o>.</span><span class=n>dataframe</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span>
    <span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>user_sources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Source</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Fetches an individual source and returns a</span>
<span class=sd>    vasttools.source.Source object.</span>

<span class=sd>    Users do not need</span>
<span class=sd>    to change the field, stokes and outdir parameters.</span>

<span class=sd>    Args:</span>
<span class=sd>        id: The id of the source to load.</span>
<span class=sd>        field: The field of the source being loaded, defaults</span>
<span class=sd>            to None. If None then the run name is used as the field.</span>
<span class=sd>        stokes: Stokes parameter of the source, defaults to &#39;I&#39;.</span>
<span class=sd>        outdir: The output directory where generated plots will</span>
<span class=sd>            be saved, defauls to &#39;.&#39; (the current working directory).</span>
<span class=sd>        user_measurements: A user generated measurements dataframe to</span>
<span class=sd>            use instead of the default pipeline result. The type must match</span>
<span class=sd>            the default type of the pipeline (vaex or pandas). Defaults to</span>
<span class=sd>            None, in which case the default pipeline measurements are used.</span>
<span class=sd>        user_sources: A user generated sources dataframe to use</span>
<span class=sd>            instead of the default pipeline result. Format is always a</span>
<span class=sd>            pandas dataframe. Defaults to None, in which case the default</span>
<span class=sd>            pipeline measurements are used.</span>

<span class=sd>    Returns:</span>
<span class=sd>        A vast-tools `Source` object corresponding to the requested source.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>user_measurements</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>the_measurements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurements</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>the_measurements</span> <span class=o>=</span> <span class=n>user_measurements</span>

    <span class=k>if</span> <span class=n>user_sources</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=n>user_sources</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas</span><span class=p>:</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>the_measurements</span><span class=p>[</span>
            <span class=n>the_measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>id</span>
        <span class=p>]</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>the_measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>the_measurements</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nb>id</span>
        <span class=p>]</span>

    <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span>
            <span class=s1>&#39;path&#39;</span><span class=p>,</span>
            <span class=s1>&#39;noise_path&#39;</span><span class=p>,</span>
            <span class=s1>&#39;measurements_path&#39;</span><span class=p>,</span>
            <span class=s1>&#39;frequency&#39;</span>
        <span class=p>]],</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id&#39;</span><span class=p>,</span>
        <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;path&#39;</span><span class=p>:</span> <span class=s1>&#39;image&#39;</span><span class=p>,</span>
            <span class=s1>&#39;noise_path&#39;</span><span class=p>:</span> <span class=s1>&#39;rms&#39;</span><span class=p>,</span>
            <span class=s1>&#39;measurements_path&#39;</span><span class=p>:</span> <span class=s1>&#39;selavy&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;time&#39;</span><span class=p>:</span> <span class=s1>&#39;dateobs&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>)</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span>
        <span class=n>by</span><span class=o>=</span><span class=s1>&#39;dateobs&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=n>s</span> <span class=o>=</span> <span class=n>the_sources</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span>

    <span class=n>num_measurements</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=s1>&#39;n_measurements&#39;</span><span class=p>]</span>

    <span class=n>source_coord</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>s</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>],</span>
        <span class=n>s</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>],</span>
        <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>source_name</span> <span class=o>=</span> <span class=s2>&quot;VAST </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>source_coord</span><span class=o>.</span><span class=n>to_string</span><span class=p>(</span>
            <span class=s2>&quot;hmsdms&quot;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>precision</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
            <span class=s2>&quot; &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
        <span class=p>)[:</span><span class=mi>15</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=n>source_epochs</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_measurements</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
    <span class=k>if</span> <span class=n>field</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>field</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;field&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;epoch&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>source_epochs</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;stokes&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>stokes</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;skycoord&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>source_coord</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_measurements</span><span class=p>)</span>
    <span class=p>]</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;detection&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;forced&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>False</span>
    <span class=n>source_fields</span> <span class=o>=</span> <span class=p>[</span><span class=n>field</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_measurements</span><span class=p>)]</span>
    <span class=n>source_stokes</span> <span class=o>=</span> <span class=n>stokes</span>
    <span class=n>source_base_folder</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>source_crossmatch_radius</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>source_outdir</span> <span class=o>=</span> <span class=n>outdir</span>
    <span class=n>source_image_type</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=n>thesource</span> <span class=o>=</span> <span class=n>Source</span><span class=p>(</span>
        <span class=n>source_coord</span><span class=p>,</span>
        <span class=n>source_name</span><span class=p>,</span>
        <span class=n>source_epochs</span><span class=p>,</span>
        <span class=n>source_fields</span><span class=p>,</span>
        <span class=n>source_stokes</span><span class=p>,</span>
        <span class=kc>None</span><span class=p>,</span>
        <span class=n>source_crossmatch_radius</span><span class=p>,</span>
        <span class=n>measurements</span><span class=p>,</span>
        <span class=n>source_base_folder</span><span class=p>,</span>
        <span class=n>source_image_type</span><span class=p>,</span>
        <span class=n>islands</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
        <span class=n>outdir</span><span class=o>=</span><span class=n>source_outdir</span><span class=p>,</span>
        <span class=n>pipeline</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>thesource</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.get_sources_skycoord class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_sources_skycoord</span><span class=p>(</span><span class=n>user_sources</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>,</span> <span class=n>ra_unit</span><span class=o>=</span><span class=n>u</span><span class=o>.</span><span class=n>degree</span><span class=p>,</span> <span class=n>dec_unit</span><span class=o>=</span><span class=n>u</span><span class=o>.</span><span class=n>degree</span><span class=p>)</span></code> <a href=#vasttools.pipeline.PipeRun.get_sources_skycoord class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>A convenience function to generate a SkyCoord object from the sources dataframe. Also has support for custom source lists.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>user_sources</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class=doc-md-description> <p>Provide a user generated source dataframe in place of using the default run sources dataframe.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>ra_col</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The column to use for the Right Ascension.</p> </div> </td> <td> <code>&#39;wavg_ra&#39;</code> </td> </tr> <tr class=doc-section-item> <td><code>dec_col</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The column to use for the Declination.</p> </div> </td> <td> <code>&#39;wavg_dec&#39;</code> </td> </tr> <tr class=doc-section-item> <td><code>ra_unit</code></td> <td> <code><span title="astropy.units.Unit">Unit</span></code> </td> <td> <div class=doc-md-description> <p>The unit of the RA column, defaults to degrees. Must be an astropy.unit value.</p> </div> </td> <td> <code><span title="astropy.units.degree">degree</span></code> </td> </tr> <tr class=doc-section-item> <td><code>dec_unit</code></td> <td> <code><span title="astropy.units.Unit">Unit</span></code> </td> <td> <div class=doc-md-description> <p>The unit of the Dec column, defaults to degrees. Must be an astropy.unit value.</p> </div> </td> <td> <code><span title="astropy.units.degree">degree</span></code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="astropy.coordinates.sky_coordinate.SkyCoord">SkyCoord</span></code> </td> <td> <div class=doc-md-description> <p>A SkyCoord containing the source coordinates.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_sources_skycoord</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>user_sources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>ra_col</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span>
    <span class=n>dec_col</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;wavg_dec&#39;</span><span class=p>,</span>
    <span class=n>ra_unit</span><span class=p>:</span> <span class=n>u</span><span class=o>.</span><span class=n>Unit</span> <span class=o>=</span> <span class=n>u</span><span class=o>.</span><span class=n>degree</span><span class=p>,</span>
    <span class=n>dec_unit</span><span class=p>:</span> <span class=n>u</span><span class=o>.</span><span class=n>Unit</span> <span class=o>=</span> <span class=n>u</span><span class=o>.</span><span class=n>degree</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>astropy</span><span class=o>.</span><span class=n>coordinates</span><span class=o>.</span><span class=n>sky_coordinate</span><span class=o>.</span><span class=n>SkyCoord</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    A convenience function to generate a SkyCoord object from the</span>
<span class=sd>    sources dataframe. Also has support for custom source lists.</span>

<span class=sd>    Args:</span>
<span class=sd>        user_sources: Provide a user generated source dataframe</span>
<span class=sd>            in place of using the default run sources dataframe.</span>
<span class=sd>        ra_col: The column to use for the Right Ascension.</span>
<span class=sd>        dec_col: The column to use for the Declination.</span>
<span class=sd>        ra_unit: The unit of the RA column, defaults to degrees.</span>
<span class=sd>            Must be an astropy.unit value.</span>
<span class=sd>        dec_unit: The unit of the Dec column, defaults to degrees.</span>
<span class=sd>            Must be an astropy.unit value.</span>

<span class=sd>    Returns:</span>
<span class=sd>        A SkyCoord containing the source coordinates.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>user_sources</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>the_sources</span> <span class=o>=</span> <span class=n>user_sources</span>

    <span class=n>sources_skycoord</span> <span class=o>=</span> <span class=n>gen_skycoord_from_df</span><span class=p>(</span>
        <span class=n>the_sources</span><span class=p>,</span> <span class=n>ra_col</span><span class=o>=</span><span class=n>ra_col</span><span class=p>,</span> <span class=n>dec_col</span><span class=o>=</span><span class=n>dec_col</span><span class=p>,</span> <span class=n>ra_unit</span><span class=o>=</span><span class=n>ra_unit</span><span class=p>,</span>
        <span class=n>dec_unit</span><span class=o>=</span><span class=n>dec_unit</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>sources_skycoord</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.PipeRun.load_two_epoch_metrics class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_two_epoch_metrics</span><span class=p>()</span></code> <a href=#vasttools.pipeline.PipeRun.load_two_epoch_metrics class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Loads the two epoch metrics dataframe, usually stored as either 'measurement_pairs.parquet' or 'measurement_pairs.arrow'.</p> <p>The two epoch metrics dataframe is stored as an attribute to the PipeRun object as self.measurement_pairs_df. An epoch 'key' is also added to the dataframe.</p> <p>Also creates a 'pairs_df' that lists all the possible epoch pairs. This is stored as the attribute self.pairs_df.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.MeasPairsDoNotExistError" href="#vasttools.pipeline.MeasPairsDoNotExistError">MeasPairsDoNotExistError</a></code> </td> <td> <div class=doc-md-description> <p>The measurement pairs file(s) do not exist for this run</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>load_two_epoch_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Loads the two epoch metrics dataframe, usually stored as either</span>
<span class=sd>    &#39;measurement_pairs.parquet&#39; or &#39;measurement_pairs.arrow&#39;.</span>

<span class=sd>    The two epoch metrics dataframe is stored as an attribute to the</span>
<span class=sd>    PipeRun object as self.measurement_pairs_df. An epoch &#39;key&#39; is also</span>
<span class=sd>    added to the dataframe.</span>

<span class=sd>    Also creates a &#39;pairs_df&#39; that lists all the possible epoch pairs.</span>
<span class=sd>    This is stored as the attribute self.pairs_df.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>

<span class=sd>    Raises:</span>
<span class=sd>        MeasPairsDoNotExistError: The measurement pairs file(s) do not</span>
<span class=sd>            exist for this run</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_raise_if_no_pairs</span><span class=p>()</span>

    <span class=n>image_ids</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
        <span class=p>{</span><span class=s1>&#39;pair&#39;</span><span class=p>:</span> <span class=n>combinations</span><span class=p>(</span><span class=n>image_ids</span><span class=p>,</span> <span class=mi>2</span><span class=p>)}</span>
    <span class=p>)</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;pair&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;image_id_a&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s1>&#39;image_id_b&#39;</span><span class=p>})</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>]],</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id_a&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>images</span><span class=p>[[</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>]],</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id_b&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;_a&#39;</span><span class=p>,</span> <span class=s1>&#39;_b&#39;</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;index&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>,</span>
            <span class=s1>&#39;name_a&#39;</span><span class=p>:</span> <span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span>
            <span class=s1>&#39;name_b&#39;</span><span class=p>:</span> <span class=s1>&#39;image_name_b&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;td&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;datetime_b&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;datetime_a&#39;</span><span class=p>]</span>

    <span class=n>pairs_df</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;datetime_a&#39;</span><span class=p>,</span> <span class=s1>&#39;datetime_b&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>pairs_df</span><span class=p>[[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_b&#39;</span><span class=p>]]</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>arrow_files</span> <span class=o>=</span> <span class=p>(</span>
            <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.arrow&quot;</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>arrow_files</span><span class=p>):</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>open_many</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=n>arrow_files</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=o>~</span><span class=n>arrow_files</span><span class=p>]:</span>
                <span class=n>temp</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                <span class=n>temp</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
                <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurement pairs have been loaded with vaex.&quot;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>
            <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;.arrow&#39;</span><span class=p>):</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>vaex</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurement pairs have been loaded with vaex.&quot;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_file</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_vaex_meas_pairs</span><span class=p>:</span>
        <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;_&quot;</span>
            <span class=o>+</span> <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>pair_epoch_key</span><span class=p>,</span> <span class=n>agg</span><span class=o>=</span><span class=s1>&#39;count&#39;</span>
        <span class=p>)</span>

        <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>pair_counts</span><span class=o>.</span><span class=n>to_pandas_df</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=s1>&#39;total_pairs&#39;</span><span class=p>}</span>
        <span class=p>)</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurement_pairs_df</span><span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>measurement_pairs_df</span><span class=p>[[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_b&#39;</span><span class=p>]]</span>
            <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;image_name_b&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=n>pair_counts</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span><span class=p>[</span>
            <span class=p>[</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>,</span> <span class=s1>&#39;image_name_a&#39;</span><span class=p>]</span>
        <span class=p>]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;image_name_a&#39;</span><span class=p>:</span> <span class=s1>&#39;total_pairs&#39;</span><span class=p>}</span>
        <span class=p>)</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>pair_counts</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;pair_epoch_key&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>del</span> <span class=n>pair_counts</span>

    <span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>subset</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;total_pairs&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>measurement_pairs_df</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>pairs_df</span> <span class=o>=</span> <span class=n>pairs_df</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;td&#39;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_loaded_two_epoch_metrics</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.Pipeline class="doc doc-heading"> <code>Pipeline</code> <a href=#vasttools.pipeline.Pipeline class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>object</code></p> <p>Class to interface with VAST Pipeline results.</p> <p>Attributes:</p> <div class=highlight><pre><span></span><code>project_dir (str): The pipeline project directory provided by the user
    on initialisation.
</code></pre></div> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2464</span>
<span class=normal>2465</span>
<span class=normal>2466</span>
<span class=normal>2467</span>
<span class=normal>2468</span>
<span class=normal>2469</span>
<span class=normal>2470</span>
<span class=normal>2471</span>
<span class=normal>2472</span>
<span class=normal>2473</span>
<span class=normal>2474</span>
<span class=normal>2475</span>
<span class=normal>2476</span>
<span class=normal>2477</span>
<span class=normal>2478</span>
<span class=normal>2479</span>
<span class=normal>2480</span>
<span class=normal>2481</span>
<span class=normal>2482</span>
<span class=normal>2483</span>
<span class=normal>2484</span>
<span class=normal>2485</span>
<span class=normal>2486</span>
<span class=normal>2487</span>
<span class=normal>2488</span>
<span class=normal>2489</span>
<span class=normal>2490</span>
<span class=normal>2491</span>
<span class=normal>2492</span>
<span class=normal>2493</span>
<span class=normal>2494</span>
<span class=normal>2495</span>
<span class=normal>2496</span>
<span class=normal>2497</span>
<span class=normal>2498</span>
<span class=normal>2499</span>
<span class=normal>2500</span>
<span class=normal>2501</span>
<span class=normal>2502</span>
<span class=normal>2503</span>
<span class=normal>2504</span>
<span class=normal>2505</span>
<span class=normal>2506</span>
<span class=normal>2507</span>
<span class=normal>2508</span>
<span class=normal>2509</span>
<span class=normal>2510</span>
<span class=normal>2511</span>
<span class=normal>2512</span>
<span class=normal>2513</span>
<span class=normal>2514</span>
<span class=normal>2515</span>
<span class=normal>2516</span>
<span class=normal>2517</span>
<span class=normal>2518</span>
<span class=normal>2519</span>
<span class=normal>2520</span>
<span class=normal>2521</span>
<span class=normal>2522</span>
<span class=normal>2523</span>
<span class=normal>2524</span>
<span class=normal>2525</span>
<span class=normal>2526</span>
<span class=normal>2527</span>
<span class=normal>2528</span>
<span class=normal>2529</span>
<span class=normal>2530</span>
<span class=normal>2531</span>
<span class=normal>2532</span>
<span class=normal>2533</span>
<span class=normal>2534</span>
<span class=normal>2535</span>
<span class=normal>2536</span>
<span class=normal>2537</span>
<span class=normal>2538</span>
<span class=normal>2539</span>
<span class=normal>2540</span>
<span class=normal>2541</span>
<span class=normal>2542</span>
<span class=normal>2543</span>
<span class=normal>2544</span>
<span class=normal>2545</span>
<span class=normal>2546</span>
<span class=normal>2547</span>
<span class=normal>2548</span>
<span class=normal>2549</span>
<span class=normal>2550</span>
<span class=normal>2551</span>
<span class=normal>2552</span>
<span class=normal>2553</span>
<span class=normal>2554</span>
<span class=normal>2555</span>
<span class=normal>2556</span>
<span class=normal>2557</span>
<span class=normal>2558</span>
<span class=normal>2559</span>
<span class=normal>2560</span>
<span class=normal>2561</span>
<span class=normal>2562</span>
<span class=normal>2563</span>
<span class=normal>2564</span>
<span class=normal>2565</span>
<span class=normal>2566</span>
<span class=normal>2567</span>
<span class=normal>2568</span>
<span class=normal>2569</span>
<span class=normal>2570</span>
<span class=normal>2571</span>
<span class=normal>2572</span>
<span class=normal>2573</span>
<span class=normal>2574</span>
<span class=normal>2575</span>
<span class=normal>2576</span>
<span class=normal>2577</span>
<span class=normal>2578</span>
<span class=normal>2579</span>
<span class=normal>2580</span>
<span class=normal>2581</span>
<span class=normal>2582</span>
<span class=normal>2583</span>
<span class=normal>2584</span>
<span class=normal>2585</span>
<span class=normal>2586</span>
<span class=normal>2587</span>
<span class=normal>2588</span>
<span class=normal>2589</span>
<span class=normal>2590</span>
<span class=normal>2591</span>
<span class=normal>2592</span>
<span class=normal>2593</span>
<span class=normal>2594</span>
<span class=normal>2595</span>
<span class=normal>2596</span>
<span class=normal>2597</span>
<span class=normal>2598</span>
<span class=normal>2599</span>
<span class=normal>2600</span>
<span class=normal>2601</span>
<span class=normal>2602</span>
<span class=normal>2603</span>
<span class=normal>2604</span>
<span class=normal>2605</span>
<span class=normal>2606</span>
<span class=normal>2607</span>
<span class=normal>2608</span>
<span class=normal>2609</span>
<span class=normal>2610</span>
<span class=normal>2611</span>
<span class=normal>2612</span>
<span class=normal>2613</span>
<span class=normal>2614</span>
<span class=normal>2615</span>
<span class=normal>2616</span>
<span class=normal>2617</span>
<span class=normal>2618</span>
<span class=normal>2619</span>
<span class=normal>2620</span>
<span class=normal>2621</span>
<span class=normal>2622</span>
<span class=normal>2623</span>
<span class=normal>2624</span>
<span class=normal>2625</span>
<span class=normal>2626</span>
<span class=normal>2627</span>
<span class=normal>2628</span>
<span class=normal>2629</span>
<span class=normal>2630</span>
<span class=normal>2631</span>
<span class=normal>2632</span>
<span class=normal>2633</span>
<span class=normal>2634</span>
<span class=normal>2635</span>
<span class=normal>2636</span>
<span class=normal>2637</span>
<span class=normal>2638</span>
<span class=normal>2639</span>
<span class=normal>2640</span>
<span class=normal>2641</span>
<span class=normal>2642</span>
<span class=normal>2643</span>
<span class=normal>2644</span>
<span class=normal>2645</span>
<span class=normal>2646</span>
<span class=normal>2647</span>
<span class=normal>2648</span>
<span class=normal>2649</span>
<span class=normal>2650</span>
<span class=normal>2651</span>
<span class=normal>2652</span>
<span class=normal>2653</span>
<span class=normal>2654</span>
<span class=normal>2655</span>
<span class=normal>2656</span>
<span class=normal>2657</span>
<span class=normal>2658</span>
<span class=normal>2659</span>
<span class=normal>2660</span>
<span class=normal>2661</span>
<span class=normal>2662</span>
<span class=normal>2663</span>
<span class=normal>2664</span>
<span class=normal>2665</span>
<span class=normal>2666</span>
<span class=normal>2667</span>
<span class=normal>2668</span>
<span class=normal>2669</span>
<span class=normal>2670</span>
<span class=normal>2671</span>
<span class=normal>2672</span>
<span class=normal>2673</span>
<span class=normal>2674</span>
<span class=normal>2675</span>
<span class=normal>2676</span>
<span class=normal>2677</span>
<span class=normal>2678</span>
<span class=normal>2679</span>
<span class=normal>2680</span>
<span class=normal>2681</span>
<span class=normal>2682</span>
<span class=normal>2683</span>
<span class=normal>2684</span>
<span class=normal>2685</span>
<span class=normal>2686</span>
<span class=normal>2687</span>
<span class=normal>2688</span>
<span class=normal>2689</span>
<span class=normal>2690</span>
<span class=normal>2691</span>
<span class=normal>2692</span>
<span class=normal>2693</span>
<span class=normal>2694</span>
<span class=normal>2695</span>
<span class=normal>2696</span>
<span class=normal>2697</span>
<span class=normal>2698</span>
<span class=normal>2699</span>
<span class=normal>2700</span>
<span class=normal>2701</span>
<span class=normal>2702</span>
<span class=normal>2703</span>
<span class=normal>2704</span>
<span class=normal>2705</span>
<span class=normal>2706</span>
<span class=normal>2707</span>
<span class=normal>2708</span>
<span class=normal>2709</span>
<span class=normal>2710</span>
<span class=normal>2711</span>
<span class=normal>2712</span>
<span class=normal>2713</span>
<span class=normal>2714</span>
<span class=normal>2715</span>
<span class=normal>2716</span>
<span class=normal>2717</span>
<span class=normal>2718</span>
<span class=normal>2719</span>
<span class=normal>2720</span>
<span class=normal>2721</span>
<span class=normal>2722</span>
<span class=normal>2723</span>
<span class=normal>2724</span>
<span class=normal>2725</span>
<span class=normal>2726</span>
<span class=normal>2727</span>
<span class=normal>2728</span>
<span class=normal>2729</span>
<span class=normal>2730</span>
<span class=normal>2731</span>
<span class=normal>2732</span>
<span class=normal>2733</span>
<span class=normal>2734</span>
<span class=normal>2735</span>
<span class=normal>2736</span>
<span class=normal>2737</span>
<span class=normal>2738</span>
<span class=normal>2739</span>
<span class=normal>2740</span>
<span class=normal>2741</span>
<span class=normal>2742</span>
<span class=normal>2743</span>
<span class=normal>2744</span>
<span class=normal>2745</span>
<span class=normal>2746</span>
<span class=normal>2747</span>
<span class=normal>2748</span>
<span class=normal>2749</span>
<span class=normal>2750</span>
<span class=normal>2751</span>
<span class=normal>2752</span>
<span class=normal>2753</span>
<span class=normal>2754</span>
<span class=normal>2755</span>
<span class=normal>2756</span>
<span class=normal>2757</span>
<span class=normal>2758</span>
<span class=normal>2759</span>
<span class=normal>2760</span>
<span class=normal>2761</span>
<span class=normal>2762</span>
<span class=normal>2763</span>
<span class=normal>2764</span>
<span class=normal>2765</span>
<span class=normal>2766</span>
<span class=normal>2767</span>
<span class=normal>2768</span>
<span class=normal>2769</span>
<span class=normal>2770</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>Pipeline</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Class to interface with VAST Pipeline results.</span>

<span class=sd>    Attributes:</span>

<span class=sd>        project_dir (str): The pipeline project directory provided by the user</span>
<span class=sd>            on initialisation.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Constructor method.</span>

<span class=sd>        The system variable `PIPELINE_WORKING_DIR` will be checked</span>
<span class=sd>        first with the project_dir input the fallback option.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_dir: The directory of the pipeline results. Only required</span>
<span class=sd>                when the system variable is not defined, defaults to &#39;None&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>

<span class=sd>        Raises:</span>
<span class=sd>            Exception: The `PIPELINE_WORKING_DIR` could not be determined.</span>
<span class=sd>            Exception: Pipeline run directory is not found.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=nb>super</span><span class=p>(</span><span class=n>Pipeline</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>

        <span class=k>if</span> <span class=n>project_dir</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>pipeline_run_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;PIPELINE_WORKING_DIR&#39;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>pipeline_run_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>PipelineDirectoryError</span><span class=p>(</span>
                    <span class=s2>&quot;The pipeline run directory could not be determined!&quot;</span>
                    <span class=s2>&quot; Either the system environment &#39;PIPELINE_WORKING_DIR&#39;&quot;</span>
                    <span class=s2>&quot; must be defined or the &#39;project_dir&#39; argument defined&quot;</span>
                    <span class=s2>&quot; when initialising the pipeline class object.&quot;</span>
                <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>pipeline_run_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>project_dir</span><span class=p>))</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>pipeline_run_path</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>PipelineDirectoryError</span><span class=p>(</span>
                <span class=s2>&quot;Pipeline run directory </span><span class=si>{}</span><span class=s2> not found!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>pipeline_run_path</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span> <span class=o>=</span> <span class=n>pipeline_run_path</span>

    <span class=k>def</span> <span class=nf>list_piperuns</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Lists the runs present in the pipeline directory.</span>

<span class=sd>        Note this just list the directories, i.e. it is not known whether the</span>
<span class=sd>        runs are actually processed.</span>

<span class=sd>        Returns:</span>
<span class=sd>            List of pipeline run names present in directory.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>jobs</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span> <span class=s2>&quot;*&quot;</span><span class=p>)</span>
        <span class=p>))</span>

        <span class=n>jobs</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>jobs</span><span class=p>]</span>
        <span class=n>jobs</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>jobs</span>

    <span class=k>def</span> <span class=nf>list_images</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Lists all images processed in the pipeline directory.</span>

<span class=sd>        Returns:</span>
<span class=sd>            List of images processed.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>img_list</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span> <span class=s2>&quot;images&quot;</span><span class=p>,</span> <span class=s2>&quot;*&quot;</span><span class=p>)</span>
        <span class=p>))</span>

        <span class=n>img_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>img_list</span><span class=p>]</span>

        <span class=k>return</span> <span class=n>img_list</span>

    <span class=k>def</span> <span class=nf>load_runs</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>run_names</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Wrapper to load multiple runs in one command.</span>

<span class=sd>        Args:</span>
<span class=sd>            run_names: List containing the names of the runs to load.</span>
<span class=sd>            name: A name for the resulting pipeline run.</span>
<span class=sd>            n_workers: The number of workers (cpus) available.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Combined PipeAnalysis object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>piperun</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_run</span><span class=p>(</span>
            <span class=n>run_names</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
            <span class=n>n_workers</span><span class=o>=</span><span class=n>n_workers</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>run_names</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>run_names</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
                <span class=n>piperun</span> <span class=o>=</span> <span class=n>piperun</span><span class=o>.</span><span class=n>combine_with_run</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>load_run</span><span class=p>(</span>
                        <span class=n>r</span><span class=p>,</span>
                        <span class=n>n_workers</span><span class=o>=</span><span class=n>n_workers</span>
                    <span class=p>)</span>
                <span class=p>)</span>
        <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>piperun</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>

        <span class=k>return</span> <span class=n>piperun</span>

    <span class=k>def</span> <span class=nf>load_run</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>run_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Process and load a pipeline run.</span>

<span class=sd>        Args:</span>
<span class=sd>            run_name: The name of the run to load.</span>
<span class=sd>            n_workers: The number of workers (cpus) available.</span>

<span class=sd>        Returns:</span>
<span class=sd>            PipeAnalysis object.</span>

<span class=sd>        Raises:</span>
<span class=sd>            ValueError: Entered pipeline run does not exist.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>run_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span>
            <span class=n>run_name</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>run_dir</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>OSError</span><span class=p>(</span>
                <span class=s2>&quot;Run &#39;</span><span class=si>%s</span><span class=s2>&#39; directory does not exist!&quot;</span><span class=p>,</span>
                <span class=n>run_name</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=n>images</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s1>&#39;images.parquet&#39;</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=n>skyregions</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s1>&#39;skyregions.parquet&#39;</span>
            <span class=p>),</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span>

        <span class=n>bands</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s1>&#39;bands.parquet&#39;</span>
            <span class=p>),</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span>

        <span class=n>images</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>skyregions</span><span class=p>[[</span>
                <span class=s1>&#39;id&#39;</span><span class=p>,</span>
                <span class=s1>&#39;centre_ra&#39;</span><span class=p>,</span>
                <span class=s1>&#39;centre_dec&#39;</span><span class=p>,</span>
                <span class=s1>&#39;xtr_radius&#39;</span>
            <span class=p>]],</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>,</span>
            <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=s1>&#39;id_y&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id_x&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>}</span>
        <span class=p>)</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>  <span class=c1># second merge for band</span>
            <span class=n>bands</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;frequency&#39;</span><span class=p>,</span> <span class=s1>&#39;bandwidth&#39;</span><span class=p>]],</span>
            <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;band_id&#39;</span><span class=p>,</span>
            <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=s1>&#39;id_y&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id_x&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>}</span>
        <span class=p>)</span>

        <span class=n>relations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s1>&#39;relations.parquet&#39;</span>
            <span class=p>),</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span>

        <span class=n>sources</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s1>&#39;sources.parquet&#39;</span>
            <span class=p>),</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span>

        <span class=n>to_move</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>,</span> <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>,</span> <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>,</span> <span class=s1>&#39;n_sibl&#39;</span><span class=p>,</span> <span class=s1>&#39;n_rel&#39;</span><span class=p>]</span>
        <span class=n>sources_len</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>to_move</span><span class=p>:</span>
            <span class=n>col</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
            <span class=n>sources</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>sources_len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>

        <span class=n>sources</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
            <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
                <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>:</span> <span class=s1>&#39;n_forced&#39;</span><span class=p>,</span>
                <span class=s1>&#39;n_meas&#39;</span><span class=p>:</span> <span class=s1>&#39;n_measurements&#39;</span><span class=p>,</span>
                <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>:</span> <span class=s1>&#39;n_selavy&#39;</span><span class=p>,</span>
                <span class=s1>&#39;n_sibl&#39;</span><span class=p>:</span> <span class=s1>&#39;n_siblings&#39;</span><span class=p>,</span>
                <span class=s1>&#39;n_rel&#39;</span><span class=p>:</span> <span class=s1>&#39;n_relations&#39;</span>
            <span class=p>}</span>
        <span class=p>)</span>

        <span class=n>associations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s1>&#39;associations.parquet&#39;</span>
            <span class=p>),</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span>

        <span class=n>vaex_meas</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;measurements.arrow&#39;</span>
        <span class=p>)):</span>
            <span class=n>measurements</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>open</span><span class=p>(</span>
                <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>run_dir</span><span class=p>,</span> <span class=s1>&#39;measurements.arrow&#39;</span><span class=p>)</span>
            <span class=p>)</span>

            <span class=n>vaex_meas</span> <span class=o>=</span> <span class=kc>True</span>

            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurements have been loaded with vaex.&quot;</span><span class=p>)</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>m_files</span> <span class=o>=</span> <span class=n>images</span><span class=p>[</span><span class=s1>&#39;measurements_path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
            <span class=n>m_files</span> <span class=o>+=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s2>&quot;forced_measurements*.parquet&quot;</span>
            <span class=p>)))</span>

            <span class=c1># use dask to open measurement parquets</span>
            <span class=c1># as they are spread over many different files</span>
            <span class=n>measurements</span> <span class=o>=</span> <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
                <span class=n>m_files</span><span class=p>,</span>
                <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>

            <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
                <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>associations</span><span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
            <span class=p>]</span>

            <span class=n>measurements</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>associations</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>,</span> <span class=s1>&#39;source_id&#39;</span><span class=p>]]</span>
                <span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;meas_id&#39;</span><span class=p>)</span>
                <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
                    <span class=n>measurements</span><span class=p>,</span>
                    <span class=n>left_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                    <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
                <span class=p>)</span>
                <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;source&#39;</span><span class=p>})</span>
            <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=n>images</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;measurement_pairs.arrow&quot;</span>
        <span class=p>)):</span>
            <span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s2>&quot;measurement_pairs.arrow&quot;</span>
            <span class=p>)]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>run_dir</span><span class=p>,</span>
                <span class=s2>&quot;measurement_pairs.parquet&quot;</span>
            <span class=p>)]</span>

        <span class=n>piperun</span> <span class=o>=</span> <span class=n>PipeAnalysis</span><span class=p>(</span>
            <span class=n>name</span><span class=o>=</span><span class=n>run_name</span><span class=p>,</span>
            <span class=n>images</span><span class=o>=</span><span class=n>images</span><span class=p>,</span>
            <span class=n>skyregions</span><span class=o>=</span><span class=n>skyregions</span><span class=p>,</span>
            <span class=n>relations</span><span class=o>=</span><span class=n>relations</span><span class=p>,</span>
            <span class=n>sources</span><span class=o>=</span><span class=n>sources</span><span class=p>,</span>
            <span class=n>associations</span><span class=o>=</span><span class=n>associations</span><span class=p>,</span>
            <span class=n>bands</span><span class=o>=</span><span class=n>bands</span><span class=p>,</span>
            <span class=n>measurements</span><span class=o>=</span><span class=n>measurements</span><span class=p>,</span>
            <span class=n>measurement_pairs_file</span><span class=o>=</span><span class=n>measurement_pairs_file</span><span class=p>,</span>
            <span class=n>vaex_meas</span><span class=o>=</span><span class=n>vaex_meas</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>piperun</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.Pipeline.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>project_dir</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.__init__ class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Constructor method.</p> <p>The system variable <code>PIPELINE_WORKING_DIR</code> will be checked first with the project_dir input the fallback option.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>project_dir</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>The directory of the pipeline results. Only required when the system variable is not defined, defaults to 'None'.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p>The <code>PIPELINE_WORKING_DIR</code> could not be determined.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code>Exception</code> </td> <td> <div class=doc-md-description> <p>Pipeline run directory is not found.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2474</span>
<span class=normal>2475</span>
<span class=normal>2476</span>
<span class=normal>2477</span>
<span class=normal>2478</span>
<span class=normal>2479</span>
<span class=normal>2480</span>
<span class=normal>2481</span>
<span class=normal>2482</span>
<span class=normal>2483</span>
<span class=normal>2484</span>
<span class=normal>2485</span>
<span class=normal>2486</span>
<span class=normal>2487</span>
<span class=normal>2488</span>
<span class=normal>2489</span>
<span class=normal>2490</span>
<span class=normal>2491</span>
<span class=normal>2492</span>
<span class=normal>2493</span>
<span class=normal>2494</span>
<span class=normal>2495</span>
<span class=normal>2496</span>
<span class=normal>2497</span>
<span class=normal>2498</span>
<span class=normal>2499</span>
<span class=normal>2500</span>
<span class=normal>2501</span>
<span class=normal>2502</span>
<span class=normal>2503</span>
<span class=normal>2504</span>
<span class=normal>2505</span>
<span class=normal>2506</span>
<span class=normal>2507</span>
<span class=normal>2508</span>
<span class=normal>2509</span>
<span class=normal>2510</span>
<span class=normal>2511</span>
<span class=normal>2512</span>
<span class=normal>2513</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Constructor method.</span>

<span class=sd>    The system variable `PIPELINE_WORKING_DIR` will be checked</span>
<span class=sd>    first with the project_dir input the fallback option.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_dir: The directory of the pipeline results. Only required</span>
<span class=sd>            when the system variable is not defined, defaults to &#39;None&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>

<span class=sd>    Raises:</span>
<span class=sd>        Exception: The `PIPELINE_WORKING_DIR` could not be determined.</span>
<span class=sd>        Exception: Pipeline run directory is not found.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=nb>super</span><span class=p>(</span><span class=n>Pipeline</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>project_dir</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>pipeline_run_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;PIPELINE_WORKING_DIR&#39;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>pipeline_run_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>PipelineDirectoryError</span><span class=p>(</span>
                <span class=s2>&quot;The pipeline run directory could not be determined!&quot;</span>
                <span class=s2>&quot; Either the system environment &#39;PIPELINE_WORKING_DIR&#39;&quot;</span>
                <span class=s2>&quot; must be defined or the &#39;project_dir&#39; argument defined&quot;</span>
                <span class=s2>&quot; when initialising the pipeline class object.&quot;</span>
            <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>pipeline_run_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>project_dir</span><span class=p>))</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>pipeline_run_path</span><span class=p>):</span>
        <span class=k>raise</span> <span class=n>PipelineDirectoryError</span><span class=p>(</span>
            <span class=s2>&quot;Pipeline run directory </span><span class=si>{}</span><span class=s2> not found!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>pipeline_run_path</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span> <span class=o>=</span> <span class=n>pipeline_run_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.Pipeline.list_images class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_images</span><span class=p>()</span></code> <a href=#vasttools.pipeline.Pipeline.list_images class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Lists all images processed in the pipeline directory.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td> <div class=doc-md-description> <p>List of images processed.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2534</span>
<span class=normal>2535</span>
<span class=normal>2536</span>
<span class=normal>2537</span>
<span class=normal>2538</span>
<span class=normal>2539</span>
<span class=normal>2540</span>
<span class=normal>2541</span>
<span class=normal>2542</span>
<span class=normal>2543</span>
<span class=normal>2544</span>
<span class=normal>2545</span>
<span class=normal>2546</span>
<span class=normal>2547</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>list_images</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Lists all images processed in the pipeline directory.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List of images processed.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>img_list</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span> <span class=s2>&quot;images&quot;</span><span class=p>,</span> <span class=s2>&quot;*&quot;</span><span class=p>)</span>
    <span class=p>))</span>

    <span class=n>img_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>img_list</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>img_list</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.Pipeline.list_piperuns class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_piperuns</span><span class=p>()</span></code> <a href=#vasttools.pipeline.Pipeline.list_piperuns class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Lists the runs present in the pipeline directory.</p> <p>Note this just list the directories, i.e. it is not known whether the runs are actually processed.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td> <div class=doc-md-description> <p>List of pipeline run names present in directory.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2515</span>
<span class=normal>2516</span>
<span class=normal>2517</span>
<span class=normal>2518</span>
<span class=normal>2519</span>
<span class=normal>2520</span>
<span class=normal>2521</span>
<span class=normal>2522</span>
<span class=normal>2523</span>
<span class=normal>2524</span>
<span class=normal>2525</span>
<span class=normal>2526</span>
<span class=normal>2527</span>
<span class=normal>2528</span>
<span class=normal>2529</span>
<span class=normal>2530</span>
<span class=normal>2531</span>
<span class=normal>2532</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>list_piperuns</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Lists the runs present in the pipeline directory.</span>

<span class=sd>    Note this just list the directories, i.e. it is not known whether the</span>
<span class=sd>    runs are actually processed.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List of pipeline run names present in directory.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>jobs</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span> <span class=s2>&quot;*&quot;</span><span class=p>)</span>
    <span class=p>))</span>

    <span class=n>jobs</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>jobs</span><span class=p>]</span>
    <span class=n>jobs</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>jobs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.Pipeline.load_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_run</span><span class=p>(</span><span class=n>run_name</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.load_run class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Process and load a pipeline run.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>run_name</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>The name of the run to load.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>n_workers</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>The number of workers (cpus) available.</p> </div> </td> <td> <code><span title="vasttools.pipeline.HOST_NCPU">HOST_NCPU</span> - 1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.PipeAnalysis" href="#vasttools.pipeline.PipeAnalysis">PipeAnalysis</a></code> </td> <td> <div class=doc-md-description> <p>PipeAnalysis object.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>ValueError</code> </td> <td> <div class=doc-md-description> <p>Entered pipeline run does not exist.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2582</span>
<span class=normal>2583</span>
<span class=normal>2584</span>
<span class=normal>2585</span>
<span class=normal>2586</span>
<span class=normal>2587</span>
<span class=normal>2588</span>
<span class=normal>2589</span>
<span class=normal>2590</span>
<span class=normal>2591</span>
<span class=normal>2592</span>
<span class=normal>2593</span>
<span class=normal>2594</span>
<span class=normal>2595</span>
<span class=normal>2596</span>
<span class=normal>2597</span>
<span class=normal>2598</span>
<span class=normal>2599</span>
<span class=normal>2600</span>
<span class=normal>2601</span>
<span class=normal>2602</span>
<span class=normal>2603</span>
<span class=normal>2604</span>
<span class=normal>2605</span>
<span class=normal>2606</span>
<span class=normal>2607</span>
<span class=normal>2608</span>
<span class=normal>2609</span>
<span class=normal>2610</span>
<span class=normal>2611</span>
<span class=normal>2612</span>
<span class=normal>2613</span>
<span class=normal>2614</span>
<span class=normal>2615</span>
<span class=normal>2616</span>
<span class=normal>2617</span>
<span class=normal>2618</span>
<span class=normal>2619</span>
<span class=normal>2620</span>
<span class=normal>2621</span>
<span class=normal>2622</span>
<span class=normal>2623</span>
<span class=normal>2624</span>
<span class=normal>2625</span>
<span class=normal>2626</span>
<span class=normal>2627</span>
<span class=normal>2628</span>
<span class=normal>2629</span>
<span class=normal>2630</span>
<span class=normal>2631</span>
<span class=normal>2632</span>
<span class=normal>2633</span>
<span class=normal>2634</span>
<span class=normal>2635</span>
<span class=normal>2636</span>
<span class=normal>2637</span>
<span class=normal>2638</span>
<span class=normal>2639</span>
<span class=normal>2640</span>
<span class=normal>2641</span>
<span class=normal>2642</span>
<span class=normal>2643</span>
<span class=normal>2644</span>
<span class=normal>2645</span>
<span class=normal>2646</span>
<span class=normal>2647</span>
<span class=normal>2648</span>
<span class=normal>2649</span>
<span class=normal>2650</span>
<span class=normal>2651</span>
<span class=normal>2652</span>
<span class=normal>2653</span>
<span class=normal>2654</span>
<span class=normal>2655</span>
<span class=normal>2656</span>
<span class=normal>2657</span>
<span class=normal>2658</span>
<span class=normal>2659</span>
<span class=normal>2660</span>
<span class=normal>2661</span>
<span class=normal>2662</span>
<span class=normal>2663</span>
<span class=normal>2664</span>
<span class=normal>2665</span>
<span class=normal>2666</span>
<span class=normal>2667</span>
<span class=normal>2668</span>
<span class=normal>2669</span>
<span class=normal>2670</span>
<span class=normal>2671</span>
<span class=normal>2672</span>
<span class=normal>2673</span>
<span class=normal>2674</span>
<span class=normal>2675</span>
<span class=normal>2676</span>
<span class=normal>2677</span>
<span class=normal>2678</span>
<span class=normal>2679</span>
<span class=normal>2680</span>
<span class=normal>2681</span>
<span class=normal>2682</span>
<span class=normal>2683</span>
<span class=normal>2684</span>
<span class=normal>2685</span>
<span class=normal>2686</span>
<span class=normal>2687</span>
<span class=normal>2688</span>
<span class=normal>2689</span>
<span class=normal>2690</span>
<span class=normal>2691</span>
<span class=normal>2692</span>
<span class=normal>2693</span>
<span class=normal>2694</span>
<span class=normal>2695</span>
<span class=normal>2696</span>
<span class=normal>2697</span>
<span class=normal>2698</span>
<span class=normal>2699</span>
<span class=normal>2700</span>
<span class=normal>2701</span>
<span class=normal>2702</span>
<span class=normal>2703</span>
<span class=normal>2704</span>
<span class=normal>2705</span>
<span class=normal>2706</span>
<span class=normal>2707</span>
<span class=normal>2708</span>
<span class=normal>2709</span>
<span class=normal>2710</span>
<span class=normal>2711</span>
<span class=normal>2712</span>
<span class=normal>2713</span>
<span class=normal>2714</span>
<span class=normal>2715</span>
<span class=normal>2716</span>
<span class=normal>2717</span>
<span class=normal>2718</span>
<span class=normal>2719</span>
<span class=normal>2720</span>
<span class=normal>2721</span>
<span class=normal>2722</span>
<span class=normal>2723</span>
<span class=normal>2724</span>
<span class=normal>2725</span>
<span class=normal>2726</span>
<span class=normal>2727</span>
<span class=normal>2728</span>
<span class=normal>2729</span>
<span class=normal>2730</span>
<span class=normal>2731</span>
<span class=normal>2732</span>
<span class=normal>2733</span>
<span class=normal>2734</span>
<span class=normal>2735</span>
<span class=normal>2736</span>
<span class=normal>2737</span>
<span class=normal>2738</span>
<span class=normal>2739</span>
<span class=normal>2740</span>
<span class=normal>2741</span>
<span class=normal>2742</span>
<span class=normal>2743</span>
<span class=normal>2744</span>
<span class=normal>2745</span>
<span class=normal>2746</span>
<span class=normal>2747</span>
<span class=normal>2748</span>
<span class=normal>2749</span>
<span class=normal>2750</span>
<span class=normal>2751</span>
<span class=normal>2752</span>
<span class=normal>2753</span>
<span class=normal>2754</span>
<span class=normal>2755</span>
<span class=normal>2756</span>
<span class=normal>2757</span>
<span class=normal>2758</span>
<span class=normal>2759</span>
<span class=normal>2760</span>
<span class=normal>2761</span>
<span class=normal>2762</span>
<span class=normal>2763</span>
<span class=normal>2764</span>
<span class=normal>2765</span>
<span class=normal>2766</span>
<span class=normal>2767</span>
<span class=normal>2768</span>
<span class=normal>2769</span>
<span class=normal>2770</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>load_run</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>run_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Process and load a pipeline run.</span>

<span class=sd>    Args:</span>
<span class=sd>        run_name: The name of the run to load.</span>
<span class=sd>        n_workers: The number of workers (cpus) available.</span>

<span class=sd>    Returns:</span>
<span class=sd>        PipeAnalysis object.</span>

<span class=sd>    Raises:</span>
<span class=sd>        ValueError: Entered pipeline run does not exist.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>run_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>project_dir</span><span class=p>,</span>
        <span class=n>run_name</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>run_dir</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>OSError</span><span class=p>(</span>
            <span class=s2>&quot;Run &#39;</span><span class=si>%s</span><span class=s2>&#39; directory does not exist!&quot;</span><span class=p>,</span>
            <span class=n>run_name</span>
        <span class=p>)</span>
        <span class=k>return</span>

    <span class=n>images</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;images.parquet&#39;</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>skyregions</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;skyregions.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>bands</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;bands.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>images</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>skyregions</span><span class=p>[[</span>
            <span class=s1>&#39;id&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_ra&#39;</span><span class=p>,</span>
            <span class=s1>&#39;centre_dec&#39;</span><span class=p>,</span>
            <span class=s1>&#39;xtr_radius&#39;</span>
        <span class=p>]],</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>,</span>
        <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=s1>&#39;id_y&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id_x&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>}</span>
    <span class=p>)</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>  <span class=c1># second merge for band</span>
        <span class=n>bands</span><span class=p>[[</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;frequency&#39;</span><span class=p>,</span> <span class=s1>&#39;bandwidth&#39;</span><span class=p>]],</span>
        <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;band_id&#39;</span><span class=p>,</span>
        <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=s1>&#39;id_y&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id_x&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>}</span>
    <span class=p>)</span>

    <span class=n>relations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;relations.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>sources</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;sources.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>to_move</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>,</span> <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>,</span> <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>,</span> <span class=s1>&#39;n_sibl&#39;</span><span class=p>,</span> <span class=s1>&#39;n_rel&#39;</span><span class=p>]</span>
    <span class=n>sources_len</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>to_move</span><span class=p>:</span>
        <span class=n>col</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
        <span class=n>sources</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>sources_len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>

    <span class=n>sources</span> <span class=o>=</span> <span class=n>sources</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span>
        <span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>:</span> <span class=s1>&#39;n_forced&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_meas&#39;</span><span class=p>:</span> <span class=s1>&#39;n_measurements&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>:</span> <span class=s1>&#39;n_selavy&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_sibl&#39;</span><span class=p>:</span> <span class=s1>&#39;n_siblings&#39;</span><span class=p>,</span>
            <span class=s1>&#39;n_rel&#39;</span><span class=p>:</span> <span class=s1>&#39;n_relations&#39;</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=n>associations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s1>&#39;associations.parquet&#39;</span>
        <span class=p>),</span>
        <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
    <span class=p>)</span>

    <span class=n>vaex_meas</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>run_dir</span><span class=p>,</span>
        <span class=s1>&#39;measurements.arrow&#39;</span>
    <span class=p>)):</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>vaex</span><span class=o>.</span><span class=n>open</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>run_dir</span><span class=p>,</span> <span class=s1>&#39;measurements.arrow&#39;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>vaex_meas</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;Measurements have been loaded with vaex.&quot;</span><span class=p>)</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>m_files</span> <span class=o>=</span> <span class=n>images</span><span class=p>[</span><span class=s1>&#39;measurements_path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
        <span class=n>m_files</span> <span class=o>+=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;forced_measurements*.parquet&quot;</span>
        <span class=p>)))</span>

        <span class=c1># use dask to open measurement parquets</span>
        <span class=c1># as they are spread over many different files</span>
        <span class=n>measurements</span> <span class=o>=</span> <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
            <span class=n>m_files</span><span class=p>,</span>
            <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>

        <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>associations</span><span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
        <span class=p>]</span>

        <span class=n>measurements</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>associations</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>,</span> <span class=s1>&#39;source_id&#39;</span><span class=p>]]</span>
            <span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;meas_id&#39;</span><span class=p>)</span>
            <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
                <span class=n>measurements</span><span class=p>,</span>
                <span class=n>left_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
            <span class=p>)</span>
            <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;source&#39;</span><span class=p>})</span>
        <span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=n>images</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>run_dir</span><span class=p>,</span>
        <span class=s2>&quot;measurement_pairs.arrow&quot;</span>
    <span class=p>)):</span>
        <span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;measurement_pairs.arrow&quot;</span>
        <span class=p>)]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>measurement_pairs_file</span> <span class=o>=</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_dir</span><span class=p>,</span>
            <span class=s2>&quot;measurement_pairs.parquet&quot;</span>
        <span class=p>)]</span>

    <span class=n>piperun</span> <span class=o>=</span> <span class=n>PipeAnalysis</span><span class=p>(</span>
        <span class=n>name</span><span class=o>=</span><span class=n>run_name</span><span class=p>,</span>
        <span class=n>images</span><span class=o>=</span><span class=n>images</span><span class=p>,</span>
        <span class=n>skyregions</span><span class=o>=</span><span class=n>skyregions</span><span class=p>,</span>
        <span class=n>relations</span><span class=o>=</span><span class=n>relations</span><span class=p>,</span>
        <span class=n>sources</span><span class=o>=</span><span class=n>sources</span><span class=p>,</span>
        <span class=n>associations</span><span class=o>=</span><span class=n>associations</span><span class=p>,</span>
        <span class=n>bands</span><span class=o>=</span><span class=n>bands</span><span class=p>,</span>
        <span class=n>measurements</span><span class=o>=</span><span class=n>measurements</span><span class=p>,</span>
        <span class=n>measurement_pairs_file</span><span class=o>=</span><span class=n>measurement_pairs_file</span><span class=p>,</span>
        <span class=n>vaex_meas</span><span class=o>=</span><span class=n>vaex_meas</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>piperun</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=vasttools.pipeline.Pipeline.load_runs class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_runs</span><span class=p>(</span><span class=n>run_names</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>n_workers</span><span class=o>=</span><span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span></code> <a href=#vasttools.pipeline.Pipeline.load_runs class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Wrapper to load multiple runs in one command.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>run_names</code></td> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td> <div class=doc-md-description> <p>List containing the names of the runs to load.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>name</code></td> <td> <code><span title="typing.Optional">Optional</span>[str]</code> </td> <td> <div class=doc-md-description> <p>A name for the resulting pipeline run.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>n_workers</code></td> <td> <code>int</code> </td> <td> <div class=doc-md-description> <p>The number of workers (cpus) available.</p> </div> </td> <td> <code><span title="vasttools.pipeline.HOST_NCPU">HOST_NCPU</span> - 1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="vasttools.pipeline.PipeAnalysis" href="#vasttools.pipeline.PipeAnalysis">PipeAnalysis</a></code> </td> <td> <div class=doc-md-description> <p>Combined PipeAnalysis object.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2549</span>
<span class=normal>2550</span>
<span class=normal>2551</span>
<span class=normal>2552</span>
<span class=normal>2553</span>
<span class=normal>2554</span>
<span class=normal>2555</span>
<span class=normal>2556</span>
<span class=normal>2557</span>
<span class=normal>2558</span>
<span class=normal>2559</span>
<span class=normal>2560</span>
<span class=normal>2561</span>
<span class=normal>2562</span>
<span class=normal>2563</span>
<span class=normal>2564</span>
<span class=normal>2565</span>
<span class=normal>2566</span>
<span class=normal>2567</span>
<span class=normal>2568</span>
<span class=normal>2569</span>
<span class=normal>2570</span>
<span class=normal>2571</span>
<span class=normal>2572</span>
<span class=normal>2573</span>
<span class=normal>2574</span>
<span class=normal>2575</span>
<span class=normal>2576</span>
<span class=normal>2577</span>
<span class=normal>2578</span>
<span class=normal>2579</span>
<span class=normal>2580</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>load_runs</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>run_names</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>n_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>HOST_NCPU</span> <span class=o>-</span> <span class=mi>1</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PipeAnalysis</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Wrapper to load multiple runs in one command.</span>

<span class=sd>    Args:</span>
<span class=sd>        run_names: List containing the names of the runs to load.</span>
<span class=sd>        name: A name for the resulting pipeline run.</span>
<span class=sd>        n_workers: The number of workers (cpus) available.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Combined PipeAnalysis object.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>piperun</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_run</span><span class=p>(</span>
        <span class=n>run_names</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
        <span class=n>n_workers</span><span class=o>=</span><span class=n>n_workers</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>run_names</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>run_names</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
            <span class=n>piperun</span> <span class=o>=</span> <span class=n>piperun</span><span class=o>.</span><span class=n>combine_with_run</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>load_run</span><span class=p>(</span>
                    <span class=n>r</span><span class=p>,</span>
                    <span class=n>n_workers</span><span class=o>=</span><span class=n>n_workers</span>
                <span class=p>)</span>
            <span class=p>)</span>
    <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>piperun</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>

    <span class=k>return</span> <span class=n>piperun</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=vasttools.pipeline.PipelineDirectoryError class="doc doc-heading"> <code>PipelineDirectoryError</code> <a href=#vasttools.pipeline.PipelineDirectoryError class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>Exception</code></p> <p>An error to indicate an error with the pipeline directory.</p> <details class=quote> <summary>Source code in <code>vasttools/pipeline.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>PipelineDirectoryError</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    An error to indicate an error with the pipeline directory.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 8, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 8, 2025</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2020 - 2025 Vast Development Team, University of Sydney - all right reserved </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/askap-vast/vast-tools target=_blank rel=noopener title="vast-pipeline source on GitHub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://vast-survey.org target=_blank rel=noopener title=vast-survey.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64zm28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7zm-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6zM8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zm186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6h116.7zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.fe8b6f2b.min.js></script> <script src=../../theme/js/extra.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
    </script> </body> </html>