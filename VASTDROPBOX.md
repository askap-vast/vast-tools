# get\_vast\_pilot\_dbx.py

This script allows for simple downloading of the VAST Pilot survey from Dropbox.

Features:
* Generate a list of available files.
* State which Epochs are available.
* Download an entire Epoch.
* Download user requested files.

## Prerequisites

**This script requires you to have a Dropbox App 'access token'.** You do this by making an 'app' on your Dropbox account and then generating an OAuth token for that app.

This tutorial shows you how to obtain one: http://99rabbits.com/get-dropbox-access-token/. Make sure you select the `Full Dropbox` option in the access section.

Otherwise the requirements installed from the main repo will cover all the python needs.

You also need to know the shared Dropbox URL of the Pilot survey and the password.

## Usage
```
usage: get_vast_pilot_dbx.py [-h] [--output OUTPUT] [--available-epochs]
                             [--available-files]
                             [--download-epoch DOWNLOAD_EPOCH]
                             [--files-list FILES_LIST] [--debug]
                             [--write-config]
                             dropbox_config_file

positional arguments:
  dropbox_config_file   Dropbox config file to be read in containing the
                        shared url, password and access token.

optional arguments:
  -h, --help            show this help message and exit
  --output OUTPUT       Name of the local output directory where files will be
                        saved (default: vast_dropbox)
  --available-epochs    Print out what Epochs are available. (default: False)
  --available-files     Print out a list of available files on the shared
                        folder. (default: )
  --download-epoch DOWNLOAD_EPOCH
                        Select to download an entire Epoch directory. Enter as
                        an integer. (default: 0)
  --files-list FILES_LIST
                        Input of files to fetch. (default: )
  --debug               Set logging level to debug. (default: False)
  --write-config        Create a template dropbox config file. (default:
                        False)
```

As seen above the script takes in one positional argument which is the Dropbox configuration file. Create a text file in the following format and enter the respective values:
```
[dropbox]
shared_url = ENTER_URL
password = ENTER_PASSWORD
access_token = ENTER_ACCESS_TOKEN
```
There is no need to put quotes around the strings. A template can be generated by using 
```
get_vast_pilot_dbx.py --write-config
```

### Modes

There are 4 different ways the script can be used:

1. `--available-epochs` will only display the currently released epochs. Nothing will be downloaded.
2. `--available-files` will generate a complete list of all the files avaialble. This is helpful in order to build your own list of files you wish to fetch. Nothing will be downloaded.
3. `--download-epoch` will download an entire Epoch directory of your choosing.
4. `--files-list` defines a text file that contains the files you wish to download. Help on this is below.

Modes 2, 3 and 4 will all place results in an output directory. The name of the directory can be set with `--output`.

#### User Files List
When supplying a list of files it needs to follow the directory structure of the Dropbox. It also needs to explictly state the files - i.e. you **cannot use wildcards** (sorry it's the limitations of using Dropbox this way).

For example if I wanted to download a set of STOKES I COMBINED images from EPOCH01, the file would be:
```
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_0918+00A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_1739-25A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_1753-18A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_0943+00A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_0216+00A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_2143-06A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_2208-06A.EPOCH01.I.fits

```
Note the leading `/` which is also needed.

I recommened you run `python get_vast_pilot_dbx.py dropbox.cfg --available-files` and use this output to build your request.

### Examples

#### Downloading an entire epoch (01)

```
python get_vast_pilot_dbx.py dropbox.cfg --download-epoch 1 --output VAST_DOWNLOAD
```
This will place the EPOCH01 directory in `VAST_DOWNLOAD`.

#### Downloading a user selected set of files

1. Create the text file containing the files, e.g. `to_download.txt`:
```
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_0918+00A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_1739-25A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_1753-18A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_0943+00A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_0216+00A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_2143-06A.EPOCH01.I.fits
/EPOCH01/COMBINED/STOKESI_IMAGES/VAST_2208-06A.EPOCH01.I.fits

```
2. Then run with:
```
python get_vast_pilot_dbx.py dropbox.cfg --files-list to_download.txt --output VAST_DOWNLOAD
```
This will place these files in `VAST_DOWNLOAD`. The directory structure will be mimiced.


